{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/lib/operator-session.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\r\n\r\nexport type OperatorRole = \"admin\" | \"operator\" | \"auditor\"\r\n\r\nexport type OperatorSession = {\r\n  email: string\r\n  role: OperatorRole\r\n  ts: number\r\n}\r\n\r\nconst SESSION_COOKIE = \"operator_session\"\r\nconst SESSION_SECRET = process.env.OPERATOR_SESSION_SECRET || \"dev-operator-session-secret\"\r\n\r\nfunction textToUint8(data: string) {\r\n  return new TextEncoder().encode(data)\r\n}\r\n\r\nfunction base64UrlToUint8Array(b64url: string) {\r\n  const pad = \"=\".repeat((4 - (b64url.length % 4)) % 4)\r\n  const b64 = (b64url + pad).replace(/-/g, \"+\").replace(/_/g, \"/\")\r\n  const binary = atob(b64)\r\n  const bytes = new Uint8Array(binary.length)\r\n  for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i)\r\n  return bytes\r\n}\r\n\r\nfunction uint8ToHex(bytes: ArrayBuffer) {\r\n  const arr = new Uint8Array(bytes)\r\n  let hex = \"\"\r\n  for (let i = 0; i < arr.length; i++) {\r\n    hex += arr[i].toString(16).padStart(2, \"0\")\r\n  }\r\n  return hex\r\n}\r\n\r\nfunction safeEqual(a: string, b: string) {\r\n  if (a.length !== b.length) return false\r\n  let diff = 0\r\n  for (let i = 0; i < a.length; i++) {\r\n    diff |= a.charCodeAt(i) ^ b.charCodeAt(i)\r\n  }\r\n  return diff === 0\r\n}\r\n\r\nasync function importHmacKey(secret: string) {\r\n  return crypto.subtle.importKey(\"raw\", textToUint8(secret), { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"])\r\n}\r\n\r\nexport async function decodeSession(token: string): Promise<OperatorSession | null> {\r\n  const [payloadB64, signature] = token.split(\".\")\r\n  if (!payloadB64 || !signature) return null\r\n\r\n  const key = await importHmacKey(SESSION_SECRET)\r\n  const expected = uint8ToHex(await crypto.subtle.sign(\"HMAC\", key, textToUint8(payloadB64)))\r\n  if (!safeEqual(signature, expected)) return null\r\n\r\n  try {\r\n    const payloadBytes = base64UrlToUint8Array(payloadB64)\r\n    const json = new TextDecoder().decode(payloadBytes)\r\n    const parsed = JSON.parse(json) as OperatorSession\r\n    return parsed\r\n  } catch (err) {\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function verifyOperatorSession(): Promise<OperatorSession | null> {\r\n  const jar = await cookies()\r\n  const token = jar.get(SESSION_COOKIE)?.value\r\n  if (!token) return null\r\n  return decodeSession(token)\r\n}\r\n\r\nexport async function getSessionRoleFromCookie(): Promise<OperatorRole | null> {\r\n  const session = await verifyOperatorSession()\r\n  return session?.role ?? null\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;;AAUA,MAAM,iBAAiB;AACvB,MAAM,iBAAiB,QAAQ,GAAG,CAAC,uBAAuB,IAAI;AAE9D,SAAS,YAAY,IAAY;IAC/B,OAAO,IAAI,cAAc,MAAM,CAAC;AAClC;AAEA,SAAS,sBAAsB,MAAc;IAC3C,MAAM,MAAM,IAAI,MAAM,CAAC,CAAC,IAAK,OAAO,MAAM,GAAG,CAAE,IAAI;IACnD,MAAM,MAAM,CAAC,SAAS,GAAG,EAAE,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM;IAC5D,MAAM,SAAS,KAAK;IACpB,MAAM,QAAQ,IAAI,WAAW,OAAO,MAAM;IAC1C,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,EAAE,IAAK,KAAK,CAAC,EAAE,GAAG,OAAO,UAAU,CAAC;IACrE,OAAO;AACT;AAEA,SAAS,WAAW,KAAkB;IACpC,MAAM,MAAM,IAAI,WAAW;IAC3B,IAAI,MAAM;IACV,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM,EAAE,IAAK;QACnC,OAAO,GAAG,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG;IACzC;IACA,OAAO;AACT;AAEA,SAAS,UAAU,CAAS,EAAE,CAAS;IACrC,IAAI,EAAE,MAAM,KAAK,EAAE,MAAM,EAAE,OAAO;IAClC,IAAI,OAAO;IACX,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,MAAM,EAAE,IAAK;QACjC,QAAQ,EAAE,UAAU,CAAC,KAAK,EAAE,UAAU,CAAC;IACzC;IACA,OAAO,SAAS;AAClB;AAEA,eAAe,cAAc,MAAc;IACzC,OAAO,OAAO,MAAM,CAAC,SAAS,CAAC,OAAO,YAAY,SAAS;QAAE,MAAM;QAAQ,MAAM;IAAU,GAAG,OAAO;QAAC;KAAO;AAC/G;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,CAAC,YAAY,UAAU,GAAG,MAAM,KAAK,CAAC;IAC5C,IAAI,CAAC,cAAc,CAAC,WAAW,OAAO;IAEtC,MAAM,MAAM,MAAM,cAAc;IAChC,MAAM,WAAW,WAAW,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC,QAAQ,KAAK,YAAY;IAC9E,IAAI,CAAC,UAAU,WAAW,WAAW,OAAO;IAE5C,IAAI;QACF,MAAM,eAAe,sBAAsB;QAC3C,MAAM,OAAO,IAAI,cAAc,MAAM,CAAC;QACtC,MAAM,SAAS,KAAK,KAAK,CAAC;QAC1B,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,sTAAO;IACzB,MAAM,QAAQ,IAAI,GAAG,CAAC,iBAAiB;IACvC,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,cAAc;AACvB;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,OAAO,SAAS,QAAQ;AAC1B"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from \"next/server\"\r\nimport { verifyOperatorSession } from \"@/lib/operator-session\"\r\n\r\nexport async function middleware(req: NextRequest) {\r\n  const { pathname } = req.nextUrl\r\n\r\n  if (pathname.startsWith(\"/operator\") && !pathname.startsWith(\"/operator-login\") && !pathname.startsWith(\"/api/operator\")) {\r\n    const session = await verifyOperatorSession()\r\n    if (!session) {\r\n      const url = req.nextUrl.clone()\r\n      url.pathname = \"/operator-login\"\r\n      return NextResponse.redirect(url)\r\n    }\r\n  }\r\n\r\n  return NextResponse.next()\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe,WAAW,GAAgB;IAC/C,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,IAAI,SAAS,UAAU,CAAC,gBAAgB,CAAC,SAAS,UAAU,CAAC,sBAAsB,CAAC,SAAS,UAAU,CAAC,kBAAkB;QACxH,MAAM,UAAU,MAAM,IAAA,2JAAqB;QAC3C,IAAI,CAAC,SAAS;YACZ,MAAM,MAAM,IAAI,OAAO,CAAC,KAAK;YAC7B,IAAI,QAAQ,GAAG;YACf,OAAO,gUAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,OAAO,gUAAY,CAAC,IAAI;AAC1B"}}]
}