{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/operator-session.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\r\n\r\nexport type OperatorRole = \"admin\" | \"operator\" | \"auditor\"\r\n\r\nexport type OperatorSession = {\r\n  email: string\r\n  role: OperatorRole\r\n  ts: number\r\n}\r\n\r\nconst SESSION_COOKIE = \"operator_session\"\r\nconst SESSION_SECRET = process.env.OPERATOR_SESSION_SECRET || \"dev-operator-session-secret\"\r\n\r\nfunction textToUint8(data: string) {\r\n  return new TextEncoder().encode(data)\r\n}\r\n\r\nfunction base64UrlToUint8Array(b64url: string) {\r\n  const pad = \"=\".repeat((4 - (b64url.length % 4)) % 4)\r\n  const b64 = (b64url + pad).replace(/-/g, \"+\").replace(/_/g, \"/\")\r\n  const binary = atob(b64)\r\n  const bytes = new Uint8Array(binary.length)\r\n  for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i)\r\n  return bytes\r\n}\r\n\r\nfunction uint8ToHex(bytes: ArrayBuffer) {\r\n  const arr = new Uint8Array(bytes)\r\n  let hex = \"\"\r\n  for (let i = 0; i < arr.length; i++) {\r\n    hex += arr[i].toString(16).padStart(2, \"0\")\r\n  }\r\n  return hex\r\n}\r\n\r\nfunction safeEqual(a: string, b: string) {\r\n  if (a.length !== b.length) return false\r\n  let diff = 0\r\n  for (let i = 0; i < a.length; i++) {\r\n    diff |= a.charCodeAt(i) ^ b.charCodeAt(i)\r\n  }\r\n  return diff === 0\r\n}\r\n\r\nasync function importHmacKey(secret: string) {\r\n  return crypto.subtle.importKey(\"raw\", textToUint8(secret), { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"])\r\n}\r\n\r\nexport async function decodeSession(token: string): Promise<OperatorSession | null> {\r\n  const [payloadB64, signature] = token.split(\".\")\r\n  if (!payloadB64 || !signature) return null\r\n\r\n  const key = await importHmacKey(SESSION_SECRET)\r\n  const expected = uint8ToHex(await crypto.subtle.sign(\"HMAC\", key, textToUint8(payloadB64)))\r\n  if (!safeEqual(signature, expected)) return null\r\n\r\n  try {\r\n    const payloadBytes = base64UrlToUint8Array(payloadB64)\r\n    const json = new TextDecoder().decode(payloadBytes)\r\n    const parsed = JSON.parse(json) as OperatorSession\r\n    return parsed\r\n  } catch (err) {\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function verifyOperatorSession(): Promise<OperatorSession | null> {\r\n  const jar = await cookies()\r\n  const token = jar.get(SESSION_COOKIE)?.value\r\n  if (!token) return null\r\n  return decodeSession(token)\r\n}\r\n\r\nexport async function getSessionRoleFromCookie(): Promise<OperatorRole | null> {\r\n  const session = await verifyOperatorSession()\r\n  return session?.role ?? null\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAUA,MAAM,iBAAiB;AACvB,MAAM,iBAAiB,QAAQ,GAAG,CAAC,uBAAuB,IAAI;AAE9D,SAAS,YAAY,IAAY;IAC/B,OAAO,IAAI,cAAc,MAAM,CAAC;AAClC;AAEA,SAAS,sBAAsB,MAAc;IAC3C,MAAM,MAAM,IAAI,MAAM,CAAC,CAAC,IAAK,OAAO,MAAM,GAAG,CAAE,IAAI;IACnD,MAAM,MAAM,CAAC,SAAS,GAAG,EAAE,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM;IAC5D,MAAM,SAAS,KAAK;IACpB,MAAM,QAAQ,IAAI,WAAW,OAAO,MAAM;IAC1C,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,EAAE,IAAK,KAAK,CAAC,EAAE,GAAG,OAAO,UAAU,CAAC;IACrE,OAAO;AACT;AAEA,SAAS,WAAW,KAAkB;IACpC,MAAM,MAAM,IAAI,WAAW;IAC3B,IAAI,MAAM;IACV,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM,EAAE,IAAK;QACnC,OAAO,GAAG,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG;IACzC;IACA,OAAO;AACT;AAEA,SAAS,UAAU,CAAS,EAAE,CAAS;IACrC,IAAI,EAAE,MAAM,KAAK,EAAE,MAAM,EAAE,OAAO;IAClC,IAAI,OAAO;IACX,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,MAAM,EAAE,IAAK;QACjC,QAAQ,EAAE,UAAU,CAAC,KAAK,EAAE,UAAU,CAAC;IACzC;IACA,OAAO,SAAS;AAClB;AAEA,eAAe,cAAc,MAAc;IACzC,OAAO,OAAO,MAAM,CAAC,SAAS,CAAC,OAAO,YAAY,SAAS;QAAE,MAAM;QAAQ,MAAM;IAAU,GAAG,OAAO;QAAC;KAAO;AAC/G;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,CAAC,YAAY,UAAU,GAAG,MAAM,KAAK,CAAC;IAC5C,IAAI,CAAC,cAAc,CAAC,WAAW,OAAO;IAEtC,MAAM,MAAM,MAAM,cAAc;IAChC,MAAM,WAAW,WAAW,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC,QAAQ,KAAK,YAAY;IAC9E,IAAI,CAAC,UAAU,WAAW,WAAW,OAAO;IAE5C,IAAI;QACF,MAAM,eAAe,sBAAsB;QAC3C,MAAM,OAAO,IAAI,cAAc,MAAM,CAAC;QACtC,MAAM,SAAS,KAAK,KAAK,CAAC;QAC1B,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,4QAAO;IACzB,MAAM,QAAQ,IAAI,GAAG,CAAC,iBAAiB;IACvC,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,cAAc;AACvB;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,OAAO,SAAS,QAAQ;AAC1B"}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/operator-audit.ts"],"sourcesContent":["import fs from \"fs/promises\"\r\nimport path from \"path\"\r\nimport crypto from \"crypto\"\r\n\r\nexport type OperatorAuditAction =\r\n  | \"login-success\"\r\n  | \"login-failed\"\r\n  | \"logout\"\r\n  | \"user-add\"\r\n  | \"user-delete\"\r\n  | \"user-role-change\"\r\n  | \"access-denied\"\r\n  | \"view-users\"\r\n\r\nexport type OperatorAuditEntry = {\r\n  id: string\r\n  ts: number\r\n  actorEmail?: string\r\n  actorRole?: string\r\n  action: OperatorAuditAction\r\n  targetEmail?: string\r\n  details?: string\r\n  ip?: string\r\n  userAgent?: string\r\n}\r\n\r\nconst AUDIT_STORE = path.join(process.cwd(), \"data\", \"operator-audit.json\")\r\n\r\nasync function ensureAuditDir() {\r\n  await fs.mkdir(path.dirname(AUDIT_STORE), { recursive: true })\r\n}\r\n\r\nexport async function readAudit(): Promise<OperatorAuditEntry[]> {\r\n  try {\r\n    await ensureAuditDir()\r\n    const raw = await fs.readFile(AUDIT_STORE, \"utf8\")\r\n    return JSON.parse(raw) as OperatorAuditEntry[]\r\n  } catch (err) {\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function writeAudit(entries: OperatorAuditEntry[]): Promise<void> {\r\n  await ensureAuditDir()\r\n  await fs.writeFile(AUDIT_STORE, JSON.stringify(entries, null, 2), \"utf8\")\r\n}\r\n\r\nexport async function logOperatorAction(entry: Omit<OperatorAuditEntry, \"id\" | \"ts\">) {\r\n  const existing = await readAudit()\r\n  const record: OperatorAuditEntry = {\r\n    id: crypto.randomUUID(),\r\n    ts: Date.now(),\r\n    ...entry,\r\n  }\r\n  existing.push(record)\r\n  await writeAudit(existing)\r\n  return record\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AAwBA,MAAM,cAAc,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAErD,eAAe;IACb,MAAM,gIAAE,CAAC,KAAK,CAAC,4GAAI,CAAC,OAAO,CAAC,cAAc;QAAE,WAAW;IAAK;AAC9D;AAEO,eAAe;IACpB,IAAI;QACF,MAAM;QACN,MAAM,MAAM,MAAM,gIAAE,CAAC,QAAQ,CAAC,aAAa;QAC3C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAO,KAAK;QACZ,OAAO,EAAE;IACX;AACF;AAEO,eAAe,WAAW,OAA6B;IAC5D,MAAM;IACN,MAAM,gIAAE,CAAC,SAAS,CAAC,aAAa,KAAK,SAAS,CAAC,SAAS,MAAM,IAAI;AACpE;AAEO,eAAe,kBAAkB,KAA4C;IAClF,MAAM,WAAW,MAAM;IACvB,MAAM,SAA6B;QACjC,IAAI,gHAAM,CAAC,UAAU;QACrB,IAAI,KAAK,GAAG;QACZ,GAAG,KAAK;IACV;IACA,SAAS,IAAI,CAAC;IACd,MAAM,WAAW;IACjB,OAAO;AACT"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/app/api/operator/logout/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport { verifyOperatorSession } from \"@/lib/operator-session\"\r\nimport { logOperatorAction } from \"@/lib/operator-audit\"\r\n\r\nexport const runtime = \"nodejs\"\r\n\r\nfunction getClientMeta(request: Request) {\r\n  const ip = request.headers.get(\"x-forwarded-for\")?.split(\",\")[0]?.trim() || request.headers.get(\"x-real-ip\") || undefined\r\n  const userAgent = request.headers.get(\"user-agent\") || undefined\r\n  return { ip, userAgent }\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  const session = await verifyOperatorSession()\r\n  const meta = getClientMeta(request)\r\n  const res = NextResponse.json({ success: true })\r\n  res.cookies.set(\"operator_session\", \"\", {\r\n    httpOnly: true,\r\n    secure: process.env.NODE_ENV === \"production\",\r\n    sameSite: \"lax\",\r\n    path: \"/\",\r\n    maxAge: 0,\r\n  })\r\n  if (session) {\r\n    await logOperatorAction({ action: \"logout\", actorEmail: session.email, actorRole: session.role, ...meta })\r\n  }\r\n  return res\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,MAAM,UAAU;AAEvB,SAAS,cAAc,OAAgB;IACrC,MAAM,KAAK,QAAQ,OAAO,CAAC,GAAG,CAAC,oBAAoB,MAAM,IAAI,CAAC,EAAE,EAAE,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB;IAChH,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,iBAAiB;IACvD,OAAO;QAAE;QAAI;IAAU;AACzB;AAEO,eAAe,KAAK,OAAgB;IACzC,MAAM,UAAU,MAAM,IAAA,qJAAqB;IAC3C,MAAM,OAAO,cAAc;IAC3B,MAAM,MAAM,gRAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAAK;IAC9C,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB,IAAI;QACtC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,MAAM;QACN,QAAQ;IACV;IACA,IAAI,SAAS;QACX,MAAM,IAAA,+IAAiB,EAAC;YAAE,QAAQ;YAAU,YAAY,QAAQ,KAAK;YAAE,WAAW,QAAQ,IAAI;YAAE,GAAG,IAAI;QAAC;IAC1G;IACA,OAAO;AACT"}}]
}