{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/audit.ts"],"sourcesContent":["import type { AuditActionType, AuditLogEntry, RiskLevel } from \"@/lib/types\"\r\n\r\nconst auditLog: AuditLogEntry[] = []\r\n\r\nfunction makeId(prefix: string) {\r\n  return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 6)}`\r\n}\r\n\r\nexport function logAction(entry: Omit<AuditLogEntry, \"id\" | \"timestamp\">): AuditLogEntry {\r\n  const next: AuditLogEntry = {\r\n    ...entry,\r\n    id: makeId(\"audit\"),\r\n    timestamp: new Date().toISOString(),\r\n  }\r\n  auditLog.push(next)\r\n  return next\r\n}\r\n\r\nexport function listLogs(): AuditLogEntry[] {\r\n  return [...auditLog].sort((a, b) => (a.timestamp > b.timestamp ? -1 : 1))\r\n}\r\n\r\nexport function filterLogs(options: { risk?: RiskLevel; actionType?: AuditActionType } = {}): AuditLogEntry[] {\r\n  return listLogs().filter((log) => {\r\n    if (options.risk && log.risk !== options.risk) return false\r\n    if (options.actionType && log.actionType !== options.actionType) return false\r\n    return true\r\n  })\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAM,WAA4B,EAAE;AAEpC,SAAS,OAAO,MAAc;IAC5B,OAAO,GAAG,OAAO,CAAC,EAAE,KAAK,GAAG,GAAG,QAAQ,CAAC,IAAI,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;AACzF;AAEO,SAAS,UAAU,KAA8C;IACtE,MAAM,OAAsB;QAC1B,GAAG,KAAK;QACR,IAAI,OAAO;QACX,WAAW,IAAI,OAAO,WAAW;IACnC;IACA,SAAS,IAAI,CAAC;IACd,OAAO;AACT;AAEO,SAAS;IACd,OAAO;WAAI;KAAS,CAAC,IAAI,CAAC,CAAC,GAAG,IAAO,EAAE,SAAS,GAAG,EAAE,SAAS,GAAG,CAAC,IAAI;AACxE;AAEO,SAAS,WAAW,UAA8D,CAAC,CAAC;IACzF,OAAO,WAAW,MAAM,CAAC,CAAC;QACxB,IAAI,QAAQ,IAAI,IAAI,IAAI,IAAI,KAAK,QAAQ,IAAI,EAAE,OAAO;QACtD,IAAI,QAAQ,UAAU,IAAI,IAAI,UAAU,KAAK,QAAQ,UAAU,EAAE,OAAO;QACxE,OAAO;IACT;AACF"}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/knowledge.ts"],"sourcesContent":["import type { IncidentPattern, KnowledgeArticle } from \"@/lib/types\"\r\n\r\nconst knowledgeStore: KnowledgeArticle[] = []\r\n\r\nfunction makeId(prefix: string) {\r\n  return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 6)}`\r\n}\r\n\r\nexport function listKnowledgeArticles(limit?: number): KnowledgeArticle[] {\r\n  return typeof limit === \"number\" ? knowledgeStore.slice(0, limit) : [...knowledgeStore]\r\n}\r\n\r\nexport function getKnowledgeArticle(id: string): KnowledgeArticle | undefined {\r\n  return knowledgeStore.find((a) => a.id === id)\r\n}\r\n\r\nexport function upsertKnowledgeArticle(article: KnowledgeArticle): KnowledgeArticle {\r\n  const idx = knowledgeStore.findIndex((a) => a.id === article.id)\r\n  if (idx >= 0) {\r\n    knowledgeStore[idx] = { ...knowledgeStore[idx], ...article, updatedAt: article.updatedAt }\r\n    return knowledgeStore[idx]\r\n  }\r\n  knowledgeStore.unshift(article)\r\n  return article\r\n}\r\n\r\nexport function generateKnowledgeFromPatterns(patterns: IncidentPattern[]): KnowledgeArticle[] {\r\n  const generated: KnowledgeArticle[] = patterns.map((p) => {\r\n    const id = `auto-${p.tenantId ?? \"global\"}-${p.siteId ?? \"global\"}-${p.type}-${p.key}`\r\n    const summary = `Recurring issue observed ${p.occurrences} time${p.occurrences === 1 ? \"\" : \"s\"}: ${p.key}.`\r\n    const body = [\r\n      `Pattern: ${p.key}`,\r\n      `Occurrences: ${p.occurrences}`,\r\n      p.successCount ? `Successful remediations: ${p.successCount}` : \"\",\r\n      p.failureCount ? `Failed remediation attempts: ${p.failureCount}` : \"\",\r\n      p.rollbackCount ? `Rollbacks executed: ${p.rollbackCount}` : \"\",\r\n    ]\r\n      .filter(Boolean)\r\n      .join(\"\\n\")\r\n\r\n    const article: KnowledgeArticle = {\r\n      id,\r\n      title: `Recurring issue: ${p.key}`,\r\n      summary,\r\n      relatedDiagnosisIds: p.relatedDiagnosisIds,\r\n      relatedProposalIds: p.relatedProposalIds,\r\n      relatedPatternKeys: [p.key],\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString(),\r\n      source: \"operator\",\r\n      tags: [p.type],\r\n      body,\r\n      tenantId: p.tenantId,\r\n      siteId: p.siteId,\r\n    }\r\n\r\n    return article\r\n  })\r\n\r\n  generated.forEach((article) => {\r\n    const existing = getKnowledgeArticle(article.id)\r\n    if (!existing) {\r\n      upsertKnowledgeArticle(article)\r\n    }\r\n  })\r\n\r\n  return generated\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAEA,MAAM,iBAAqC,EAAE;AAE7C,SAAS,OAAO,MAAc;IAC5B,OAAO,GAAG,OAAO,CAAC,EAAE,KAAK,GAAG,GAAG,QAAQ,CAAC,IAAI,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;AACzF;AAEO,SAAS,sBAAsB,KAAc;IAClD,OAAO,OAAO,UAAU,WAAW,eAAe,KAAK,CAAC,GAAG,SAAS;WAAI;KAAe;AACzF;AAEO,SAAS,oBAAoB,EAAU;IAC5C,OAAO,eAAe,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;AAC7C;AAEO,SAAS,uBAAuB,OAAyB;IAC9D,MAAM,MAAM,eAAe,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,QAAQ,EAAE;IAC/D,IAAI,OAAO,GAAG;QACZ,cAAc,CAAC,IAAI,GAAG;YAAE,GAAG,cAAc,CAAC,IAAI;YAAE,GAAG,OAAO;YAAE,WAAW,QAAQ,SAAS;QAAC;QACzF,OAAO,cAAc,CAAC,IAAI;IAC5B;IACA,eAAe,OAAO,CAAC;IACvB,OAAO;AACT;AAEO,SAAS,8BAA8B,QAA2B;IACvE,MAAM,YAAgC,SAAS,GAAG,CAAC,CAAC;QAClD,MAAM,KAAK,CAAC,KAAK,EAAE,EAAE,QAAQ,IAAI,SAAS,CAAC,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE;QACtF,MAAM,UAAU,CAAC,yBAAyB,EAAE,EAAE,WAAW,CAAC,KAAK,EAAE,EAAE,WAAW,KAAK,IAAI,KAAK,IAAI,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC;QAC5G,MAAM,OAAO;YACX,CAAC,SAAS,EAAE,EAAE,GAAG,EAAE;YACnB,CAAC,aAAa,EAAE,EAAE,WAAW,EAAE;YAC/B,EAAE,YAAY,GAAG,CAAC,yBAAyB,EAAE,EAAE,YAAY,EAAE,GAAG;YAChE,EAAE,YAAY,GAAG,CAAC,6BAA6B,EAAE,EAAE,YAAY,EAAE,GAAG;YACpE,EAAE,aAAa,GAAG,CAAC,oBAAoB,EAAE,EAAE,aAAa,EAAE,GAAG;SAC9D,CACE,MAAM,CAAC,SACP,IAAI,CAAC;QAER,MAAM,UAA4B;YAChC;YACA,OAAO,CAAC,iBAAiB,EAAE,EAAE,GAAG,EAAE;YAClC;YACA,qBAAqB,EAAE,mBAAmB;YAC1C,oBAAoB,EAAE,kBAAkB;YACxC,oBAAoB;gBAAC,EAAE,GAAG;aAAC;YAC3B,WAAW,IAAI,OAAO,WAAW;YACjC,WAAW,IAAI,OAAO,WAAW;YACjC,QAAQ;YACR,MAAM;gBAAC,EAAE,IAAI;aAAC;YACd;YACA,UAAU,EAAE,QAAQ;YACpB,QAAQ,EAAE,MAAM;QAClB;QAEA,OAAO;IACT;IAEA,UAAU,OAAO,CAAC,CAAC;QACjB,MAAM,WAAW,oBAAoB,QAAQ,EAAE;QAC/C,IAAI,CAAC,UAAU;YACb,uBAAuB;QACzB;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/dev-seeder.ts"],"sourcesContent":["import { recordIncident } from \"@/lib/intel\"\r\nimport { upsertKnowledgeArticle } from \"@/lib/knowledge\"\r\nimport type {\r\n  AutonomySimulation,\r\n  EarlyWarning,\r\n  FixStrategyScore,\r\n  ForesightPrediction,\r\n  IncidentRecord,\r\n  KnowledgeArticle,\r\n  KnowledgeRecommendation,\r\n  PrimeBriefing,\r\n  PrimeCognitionBundle,\r\n  ReliabilityForecast,\r\n} from \"@/lib/types\"\r\n\r\nlet seeded = false\r\n\r\nconst seededWarnings: EarlyWarning[] = []\r\nconst seededPredictions: ForesightPrediction[] = []\r\nlet seededCognition: PrimeCognitionBundle | null = null\r\nlet seededAutonomySimulations: AutonomySimulation[] = []\r\nlet seededStrategyScores: FixStrategyScore[] = []\r\nlet seededReliabilityForecast: ReliabilityForecast | null = null\r\nlet seededPrimeBriefing: PrimeBriefing | null = null\r\nconst seededKnowledgeArticles: KnowledgeArticle[] = []\r\nconst seededRecs: KnowledgeRecommendation[] = []\r\n\r\nconst baseTime = Date.now()\r\nconst dayMs = 24 * 60 * 60 * 1000\r\nconst hourMs = 60 * 60 * 1000\r\n\r\nfunction isDev() {\r\n  return process.env.NODE_ENV === \"development\"\r\n}\r\n\r\nfunction iso(daysAgo: number, hourOffset = 0) {\r\n  return new Date(baseTime - daysAgo * dayMs - hourOffset * hourMs).toISOString()\r\n}\r\n\r\nexport function seedIncidents() {\r\n  if (!isDev()) return\r\n  const incidents: IncidentRecord[] = [\r\n    {\r\n      id: \"seed-inc-001\",\r\n      timestamp: iso(1, 2),\r\n      source: \"/api/checkout\",\r\n      summary: \"API 500 spike on checkout\",\r\n      severity: \"error\",\r\n      risk: \"medium\",\r\n      actionType: \"fix-applied\",\r\n      tags: [\"api\", \"checkout\", \"500\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-002\",\r\n      timestamp: iso(2, 4),\r\n      source: \"/api/payments\",\r\n      summary: \"Payment gateway timeout\",\r\n      severity: \"warning\",\r\n      risk: \"medium\",\r\n      actionType: \"approval-required\",\r\n      tags: [\"payments\", \"timeout\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-003\",\r\n      timestamp: iso(3, 3),\r\n      source: \"worker-billing\",\r\n      summary: \"Billing worker retry storm\",\r\n      severity: \"error\",\r\n      risk: \"high\",\r\n      actionType: \"fix-failed\",\r\n      proposalId: \"prop-billing-throttle\",\r\n      tags: [\"billing\", \"queue\", \"retries\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-004\",\r\n      timestamp: iso(4, 5),\r\n      source: \"edge-cache\",\r\n      summary: \"Cache miss storm\",\r\n      severity: \"warning\",\r\n      risk: \"low\",\r\n      actionType: \"fix-applied\",\r\n      proposalId: \"prop-cache-warm\",\r\n      tags: [\"cache\", \"latency\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-005\",\r\n      timestamp: iso(5, 1),\r\n      source: \"/api/catalog\",\r\n      summary: \"Catalog schema drift detected\",\r\n      severity: \"critical\",\r\n      risk: \"high\",\r\n      actionType: \"fix-failed\",\r\n      proposalId: \"prop-catalog-rollback\",\r\n      tags: [\"schema\", \"catalog\"],\r\n    },\r\n  ]\r\n\r\n  incidents.forEach((inc) => recordIncident(inc))\r\n}\r\n\r\nexport function seedPatterns() {\r\n  if (!isDev()) return\r\n  const patternIncidents: IncidentRecord[] = [\r\n    {\r\n      id: \"seed-inc-006\",\r\n      timestamp: iso(1, 6),\r\n      source: \"/api/checkout\",\r\n      summary: \"API 500 spike on checkout\",\r\n      severity: \"error\",\r\n      risk: \"medium\",\r\n      actionType: \"fix-failed\",\r\n      proposalId: \"prop-checkout-circuit\",\r\n      tags: [\"api\", \"checkout\", \"500\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-007\",\r\n      timestamp: iso(2, 2),\r\n      source: \"edge-cache\",\r\n      summary: \"Cache miss storm\",\r\n      severity: \"warning\",\r\n      risk: \"medium\",\r\n      actionType: \"fix-applied\",\r\n      proposalId: \"prop-cache-warm\",\r\n      tags: [\"cache\", \"latency\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-008\",\r\n      timestamp: iso(3, 6),\r\n      source: \"worker-billing\",\r\n      summary: \"Billing worker retry storm\",\r\n      severity: \"error\",\r\n      risk: \"medium\",\r\n      actionType: \"rollback-executed\",\r\n      proposalId: \"prop-billing-throttle\",\r\n      tags: [\"billing\", \"queue\"],\r\n    },\r\n  ]\r\n\r\n  patternIncidents.forEach((inc) => recordIncident(inc))\r\n}\r\n\r\nexport function seedFixes() {\r\n  if (!isDev()) return\r\n  const fixes: IncidentRecord[] = [\r\n    {\r\n      id: \"seed-fix-001\",\r\n      timestamp: iso(0, 4),\r\n      source: \"worker-billing\",\r\n      summary: \"Billing worker retry storm\",\r\n      severity: \"warning\",\r\n      risk: \"medium\",\r\n      actionType: \"fix-applied\",\r\n      proposalId: \"prop-billing-throttle\",\r\n      tags: [\"billing\", \"stability\"],\r\n    },\r\n    {\r\n      id: \"seed-fix-002\",\r\n      timestamp: iso(1, 1),\r\n      source: \"edge-cache\",\r\n      summary: \"Cache miss storm\",\r\n      severity: \"info\",\r\n      risk: \"low\",\r\n      actionType: \"fix-applied\",\r\n      proposalId: \"prop-cache-warm\",\r\n      tags: [\"cache\", \"warmup\"],\r\n    },\r\n    {\r\n      id: \"seed-fix-003\",\r\n      timestamp: iso(2, 0),\r\n      source: \"/api/catalog\",\r\n      summary: \"Catalog schema drift detected\",\r\n      severity: \"warning\",\r\n      risk: \"medium\",\r\n      actionType: \"fix-applied\",\r\n      proposalId: \"prop-catalog-rollback\",\r\n      tags: [\"schema\", \"catalog\"],\r\n    },\r\n  ]\r\n\r\n  fixes.forEach((fix) => recordIncident(fix))\r\n}\r\n\r\nexport function seedRollbacks() {\r\n  if (!isDev()) return\r\n  const rollbacks: IncidentRecord[] = [\r\n    {\r\n      id: \"seed-rb-001\",\r\n      timestamp: iso(1, 5),\r\n      source: \"worker-billing\",\r\n      summary: \"Billing worker retry storm\",\r\n      severity: \"error\",\r\n      risk: \"high\",\r\n      actionType: \"rollback-executed\",\r\n      rollbackId: \"rb-billing-queue\",\r\n      proposalId: \"prop-billing-throttle\",\r\n      tags: [\"billing\", \"rollback\"],\r\n    },\r\n    {\r\n      id: \"seed-rb-002\",\r\n      timestamp: iso(2, 3),\r\n      source: \"/api/checkout\",\r\n      summary: \"API 500 spike on checkout\",\r\n      severity: \"error\",\r\n      risk: \"high\",\r\n      actionType: \"rollback-executed\",\r\n      rollbackId: \"rb-checkout-circuit\",\r\n      proposalId: \"prop-checkout-circuit\",\r\n      tags: [\"checkout\", \"rollback\"],\r\n    },\r\n    {\r\n      id: \"seed-rb-003\",\r\n      timestamp: iso(3, 1),\r\n      source: \"/api/catalog\",\r\n      summary: \"Catalog schema drift detected\",\r\n      severity: \"critical\",\r\n      risk: \"high\",\r\n      actionType: \"rollback-executed\",\r\n      rollbackId: \"rb-catalog-schema\",\r\n      proposalId: \"prop-catalog-rollback\",\r\n      tags: [\"schema\", \"rollback\"],\r\n    },\r\n  ]\r\n\r\n  rollbacks.forEach((rb) => recordIncident(rb))\r\n}\r\n\r\nexport function seedEarlyWarnings() {\r\n  if (!isDev()) return\r\n  seededWarnings.splice(0, seededWarnings.length, \r\n    {\r\n      id: \"warn-checkout-hotspot\",\r\n      title: \"Checkout API instability\",\r\n      severity: \"high\",\r\n      rationale: \"Multiple HTTP 500 events in checkout within 72 hours.\",\r\n      actions: [\"Hold new rollouts\", \"Run checkout circuit test\", \"Pre-warm cache for checkout flows\"],\r\n      window: \"immediate\",\r\n      source: \"foresight\",\r\n    },\r\n    {\r\n      id: \"warn-billing-retries\",\r\n      title: \"Billing worker retry surge\",\r\n      severity: \"medium\",\r\n      rationale: \"Retry volume trending up in billing worker queue.\",\r\n      actions: [\"Enable rate limits\", \"Add jitter to retries\", \"Inspect dead-letter queue\"],\r\n      window: \"short-term\",\r\n      source: \"foresight\",\r\n    },\r\n    {\r\n      id: \"warn-catalog-schema\",\r\n      title: \"Catalog schema drift risk\",\r\n      severity: \"medium\",\r\n      rationale: \"Schema drift detected on catalog service; rollbacks triggered previously.\",\r\n      actions: [\"Lock schema migrations\", \"Verify downstream consumers\", \"Capture snapshots before deploy\"],\r\n      window: \"mid-term\",\r\n      source: \"foresight\",\r\n    },\r\n  )\r\n}\r\n\r\nexport function seedForesightPredictions() {\r\n  if (!isDev()) return\r\n  seededPredictions.splice(0, seededPredictions.length,\r\n    {\r\n      id: \"pred-checkout-latency\",\r\n      likelihood: 0.32,\r\n      impact: \"medium\",\r\n      summary: \"Checkout latency may spike during peak due to cache churn.\",\r\n      drivers: [\"Edge cache misses\", \"Recent 500s on checkout\"],\r\n      horizon: \"short\",\r\n    },\r\n    {\r\n      id: \"pred-billing-rollback\",\r\n      likelihood: 0.28,\r\n      impact: \"high\",\r\n      summary: \"Billing worker may need rollback if retry storm persists.\",\r\n      drivers: [\"Queue depth growth\", \"Recent rollback in billing\"],\r\n      horizon: \"short\",\r\n    },\r\n    {\r\n      id: \"pred-catalog-drift\",\r\n      likelihood: 0.22,\r\n      impact: \"medium\",\r\n      summary: \"Catalog schema drift likely if upcoming deploy proceeds without validation.\",\r\n      drivers: [\"Recent schema rollback\", \"Missing contract tests\"],\r\n      horizon: \"mid\",\r\n    },\r\n  )\r\n}\r\n\r\nexport function seedCognitionBundle() {\r\n  if (!isDev()) return\r\n  seededCognition = {\r\n    confidences: [\r\n      { target: \"diagnosis\", score: 0.86, rationale: \"Recent fixes succeeded after circuit breakers.\" },\r\n      { target: \"prediction\", score: 0.78, rationale: \"Incident volume contained; forecast tempered.\" },\r\n      { target: \"warning\", score: 0.82, rationale: \"Checkout hotspot remains active.\" },\r\n    ],\r\n    rationales: [\r\n      {\r\n        summary: \"Pattern stability improving\",\r\n        factors: [\"Checkout errors reduced\", \"Cache warmup working\", \"Billing retries still monitored\"],\r\n      },\r\n    ],\r\n    traces: [\r\n      {\r\n        steps: [\"Ingest incidents\", \"Rank patterns\", \"Adjust for recent rollbacks\"],\r\n        conclusion: \"Confidence anchored by reduced failure rate and active guardrails\",\r\n      },\r\n    ],\r\n    drift: {\r\n      status: \"watch\",\r\n      indicators: [\"Tenant mix stable\", \"Checkout path still noisy\"],\r\n      driftScore: 0.28,\r\n    },\r\n    stability: {\r\n      score: 0.81,\r\n      factors: [\"Guardrails active\", \"Rollbacks succeeded\", \"Cache hit-rate recovering\"],\r\n    },\r\n  }\r\n}\r\n\r\nexport function seedAutonomySimulations() {\r\n  if (!isDev()) return\r\n  seededAutonomySimulations = [\r\n    {\r\n      id: \"sim-checkout-circuit\",\r\n      description: \"Dry-run checkout circuit breaker with staged rollout\",\r\n      risk: \"medium\",\r\n      outcome: \"pass\",\r\n      steps: [\"Detect 500 spike\", \"Trip circuit\", \"Validate fallback\"],\r\n      approvalsNeeded: 1,\r\n    },\r\n    {\r\n      id: \"sim-billing-throttle\",\r\n      description: \"Throttle billing worker retries during queue surge\",\r\n      risk: \"medium\",\r\n      outcome: \"pass\",\r\n      steps: [\"Measure queue depth\", \"Apply jitter\", \"Verify DLQ volume\"],\r\n      approvalsNeeded: 1,\r\n    },\r\n    {\r\n      id: \"sim-catalog-rollback\",\r\n      description: \"Rollback catalog migration with snapshot restore\",\r\n      risk: \"high\",\r\n      outcome: \"pass\",\r\n      steps: [\"Capture snapshot\", \"Run rollback\", \"Verify contract tests\"],\r\n      approvalsNeeded: 2,\r\n    },\r\n  ]\r\n\r\n  seededStrategyScores = [\r\n    { strategy: \"rollback-first\", score: 0.74, rationale: \"Fastest containment for catalog drift.\" },\r\n    { strategy: \"retry-then-rollback\", score: 0.69, rationale: \"Balances billing retry risk.\" },\r\n    { strategy: \"bluegreen-shift\", score: 0.72, rationale: \"Gradual checkout release keeps blast radius low.\" },\r\n  ]\r\n\r\n  seededReliabilityForecast = {\r\n    score: 0.84,\r\n    horizon: \"short\",\r\n    rationale: [\"Recent rollbacks succeeded\", \"Cache warmup stabilized latency\", \"Billing retries trending down\"],\r\n  }\r\n}\r\n\r\nexport function seedPrimeBriefing() {\r\n  if (!isDev()) return\r\n  seededPrimeBriefing = {\r\n    headline: \"Prime reliability briefing\",\r\n    highlights: [\r\n      \"Reliability score holding at 92\",\r\n      \"Checkout hotspot contained by circuit breaker\",\r\n      \"Catalog schema guarded by rollback plan\",\r\n    ],\r\n    reliabilityScore: 92,\r\n  }\r\n}\r\n\r\nexport function seedKnowledgeGraph() {\r\n  if (!isDev()) return\r\n  const articles: KnowledgeArticle[] = [\r\n    {\r\n      id: \"ka-cache-warmup\",\r\n      title: \"Edge cache warmup play\",\r\n      summary: \"Warm cache on deploy to avoid early latency spikes for checkout and catalog.\",\r\n      relatedDiagnosisIds: [],\r\n      relatedProposalIds: [\"prop-cache-warm\"],\r\n      relatedPatternKeys: [\"Cache miss storm\"],\r\n      createdAt: iso(2),\r\n      updatedAt: iso(1),\r\n      source: \"operator\",\r\n      tags: [\"cache\", \"latency\"],\r\n      body: \"Pre-warm critical paths, validate hit-rate, monitor 95th percentile latency post-release.\",\r\n    },\r\n    {\r\n      id: \"ka-billing-retries\",\r\n      title: \"Billing retry control\",\r\n      summary: \"Throttle billing worker retries to prevent queue storms and DLQ growth.\",\r\n      relatedDiagnosisIds: [],\r\n      relatedProposalIds: [\"prop-billing-throttle\"],\r\n      relatedPatternKeys: [\"Billing worker retry storm\"],\r\n      createdAt: iso(3),\r\n      updatedAt: iso(1),\r\n      source: \"operator\",\r\n      tags: [\"billing\", \"queues\"],\r\n      body: \"Add jitter, cap retries, and watch DLQ signal during incident windows.\",\r\n    },\r\n    {\r\n      id: \"ka-catalog-schema\",\r\n      title: \"Catalog schema rollback SOP\",\r\n      summary: \"Steps to revert catalog migrations safely with snapshot restores.\",\r\n      relatedDiagnosisIds: [],\r\n      relatedProposalIds: [\"prop-catalog-rollback\"],\r\n      relatedPatternKeys: [\"Catalog schema drift detected\"],\r\n      createdAt: iso(4),\r\n      updatedAt: iso(2),\r\n      source: \"operator\",\r\n      tags: [\"schema\", \"rollback\"],\r\n      body: \"Capture snapshot, run down migration, validate contracts, and verify search/indexers.\",\r\n    },\r\n  ]\r\n\r\n  articles.forEach((article) => {\r\n    seededKnowledgeArticles.push(article)\r\n    upsertKnowledgeArticle(article)\r\n  })\r\n}\r\n\r\nexport function seedRecommendations() {\r\n  if (!isDev()) return\r\n  seededRecs.splice(0, seededRecs.length,\r\n    {\r\n      title: \"Stabilize checkout path\",\r\n      summary: \"Pair checkout with circuit breaker tests before next release.\",\r\n      actions: [\"Run checkout rollback simulation\", \"Pre-warm cache for checkout\", \"Shadow traffic new release\"],\r\n    },\r\n    {\r\n      title: \"Tame billing retries\",\r\n      summary: \"Keep billing queue healthy by capping retries and inspecting DLQ daily.\",\r\n      actions: [\"Add jitter to retries\", \"Alert on DLQ growth\", \"Validate idempotency keys\"],\r\n    },\r\n    {\r\n      title: \"Guard catalog schema\",\r\n      summary: \"Require snapshot and contract tests before schema deploys.\",\r\n      actions: [\"Capture pre-deploy snapshot\", \"Run consumer contract suite\", \"Stage rollout with blue/green\"],\r\n    },\r\n  )\r\n}\r\n\r\nexport function runPrimeSeeder(): void {\r\n  if (!isDev() || seeded) return\r\n\r\n  seedIncidents()\r\n  seedPatterns()\r\n  seedFixes()\r\n  seedRollbacks()\r\n  seedEarlyWarnings()\r\n  seedForesightPredictions()\r\n  seedCognitionBundle()\r\n  seedAutonomySimulations()\r\n  seedPrimeBriefing()\r\n  seedKnowledgeGraph()\r\n  seedRecommendations()\r\n\r\n  seeded = true\r\n}\r\n\r\nexport function getSeededWarnings() {\r\n  return seededWarnings\r\n}\r\n\r\nexport function getSeededPredictions() {\r\n  return seededPredictions\r\n}\r\n\r\nexport function getSeededCognition() {\r\n  return seededCognition\r\n}\r\n\r\nexport function getSeededAutonomy() {\r\n  return {\r\n    autonomySimulations: seededAutonomySimulations,\r\n    strategyScores: seededStrategyScores,\r\n    reliabilityForecast: seededReliabilityForecast,\r\n  }\r\n}\r\n\r\nexport function getSeededPrimeBriefing() {\r\n  return seededPrimeBriefing\r\n}\r\n\r\nexport function getSeededRecommendations() {\r\n  return seededRecs\r\n}\r\n\r\nexport function getSeededKnowledgeArticles() {\r\n  return seededKnowledgeArticles\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 812, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/intel.ts"],"sourcesContent":["import { listLogs } from \"@/lib/audit\"\r\nimport { runPrimeSeeder } from \"@/lib/dev-seeder\"\r\nimport type {\r\n  AuditLogEntry,\r\n  Diagnosis,\r\n  IncidentPattern,\r\n  IncidentRecord,\r\n  IncidentSummary,\r\n  MonitoringEvent,\r\n  RemediationProposal,\r\n} from \"@/lib/types\"\r\n\r\nconst incidentStore: IncidentRecord[] = []\r\nconst MAX_INCIDENTS = 1000\r\n\r\nfunction makeId(prefix: string) {\r\n  return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 6)}`\r\n}\r\n\r\nfunction normalizeSource(event?: MonitoringEvent) {\r\n  return event?.context && typeof event.context.path === \"string\" ? String(event.context.path) : event?.source\r\n}\r\n\r\nfunction toIncidentFromAudit(log: AuditLogEntry): IncidentRecord {\r\n  return {\r\n    id: log.id,\r\n    timestamp: log.timestamp,\r\n    diagnosisId: log.diagnosisId,\r\n    proposalId: log.proposalId,\r\n    rollbackId: log.rollbackId,\r\n    snapshotId: log.snapshotId,\r\n    risk: log.risk,\r\n    actionType: log.actionType,\r\n    message: log.message,\r\n    tenantId: (log as IncidentRecord).tenantId,\r\n    siteId: (log as IncidentRecord).siteId,\r\n  }\r\n}\r\n\r\nexport function recordIncident(record: AuditLogEntry | Partial<IncidentRecord>) {\r\n  const entry: IncidentRecord = {\r\n    id: \"id\" in record && record.id ? record.id : makeId(\"incident\"),\r\n    timestamp: record.timestamp ?? new Date().toISOString(),\r\n    source: \"source\" in record ? record.source : undefined,\r\n    summary: \"summary\" in record ? record.summary : undefined,\r\n    eventId: \"eventId\" in record ? record.eventId : undefined,\r\n    snapshotId: \"snapshotId\" in record ? record.snapshotId : undefined,\r\n    diagnosisId: \"diagnosisId\" in record ? record.diagnosisId : undefined,\r\n    proposalId: \"proposalId\" in record ? record.proposalId : undefined,\r\n    rollbackId: \"rollbackId\" in record ? record.rollbackId : undefined,\r\n    risk: record.risk,\r\n    severity: \"severity\" in record ? record.severity : undefined,\r\n    kind: \"kind\" in record ? record.kind : undefined,\r\n    actionType: \"actionType\" in record ? record.actionType : undefined,\r\n    message: \"message\" in record ? record.message : undefined,\r\n    tags: \"tags\" in record && record.tags ? record.tags : [],\r\n    tenantId: \"tenantId\" in record ? record.tenantId : undefined,\r\n    siteId: \"siteId\" in record ? record.siteId : undefined,\r\n  }\r\n\r\n  incidentStore.push(entry)\r\n  if (incidentStore.length > MAX_INCIDENTS) {\r\n    incidentStore.splice(0, incidentStore.length - MAX_INCIDENTS)\r\n  }\r\n  return entry\r\n}\r\n\r\nfunction mergeIncidents(store: IncidentRecord[], logs: IncidentRecord[]): IncidentRecord[] {\r\n  const map = new Map<string, IncidentRecord>()\r\n  ;[...store, ...logs].forEach((inc) => {\r\n    if (!map.has(inc.id)) {\r\n      map.set(inc.id, inc)\r\n    }\r\n  })\r\n  return Array.from(map.values())\r\n}\r\n\r\nfunction allIncidents(): IncidentRecord[] {\r\n  const logIncidents = listLogs().map(toIncidentFromAudit)\r\n  const combined = mergeIncidents(incidentStore, logIncidents)\r\n  combined.sort((a, b) => (a.timestamp > b.timestamp ? -1 : 1))\r\n  return combined\r\n}\r\n\r\nexport function getRecentIncidents(limit = 100): IncidentRecord[] {\r\n  if (process.env.NODE_ENV === \"development\") {\r\n    runPrimeSeeder()\r\n  }\r\n  return allIncidents().slice(0, limit)\r\n}\r\n\r\nexport function deriveIncidentPatterns(records: IncidentRecord[], limit = 20): IncidentPattern[] {\r\n  const patterns: Record<string, IncidentPattern> = {}\r\n\r\n  const addPattern = (\r\n    key: string,\r\n    type: IncidentPattern[\"type\"],\r\n    record: IncidentRecord,\r\n    updater?: (p: IncidentPattern, rec: IncidentRecord) => void,\r\n  ) => {\r\n    if (!key) return\r\n    const scopeKey = `${record.tenantId ?? \"global\"}:${record.siteId ?? \"global\"}`\r\n    const mapKey = `${scopeKey}:${type}:${key}`\r\n    const existing = patterns[mapKey] ?? {\r\n      key,\r\n      type,\r\n      occurrences: 0,\r\n      lastSeenAt: record.timestamp,\r\n      relatedDiagnosisIds: [],\r\n      relatedProposalIds: [],\r\n      tenantId: record.tenantId,\r\n      siteId: record.siteId,\r\n    }\r\n\r\n    existing.occurrences += 1\r\n    if (record.timestamp > existing.lastSeenAt) existing.lastSeenAt = record.timestamp\r\n    if (record.diagnosisId && !existing.relatedDiagnosisIds?.includes(record.diagnosisId)) {\r\n      existing.relatedDiagnosisIds = [...(existing.relatedDiagnosisIds ?? []), record.diagnosisId]\r\n    }\r\n    if (record.proposalId && !existing.relatedProposalIds?.includes(record.proposalId)) {\r\n      existing.relatedProposalIds = [...(existing.relatedProposalIds ?? []), record.proposalId]\r\n    }\r\n    if (updater) updater(existing, record)\r\n    patterns[mapKey] = existing\r\n  }\r\n\r\n  records.forEach((rec) => {\r\n    if (rec.summary) addPattern(rec.summary, \"diagnosis\", rec)\r\n    if (rec.source) addPattern(rec.source, \"source\", rec)\r\n    if (rec.proposalId) {\r\n      addPattern(rec.proposalId, \"proposal\", rec, (p, r) => {\r\n        if (r.actionType === \"fix-applied\") p.successCount = (p.successCount ?? 0) + 1\r\n        if (r.actionType === \"fix-failed\") p.failureCount = (p.failureCount ?? 0) + 1\r\n        if (r.actionType === \"rollback-executed\") p.rollbackCount = (p.rollbackCount ?? 0) + 1\r\n        if (r.actionType === \"approval-required\") p.approvalCount = (p.approvalCount ?? 0) + 1\r\n      })\r\n    }\r\n  })\r\n\r\n  return Object.values(patterns)\r\n    .sort((a, b) => b.occurrences - a.occurrences)\r\n    .slice(0, limit)\r\n}\r\n\r\nexport function getIncidentPatterns(limit = 20): IncidentPattern[] {\r\n  return deriveIncidentPatterns(allIncidents(), limit)\r\n}\r\n\r\nexport function summarizeIncidents(records: IncidentRecord[]): IncidentSummary {\r\n  const summary: IncidentSummary = {\r\n    totalIncidents: records.length,\r\n    fixSuccessCount: 0,\r\n    fixFailureCount: 0,\r\n    rollbackCount: 0,\r\n    highRiskBlockedCount: 0,\r\n    approvalsRequiredCount: 0,\r\n    emailsSentCount: 0,\r\n    emailsFailedCount: 0,\r\n    topPatterns: [],\r\n  }\r\n\r\n  records.forEach((rec) => {\r\n    if (rec.actionType === \"fix-applied\") summary.fixSuccessCount += 1\r\n    if (rec.actionType === \"fix-failed\") summary.fixFailureCount += 1\r\n    if (rec.actionType === \"rollback-executed\") summary.rollbackCount += 1\r\n    if (rec.actionType === \"fix-rejected\") summary.highRiskBlockedCount += 1\r\n    if (rec.actionType === \"approval-required\") summary.approvalsRequiredCount = (summary.approvalsRequiredCount ?? 0) + 1\r\n    if (rec.actionType === \"email-sent\") summary.emailsSentCount = (summary.emailsSentCount ?? 0) + 1\r\n    if (rec.actionType === \"email-failed\") summary.emailsFailedCount = (summary.emailsFailedCount ?? 0) + 1\r\n  })\r\n\r\n  summary.topPatterns = deriveIncidentPatterns(records, 5)\r\n  return summary\r\n}\r\n\r\nexport function summarizeIncidentHistory(): IncidentSummary {\r\n  return summarizeIncidents(allIncidents())\r\n}\r\n\r\nexport function detectAnomalies(events: MonitoringEvent[]): { anomalies: MonitoringEvent[]; summary: string } {\r\n  if (!events.length) return { anomalies: [], summary: \"No events provided.\" }\r\n\r\n  const errors = events.filter((e) => e.severity === \"error\" || e.severity === \"critical\")\r\n  const latency = events.filter((e) => e.kind === \"latency\")\r\n  const uptimeIssues = events.filter((e) => e.kind === \"uptime\")\r\n\r\n  const anomalies: MonitoringEvent[] = []\r\n  const notes: string[] = []\r\n\r\n  if (errors.length >= 3 || errors.length >= Math.max(2, Math.ceil(events.length / 2))) {\r\n    anomalies.push(...errors)\r\n    notes.push(`Spike in errors/critical events (${errors.length})`)\r\n  }\r\n\r\n  const latencySources = new Set(latency.map((l) => normalizeSource(l)))\r\n  if (latency.length >= 3 || latencySources.size >= 2) {\r\n    anomalies.push(...latency)\r\n    notes.push(\"Elevated latency across multiple events\")\r\n  }\r\n\r\n  const uptimeBySource: Record<string, number> = {}\r\n  uptimeIssues.forEach((u) => {\r\n    const src = normalizeSource(u)\r\n    if (!src) return\r\n    uptimeBySource[src] = (uptimeBySource[src] ?? 0) + 1\r\n  })\r\n  Object.entries(uptimeBySource).forEach(([src, count]) => {\r\n    if (count >= 2) {\r\n      anomalies.push(...uptimeIssues.filter((u) => normalizeSource(u) === src))\r\n      notes.push(`Repeated uptime issues for ${src}`)\r\n    }\r\n  })\r\n\r\n  const summary = notes.length ? notes.join(\"; \") : \"No anomalies detected.\"\r\n  return { anomalies: Array.from(new Set(anomalies)), summary }\r\n}\r\n\r\nexport function getIncidentHotspots(limit = 10) {\r\n  return getIncidentPatterns(limit)\r\n}\r\n\r\nexport function summarizeIncidentHistoryForDiagnostics(diagnoses: Diagnosis[]) {\r\n  const recent = getRecentIncidents(300)\r\n  const summaryByDiag: Record<string, { occurrences: number; failures: number; successes: number }> = {}\r\n\r\n  diagnoses.forEach((diag) => {\r\n    const matches = recent.filter(\r\n      (rec) =>\r\n        rec.diagnosisId === diag.id ||\r\n        rec.summary === diag.summary ||\r\n        (rec.eventId && rec.eventId === diag.eventId) ||\r\n        (rec.source && diag.summary.includes(rec.source ?? \"\")),\r\n    )\r\n\r\n    if (!matches.length) return\r\n    const successes = matches.filter((m) => m.actionType === \"fix-applied\").length\r\n    const failures = matches.filter((m) => m.actionType === \"fix-failed\").length\r\n\r\n    summaryByDiag[diag.id] = {\r\n      occurrences: matches.length,\r\n      failures,\r\n      successes,\r\n    }\r\n  })\r\n\r\n  return summaryByDiag\r\n}\r\n\r\nexport function summarizeProposalHistory(proposals: RemediationProposal[]) {\r\n  const recent = getRecentIncidents(400)\r\n  const map: Record<string, { attempts: number; successes: number; failures: number; rollbacks: number }> = {}\r\n\r\n  proposals.forEach((proposal) => {\r\n    const matches = recent.filter((rec) => rec.proposalId === proposal.id || rec.diagnosisId === proposal.diagnosisId)\r\n    if (!matches.length) return\r\n\r\n    const successes = matches.filter((m) => m.actionType === \"fix-applied\").length\r\n    const failures = matches.filter((m) => m.actionType === \"fix-failed\").length\r\n    const rollbacks = matches.filter((m) => m.actionType === \"rollback-executed\").length\r\n\r\n    map[proposal.id] = {\r\n      attempts: matches.length,\r\n      successes,\r\n      failures,\r\n      rollbacks,\r\n    }\r\n  })\r\n\r\n  return map\r\n}\r\n\r\nexport function getRecentPatterns(limit = 10) {\r\n  return getIncidentPatterns(limit)\r\n}\r\n\r\nexport function summarizeIncidentHistoryForSources(events: MonitoringEvent[]) {\r\n  const sourceCounts: Record<string, number> = {}\r\n  events.forEach((evt) => {\r\n    const src = normalizeSource(evt)\r\n    if (src) sourceCounts[src] = (sourceCounts[src] ?? 0) + 1\r\n  })\r\n  return sourceCounts\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;;;AAWA,MAAM,gBAAkC,EAAE;AAC1C,MAAM,gBAAgB;AAEtB,SAAS,OAAO,MAAc;IAC5B,OAAO,GAAG,OAAO,CAAC,EAAE,KAAK,GAAG,GAAG,QAAQ,CAAC,IAAI,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;AACzF;AAEA,SAAS,gBAAgB,KAAuB;IAC9C,OAAO,OAAO,WAAW,OAAO,MAAM,OAAO,CAAC,IAAI,KAAK,WAAW,OAAO,MAAM,OAAO,CAAC,IAAI,IAAI,OAAO;AACxG;AAEA,SAAS,oBAAoB,GAAkB;IAC7C,OAAO;QACL,IAAI,IAAI,EAAE;QACV,WAAW,IAAI,SAAS;QACxB,aAAa,IAAI,WAAW;QAC5B,YAAY,IAAI,UAAU;QAC1B,YAAY,IAAI,UAAU;QAC1B,YAAY,IAAI,UAAU;QAC1B,MAAM,IAAI,IAAI;QACd,YAAY,IAAI,UAAU;QAC1B,SAAS,IAAI,OAAO;QACpB,UAAU,AAAC,IAAuB,QAAQ;QAC1C,QAAQ,AAAC,IAAuB,MAAM;IACxC;AACF;AAEO,SAAS,eAAe,MAA+C;IAC5E,MAAM,QAAwB;QAC5B,IAAI,QAAQ,UAAU,OAAO,EAAE,GAAG,OAAO,EAAE,GAAG,OAAO;QACrD,WAAW,OAAO,SAAS,IAAI,IAAI,OAAO,WAAW;QACrD,QAAQ,YAAY,SAAS,OAAO,MAAM,GAAG;QAC7C,SAAS,aAAa,SAAS,OAAO,OAAO,GAAG;QAChD,SAAS,aAAa,SAAS,OAAO,OAAO,GAAG;QAChD,YAAY,gBAAgB,SAAS,OAAO,UAAU,GAAG;QACzD,aAAa,iBAAiB,SAAS,OAAO,WAAW,GAAG;QAC5D,YAAY,gBAAgB,SAAS,OAAO,UAAU,GAAG;QACzD,YAAY,gBAAgB,SAAS,OAAO,UAAU,GAAG;QACzD,MAAM,OAAO,IAAI;QACjB,UAAU,cAAc,SAAS,OAAO,QAAQ,GAAG;QACnD,MAAM,UAAU,SAAS,OAAO,IAAI,GAAG;QACvC,YAAY,gBAAgB,SAAS,OAAO,UAAU,GAAG;QACzD,SAAS,aAAa,SAAS,OAAO,OAAO,GAAG;QAChD,MAAM,UAAU,UAAU,OAAO,IAAI,GAAG,OAAO,IAAI,GAAG,EAAE;QACxD,UAAU,cAAc,SAAS,OAAO,QAAQ,GAAG;QACnD,QAAQ,YAAY,SAAS,OAAO,MAAM,GAAG;IAC/C;IAEA,cAAc,IAAI,CAAC;IACnB,IAAI,cAAc,MAAM,GAAG,eAAe;QACxC,cAAc,MAAM,CAAC,GAAG,cAAc,MAAM,GAAG;IACjD;IACA,OAAO;AACT;AAEA,SAAS,eAAe,KAAuB,EAAE,IAAsB;IACrE,MAAM,MAAM,IAAI;IACf;WAAI;WAAU;KAAK,CAAC,OAAO,CAAC,CAAC;QAC5B,IAAI,CAAC,IAAI,GAAG,CAAC,IAAI,EAAE,GAAG;YACpB,IAAI,GAAG,CAAC,IAAI,EAAE,EAAE;QAClB;IACF;IACA,OAAO,MAAM,IAAI,CAAC,IAAI,MAAM;AAC9B;AAEA,SAAS;IACP,MAAM,eAAe,IAAA,0HAAQ,IAAG,GAAG,CAAC;IACpC,MAAM,WAAW,eAAe,eAAe;IAC/C,SAAS,IAAI,CAAC,CAAC,GAAG,IAAO,EAAE,SAAS,GAAG,EAAE,SAAS,GAAG,CAAC,IAAI;IAC1D,OAAO;AACT;AAEO,SAAS,mBAAmB,QAAQ,GAAG;IAC5C,wCAA4C;QAC1C,IAAA,wIAAc;IAChB;IACA,OAAO,eAAe,KAAK,CAAC,GAAG;AACjC;AAEO,SAAS,uBAAuB,OAAyB,EAAE,QAAQ,EAAE;IAC1E,MAAM,WAA4C,CAAC;IAEnD,MAAM,aAAa,CACjB,KACA,MACA,QACA;QAEA,IAAI,CAAC,KAAK;QACV,MAAM,WAAW,GAAG,OAAO,QAAQ,IAAI,SAAS,CAAC,EAAE,OAAO,MAAM,IAAI,UAAU;QAC9E,MAAM,SAAS,GAAG,SAAS,CAAC,EAAE,KAAK,CAAC,EAAE,KAAK;QAC3C,MAAM,WAAW,QAAQ,CAAC,OAAO,IAAI;YACnC;YACA;YACA,aAAa;YACb,YAAY,OAAO,SAAS;YAC5B,qBAAqB,EAAE;YACvB,oBAAoB,EAAE;YACtB,UAAU,OAAO,QAAQ;YACzB,QAAQ,OAAO,MAAM;QACvB;QAEA,SAAS,WAAW,IAAI;QACxB,IAAI,OAAO,SAAS,GAAG,SAAS,UAAU,EAAE,SAAS,UAAU,GAAG,OAAO,SAAS;QAClF,IAAI,OAAO,WAAW,IAAI,CAAC,SAAS,mBAAmB,EAAE,SAAS,OAAO,WAAW,GAAG;YACrF,SAAS,mBAAmB,GAAG;mBAAK,SAAS,mBAAmB,IAAI,EAAE;gBAAG,OAAO,WAAW;aAAC;QAC9F;QACA,IAAI,OAAO,UAAU,IAAI,CAAC,SAAS,kBAAkB,EAAE,SAAS,OAAO,UAAU,GAAG;YAClF,SAAS,kBAAkB,GAAG;mBAAK,SAAS,kBAAkB,IAAI,EAAE;gBAAG,OAAO,UAAU;aAAC;QAC3F;QACA,IAAI,SAAS,QAAQ,UAAU;QAC/B,QAAQ,CAAC,OAAO,GAAG;IACrB;IAEA,QAAQ,OAAO,CAAC,CAAC;QACf,IAAI,IAAI,OAAO,EAAE,WAAW,IAAI,OAAO,EAAE,aAAa;QACtD,IAAI,IAAI,MAAM,EAAE,WAAW,IAAI,MAAM,EAAE,UAAU;QACjD,IAAI,IAAI,UAAU,EAAE;YAClB,WAAW,IAAI,UAAU,EAAE,YAAY,KAAK,CAAC,GAAG;gBAC9C,IAAI,EAAE,UAAU,KAAK,eAAe,EAAE,YAAY,GAAG,CAAC,EAAE,YAAY,IAAI,CAAC,IAAI;gBAC7E,IAAI,EAAE,UAAU,KAAK,cAAc,EAAE,YAAY,GAAG,CAAC,EAAE,YAAY,IAAI,CAAC,IAAI;gBAC5E,IAAI,EAAE,UAAU,KAAK,qBAAqB,EAAE,aAAa,GAAG,CAAC,EAAE,aAAa,IAAI,CAAC,IAAI;gBACrF,IAAI,EAAE,UAAU,KAAK,qBAAqB,EAAE,aAAa,GAAG,CAAC,EAAE,aAAa,IAAI,CAAC,IAAI;YACvF;QACF;IACF;IAEA,OAAO,OAAO,MAAM,CAAC,UAClB,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,WAAW,GAAG,EAAE,WAAW,EAC5C,KAAK,CAAC,GAAG;AACd;AAEO,SAAS,oBAAoB,QAAQ,EAAE;IAC5C,OAAO,uBAAuB,gBAAgB;AAChD;AAEO,SAAS,mBAAmB,OAAyB;IAC1D,MAAM,UAA2B;QAC/B,gBAAgB,QAAQ,MAAM;QAC9B,iBAAiB;QACjB,iBAAiB;QACjB,eAAe;QACf,sBAAsB;QACtB,wBAAwB;QACxB,iBAAiB;QACjB,mBAAmB;QACnB,aAAa,EAAE;IACjB;IAEA,QAAQ,OAAO,CAAC,CAAC;QACf,IAAI,IAAI,UAAU,KAAK,eAAe,QAAQ,eAAe,IAAI;QACjE,IAAI,IAAI,UAAU,KAAK,cAAc,QAAQ,eAAe,IAAI;QAChE,IAAI,IAAI,UAAU,KAAK,qBAAqB,QAAQ,aAAa,IAAI;QACrE,IAAI,IAAI,UAAU,KAAK,gBAAgB,QAAQ,oBAAoB,IAAI;QACvE,IAAI,IAAI,UAAU,KAAK,qBAAqB,QAAQ,sBAAsB,GAAG,CAAC,QAAQ,sBAAsB,IAAI,CAAC,IAAI;QACrH,IAAI,IAAI,UAAU,KAAK,cAAc,QAAQ,eAAe,GAAG,CAAC,QAAQ,eAAe,IAAI,CAAC,IAAI;QAChG,IAAI,IAAI,UAAU,KAAK,gBAAgB,QAAQ,iBAAiB,GAAG,CAAC,QAAQ,iBAAiB,IAAI,CAAC,IAAI;IACxG;IAEA,QAAQ,WAAW,GAAG,uBAAuB,SAAS;IACtD,OAAO;AACT;AAEO,SAAS;IACd,OAAO,mBAAmB;AAC5B;AAEO,SAAS,gBAAgB,MAAyB;IACvD,IAAI,CAAC,OAAO,MAAM,EAAE,OAAO;QAAE,WAAW,EAAE;QAAE,SAAS;IAAsB;IAE3E,MAAM,SAAS,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,QAAQ,KAAK,WAAW,EAAE,QAAQ,KAAK;IAC7E,MAAM,UAAU,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,IAAI,KAAK;IAChD,MAAM,eAAe,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,IAAI,KAAK;IAErD,MAAM,YAA+B,EAAE;IACvC,MAAM,QAAkB,EAAE;IAE1B,IAAI,OAAO,MAAM,IAAI,KAAK,OAAO,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK,IAAI,CAAC,OAAO,MAAM,GAAG,KAAK;QACpF,UAAU,IAAI,IAAI;QAClB,MAAM,IAAI,CAAC,CAAC,iCAAiC,EAAE,OAAO,MAAM,CAAC,CAAC,CAAC;IACjE;IAEA,MAAM,iBAAiB,IAAI,IAAI,QAAQ,GAAG,CAAC,CAAC,IAAM,gBAAgB;IAClE,IAAI,QAAQ,MAAM,IAAI,KAAK,eAAe,IAAI,IAAI,GAAG;QACnD,UAAU,IAAI,IAAI;QAClB,MAAM,IAAI,CAAC;IACb;IAEA,MAAM,iBAAyC,CAAC;IAChD,aAAa,OAAO,CAAC,CAAC;QACpB,MAAM,MAAM,gBAAgB;QAC5B,IAAI,CAAC,KAAK;QACV,cAAc,CAAC,IAAI,GAAG,CAAC,cAAc,CAAC,IAAI,IAAI,CAAC,IAAI;IACrD;IACA,OAAO,OAAO,CAAC,gBAAgB,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM;QAClD,IAAI,SAAS,GAAG;YACd,UAAU,IAAI,IAAI,aAAa,MAAM,CAAC,CAAC,IAAM,gBAAgB,OAAO;YACpE,MAAM,IAAI,CAAC,CAAC,2BAA2B,EAAE,KAAK;QAChD;IACF;IAEA,MAAM,UAAU,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,QAAQ;IAClD,OAAO;QAAE,WAAW,MAAM,IAAI,CAAC,IAAI,IAAI;QAAa;IAAQ;AAC9D;AAEO,SAAS,oBAAoB,QAAQ,EAAE;IAC5C,OAAO,oBAAoB;AAC7B;AAEO,SAAS,uCAAuC,SAAsB;IAC3E,MAAM,SAAS,mBAAmB;IAClC,MAAM,gBAA8F,CAAC;IAErG,UAAU,OAAO,CAAC,CAAC;QACjB,MAAM,UAAU,OAAO,MAAM,CAC3B,CAAC,MACC,IAAI,WAAW,KAAK,KAAK,EAAE,IAC3B,IAAI,OAAO,KAAK,KAAK,OAAO,IAC3B,IAAI,OAAO,IAAI,IAAI,OAAO,KAAK,KAAK,OAAO,IAC3C,IAAI,MAAM,IAAI,KAAK,OAAO,CAAC,QAAQ,CAAC,IAAI,MAAM,IAAI;QAGvD,IAAI,CAAC,QAAQ,MAAM,EAAE;QACrB,MAAM,YAAY,QAAQ,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,eAAe,MAAM;QAC9E,MAAM,WAAW,QAAQ,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,cAAc,MAAM;QAE5E,aAAa,CAAC,KAAK,EAAE,CAAC,GAAG;YACvB,aAAa,QAAQ,MAAM;YAC3B;YACA;QACF;IACF;IAEA,OAAO;AACT;AAEO,SAAS,yBAAyB,SAAgC;IACvE,MAAM,SAAS,mBAAmB;IAClC,MAAM,MAAoG,CAAC;IAE3G,UAAU,OAAO,CAAC,CAAC;QACjB,MAAM,UAAU,OAAO,MAAM,CAAC,CAAC,MAAQ,IAAI,UAAU,KAAK,SAAS,EAAE,IAAI,IAAI,WAAW,KAAK,SAAS,WAAW;QACjH,IAAI,CAAC,QAAQ,MAAM,EAAE;QAErB,MAAM,YAAY,QAAQ,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,eAAe,MAAM;QAC9E,MAAM,WAAW,QAAQ,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,cAAc,MAAM;QAC5E,MAAM,YAAY,QAAQ,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,qBAAqB,MAAM;QAEpF,GAAG,CAAC,SAAS,EAAE,CAAC,GAAG;YACjB,UAAU,QAAQ,MAAM;YACxB;YACA;YACA;QACF;IACF;IAEA,OAAO;AACT;AAEO,SAAS,kBAAkB,QAAQ,EAAE;IAC1C,OAAO,oBAAoB;AAC7B;AAEO,SAAS,mCAAmC,MAAyB;IAC1E,MAAM,eAAuC,CAAC;IAC9C,OAAO,OAAO,CAAC,CAAC;QACd,MAAM,MAAM,gBAAgB;QAC5B,IAAI,KAAK,YAAY,CAAC,IAAI,GAAG,CAAC,YAAY,CAAC,IAAI,IAAI,CAAC,IAAI;IAC1D;IACA,OAAO;AACT"}},
    {"offset": {"line": 1081, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/playbooks.ts"],"sourcesContent":["import type { Diagnosis, IncidentPattern, Playbook } from \"@/lib/types\"\r\n\r\nconst playbooks: Playbook[] = [\r\n  {\r\n    id: \"pb-api-500\",\r\n    name: \"API 500 investigation\",\r\n    description: \"Systematic workflow for HTTP 500 or unhandled exceptions in APIs.\",\r\n    triggers: { diagnosisSummaryContains: \"500\" },\r\n    steps: [\r\n      { order: 1, description: \"Capture recent error logs and stack traces\" },\r\n      { order: 2, description: \"Check recent deploys or config changes affecting the API\" },\r\n      { order: 3, description: \"Replay failing request in staging with feature flags aligned\" },\r\n      { order: 4, description: \"Verify error handling, timeouts, and retries for upstream calls\" },\r\n    ],\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString(),\r\n  },\r\n  {\r\n    id: \"pb-latency\",\r\n    name: \"Latency spike in API\",\r\n    description: \"Steps to triage sudden latency increases.\",\r\n    triggers: { diagnosisSummaryContains: \"latency\" },\r\n    steps: [\r\n      { order: 1, description: \"Check p95/p99 latency and correlate with traffic changes\" },\r\n      { order: 2, description: \"Inspect dependency health (DB, cache, upstream services)\" },\r\n      { order: 3, description: \"Validate connection pooling, timeouts, and retry/backoff policies\" },\r\n      { order: 4, description: \"Profile hotspots or heavy queries; consider temporary scaling\" },\r\n    ],\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString(),\r\n  },\r\n  {\r\n    id: \"pb-uptime\",\r\n    name: \"Uptime degradation\",\r\n    description: \"Checklist for recurring uptime/health check failures.\",\r\n    triggers: { diagnosisSummaryContains: \"uptime\" },\r\n    steps: [\r\n      { order: 1, description: \"Validate health check endpoints and dependency reachability\" },\r\n      { order: 2, description: \"Review autoscaling events and resource saturation\" },\r\n      { order: 3, description: \"Check rollout/rollback status and partial deploys\" },\r\n      { order: 4, description: \"Set temporary circuit breakers or traffic shaping if needed\" },\r\n    ],\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString(),\r\n  },\r\n  {\r\n    id: \"pb-content-integrity\",\r\n    name: \"Content integrity checks\",\r\n    description: \"Steps for content mismatch or schema drift incidents.\",\r\n    triggers: { diagnosisSummaryContains: \"content\" },\r\n    steps: [\r\n      { order: 1, description: \"Compare payload/schema versions across services\" },\r\n      { order: 2, description: \"Validate cache invalidation and propagation\" },\r\n      { order: 3, description: \"Replay affected content through staging to reproduce\" },\r\n      { order: 4, description: \"Add temporary guards for malformed inputs\" },\r\n    ],\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString(),\r\n  },\r\n]\r\n\r\nexport function listPlaybooks(): Playbook[] {\r\n  return [...playbooks]\r\n}\r\n\r\nfunction includes(haystack: string | undefined, needle: string | undefined) {\r\n  if (!haystack || !needle) return false\r\n  return haystack.toLowerCase().includes(needle.toLowerCase())\r\n}\r\n\r\nexport function matchPlaybooksForDiagnosis(diag: Diagnosis): Playbook[] {\r\n  return playbooks.filter((pb) => includes(diag.summary, pb.triggers?.diagnosisSummaryContains ?? \"\"))\r\n}\r\n\r\nexport function matchPlaybooksForPattern(pattern: IncidentPattern): Playbook[] {\r\n  return playbooks.filter((pb) => includes(pattern.key, pb.triggers?.patternKey ?? \"\") || includes(pattern.key, pb.triggers?.diagnosisSummaryContains ?? \"\"))\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAM,YAAwB;IAC5B;QACE,IAAI;QACJ,MAAM;QACN,aAAa;QACb,UAAU;YAAE,0BAA0B;QAAM;QAC5C,OAAO;YACL;gBAAE,OAAO;gBAAG,aAAa;YAA6C;YACtE;gBAAE,OAAO;gBAAG,aAAa;YAA2D;YACpF;gBAAE,OAAO;gBAAG,aAAa;YAA+D;YACxF;gBAAE,OAAO;gBAAG,aAAa;YAAkE;SAC5F;QACD,WAAW,IAAI,OAAO,WAAW;QACjC,WAAW,IAAI,OAAO,WAAW;IACnC;IACA;QACE,IAAI;QACJ,MAAM;QACN,aAAa;QACb,UAAU;YAAE,0BAA0B;QAAU;QAChD,OAAO;YACL;gBAAE,OAAO;gBAAG,aAAa;YAA2D;YACpF;gBAAE,OAAO;gBAAG,aAAa;YAA2D;YACpF;gBAAE,OAAO;gBAAG,aAAa;YAAoE;YAC7F;gBAAE,OAAO;gBAAG,aAAa;YAAgE;SAC1F;QACD,WAAW,IAAI,OAAO,WAAW;QACjC,WAAW,IAAI,OAAO,WAAW;IACnC;IACA;QACE,IAAI;QACJ,MAAM;QACN,aAAa;QACb,UAAU;YAAE,0BAA0B;QAAS;QAC/C,OAAO;YACL;gBAAE,OAAO;gBAAG,aAAa;YAA8D;YACvF;gBAAE,OAAO;gBAAG,aAAa;YAAoD;YAC7E;gBAAE,OAAO;gBAAG,aAAa;YAAoD;YAC7E;gBAAE,OAAO;gBAAG,aAAa;YAA8D;SACxF;QACD,WAAW,IAAI,OAAO,WAAW;QACjC,WAAW,IAAI,OAAO,WAAW;IACnC;IACA;QACE,IAAI;QACJ,MAAM;QACN,aAAa;QACb,UAAU;YAAE,0BAA0B;QAAU;QAChD,OAAO;YACL;gBAAE,OAAO;gBAAG,aAAa;YAAkD;YAC3E;gBAAE,OAAO;gBAAG,aAAa;YAA8C;YACvE;gBAAE,OAAO;gBAAG,aAAa;YAAuD;YAChF;gBAAE,OAAO;gBAAG,aAAa;YAA4C;SACtE;QACD,WAAW,IAAI,OAAO,WAAW;QACjC,WAAW,IAAI,OAAO,WAAW;IACnC;CACD;AAEM,SAAS;IACd,OAAO;WAAI;KAAU;AACvB;AAEA,SAAS,SAAS,QAA4B,EAAE,MAA0B;IACxE,IAAI,CAAC,YAAY,CAAC,QAAQ,OAAO;IACjC,OAAO,SAAS,WAAW,GAAG,QAAQ,CAAC,OAAO,WAAW;AAC3D;AAEO,SAAS,2BAA2B,IAAe;IACxD,OAAO,UAAU,MAAM,CAAC,CAAC,KAAO,SAAS,KAAK,OAAO,EAAE,GAAG,QAAQ,EAAE,4BAA4B;AAClG;AAEO,SAAS,yBAAyB,OAAwB;IAC/D,OAAO,UAAU,MAAM,CAAC,CAAC,KAAO,SAAS,QAAQ,GAAG,EAAE,GAAG,QAAQ,EAAE,cAAc,OAAO,SAAS,QAAQ,GAAG,EAAE,GAAG,QAAQ,EAAE,4BAA4B;AACzJ"}},
    {"offset": {"line": 1222, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/voice.ts"],"sourcesContent":["import type { IncidentSummary, VoiceSummary } from \"@/lib/types\"\r\n\r\nexport function buildVoiceSummaryFromIncidents(summary: IncidentSummary): VoiceSummary {\r\n  const bullets: string[] = []\r\n  const recommended: string[] = []\r\n\r\n  if (summary.totalIncidents === 0) {\r\n    bullets.push(\"No incidents detected in the current window.\")\r\n    bullets.push(\"No fixes were required  stability remains high.\")\r\n    recommended.push(\"Maintain routine monitoring.\")\r\n    return {\r\n      title: \"System Status: All Clear\",\r\n      bullets,\r\n      recommendedActions: recommended,\r\n      timeframe: \"current window\",\r\n    }\r\n  }\r\n\r\n  const topPatterns = summary.topPatterns.slice(0, 3)\r\n  const hasFailures = summary.fixFailureCount > 0 || summary.rollbackCount > 0\r\n\r\n  if (!hasFailures) {\r\n    bullets.push(`Incidents observed: ${summary.totalIncidents}. Fix successes: ${summary.fixSuccessCount}.`)\r\n    bullets.push(\"No failed fixes or rollbacks in this window.\")\r\n    if (topPatterns.length) {\r\n      const names = topPatterns.map((p) => `${p.key} (${p.occurrences}x)`).join(\", \")\r\n      bullets.push(`Recurring patterns in view: ${names}.`)\r\n    }\r\n    recommended.push(\"Review recent fixes to confirm expected outcomes.\")\r\n    return {\r\n      title: \"System Status: Stable with Activity\",\r\n      bullets,\r\n      recommendedActions: recommended,\r\n      timeframe: \"current window\",\r\n    }\r\n  }\r\n\r\n  bullets.push(`Incidents observed: ${summary.totalIncidents}. Failures: ${summary.fixFailureCount}. Rollbacks: ${summary.rollbackCount}.`)\r\n  if (summary.highRiskBlockedCount) bullets.push(`High-risk actions blocked: ${summary.highRiskBlockedCount}.`)\r\n  if (topPatterns.length) {\r\n    const names = topPatterns.map((p) => `${p.key} (${p.occurrences}x)`).join(\", \")\r\n    bullets.push(`Patterns influencing outcomes: ${names}.`)\r\n  }\r\n  if (summary.approvalsRequiredCount) bullets.push(`Pending approvals: ${summary.approvalsRequiredCount}.`)\r\n  if (summary.emailsFailedCount) bullets.push(`Email delivery issues detected: ${summary.emailsFailedCount}.`)\r\n\r\n  recommended.push(\"Review recent failures and rollbacks.\")\r\n  if (summary.highRiskBlockedCount) recommended.push(\"Confirm that high-risk actions were correctly blocked.\")\r\n  if (topPatterns.length) recommended.push(`Focus remediation on: ${topPatterns.map((p) => p.key).join(\", \")}.`)\r\n\r\n  return {\r\n    title: \"System Status: Attention Recommended\",\r\n    bullets,\r\n    recommendedActions: recommended,\r\n    timeframe: \"current window\",\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAEO,SAAS,+BAA+B,OAAwB;IACrE,MAAM,UAAoB,EAAE;IAC5B,MAAM,cAAwB,EAAE;IAEhC,IAAI,QAAQ,cAAc,KAAK,GAAG;QAChC,QAAQ,IAAI,CAAC;QACb,QAAQ,IAAI,CAAC;QACb,YAAY,IAAI,CAAC;QACjB,OAAO;YACL,OAAO;YACP;YACA,oBAAoB;YACpB,WAAW;QACb;IACF;IAEA,MAAM,cAAc,QAAQ,WAAW,CAAC,KAAK,CAAC,GAAG;IACjD,MAAM,cAAc,QAAQ,eAAe,GAAG,KAAK,QAAQ,aAAa,GAAG;IAE3E,IAAI,CAAC,aAAa;QAChB,QAAQ,IAAI,CAAC,CAAC,oBAAoB,EAAE,QAAQ,cAAc,CAAC,iBAAiB,EAAE,QAAQ,eAAe,CAAC,CAAC,CAAC;QACxG,QAAQ,IAAI,CAAC;QACb,IAAI,YAAY,MAAM,EAAE;YACtB,MAAM,QAAQ,YAAY,GAAG,CAAC,CAAC,IAAM,GAAG,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,WAAW,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC;YAC1E,QAAQ,IAAI,CAAC,CAAC,4BAA4B,EAAE,MAAM,CAAC,CAAC;QACtD;QACA,YAAY,IAAI,CAAC;QACjB,OAAO;YACL,OAAO;YACP;YACA,oBAAoB;YACpB,WAAW;QACb;IACF;IAEA,QAAQ,IAAI,CAAC,CAAC,oBAAoB,EAAE,QAAQ,cAAc,CAAC,YAAY,EAAE,QAAQ,eAAe,CAAC,aAAa,EAAE,QAAQ,aAAa,CAAC,CAAC,CAAC;IACxI,IAAI,QAAQ,oBAAoB,EAAE,QAAQ,IAAI,CAAC,CAAC,2BAA2B,EAAE,QAAQ,oBAAoB,CAAC,CAAC,CAAC;IAC5G,IAAI,YAAY,MAAM,EAAE;QACtB,MAAM,QAAQ,YAAY,GAAG,CAAC,CAAC,IAAM,GAAG,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,WAAW,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC;QAC1E,QAAQ,IAAI,CAAC,CAAC,+BAA+B,EAAE,MAAM,CAAC,CAAC;IACzD;IACA,IAAI,QAAQ,sBAAsB,EAAE,QAAQ,IAAI,CAAC,CAAC,mBAAmB,EAAE,QAAQ,sBAAsB,CAAC,CAAC,CAAC;IACxG,IAAI,QAAQ,iBAAiB,EAAE,QAAQ,IAAI,CAAC,CAAC,gCAAgC,EAAE,QAAQ,iBAAiB,CAAC,CAAC,CAAC;IAE3G,YAAY,IAAI,CAAC;IACjB,IAAI,QAAQ,oBAAoB,EAAE,YAAY,IAAI,CAAC;IACnD,IAAI,YAAY,MAAM,EAAE,YAAY,IAAI,CAAC,CAAC,sBAAsB,EAAE,YAAY,GAAG,CAAC,CAAC,IAAM,EAAE,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;IAE7G,OAAO;QACL,OAAO;QACP;QACA,oBAAoB;QACpB,WAAW;IACb;AACF"}},
    {"offset": {"line": 1279, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/trends.ts"],"sourcesContent":["import type { IncidentRecord, SimpleTrend } from \"@/lib/types\"\r\n\r\nfunction sliceHalves(records: IncidentRecord[]) {\r\n  const midpoint = Math.floor(records.length / 2)\r\n  const first = records.slice(0, midpoint)\r\n  const second = records.slice(midpoint)\r\n  return { first, second }\r\n}\r\n\r\nexport function inferIncidentTrends(history: IncidentRecord[]): SimpleTrend[] {\r\n  if (!history.length || history.length < 6) return []\r\n\r\n  const { first, second } = sliceHalves(history)\r\n  const firstCount = first.length\r\n  const secondCount = second.length\r\n\r\n  const ratio = firstCount === 0 ? secondCount : secondCount / Math.max(1, firstCount)\r\n\r\n  let direction: SimpleTrend[\"direction\"] = \"flat\"\r\n  if (ratio > 1.2) direction = \"up\"\r\n  else if (ratio < 0.8) direction = \"down\"\r\n\r\n  const confidenceBase = Math.min(1, history.length / 40)\r\n  const confidence = Number(confidenceBase.toFixed(2))\r\n\r\n  return [\r\n    {\r\n      label: \"incident-volume\",\r\n      direction,\r\n      confidence,\r\n    },\r\n  ]\r\n}\r\n"],"names":[],"mappings":";;;;AAEA,SAAS,YAAY,OAAyB;IAC5C,MAAM,WAAW,KAAK,KAAK,CAAC,QAAQ,MAAM,GAAG;IAC7C,MAAM,QAAQ,QAAQ,KAAK,CAAC,GAAG;IAC/B,MAAM,SAAS,QAAQ,KAAK,CAAC;IAC7B,OAAO;QAAE;QAAO;IAAO;AACzB;AAEO,SAAS,oBAAoB,OAAyB;IAC3D,IAAI,CAAC,QAAQ,MAAM,IAAI,QAAQ,MAAM,GAAG,GAAG,OAAO,EAAE;IAEpD,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,YAAY;IACtC,MAAM,aAAa,MAAM,MAAM;IAC/B,MAAM,cAAc,OAAO,MAAM;IAEjC,MAAM,QAAQ,eAAe,IAAI,cAAc,cAAc,KAAK,GAAG,CAAC,GAAG;IAEzE,IAAI,YAAsC;IAC1C,IAAI,QAAQ,KAAK,YAAY;SACxB,IAAI,QAAQ,KAAK,YAAY;IAElC,MAAM,iBAAiB,KAAK,GAAG,CAAC,GAAG,QAAQ,MAAM,GAAG;IACpD,MAAM,aAAa,OAAO,eAAe,OAAO,CAAC;IAEjD,OAAO;QACL;YACE,OAAO;YACP;YACA;QACF;KACD;AACH"}},
    {"offset": {"line": 1315, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/foresight.ts"],"sourcesContent":["import { getIncidentHotspots, getRecentIncidents, summarizeIncidentHistory } from \"@/lib/intel\"\r\nimport type {\r\n  EarlyWarning,\r\n  ForesightPrediction,\r\n  IncidentPattern,\r\n  IncidentRecord,\r\n  IncidentSummary,\r\n  RiskLevel,\r\n  StabilityIndex,\r\n  SimpleTrend,\r\n} from \"@/lib/types\"\r\n\r\nfunction clampScore(value: number) {\r\n  return Math.max(0, Math.min(100, Math.round(value)))\r\n}\r\n\r\nfunction inferLevel(score: number): StabilityIndex[\"level\"] {\r\n  if (score >= 75) return \"calm\"\r\n  if (score >= 45) return \"watch\"\r\n  return \"critical\"\r\n}\r\n\r\nexport function computeStabilityIndex(summary?: IncidentSummary, trends?: SimpleTrend[]): StabilityIndex {\r\n  const now = new Date().toISOString()\r\n  if (!summary) {\r\n    return {\r\n      score: 80,\r\n      level: \"calm\",\r\n      factors: [\"No summary available; defaulting to calm.\"],\r\n      computedAt: now,\r\n    }\r\n  }\r\n\r\n  const baseScore = 100\r\n  const penaltyFailures = summary.fixFailureCount * 5\r\n  const penaltyRollbacks = summary.rollbackCount * 4\r\n  const penaltyHighRisk = summary.highRiskBlockedCount * 6\r\n  const penaltyIncidents = Math.max(0, summary.totalIncidents - 2) * 2\r\n\r\n  let score = baseScore - (penaltyFailures + penaltyRollbacks + penaltyHighRisk + penaltyIncidents)\r\n\r\n  const volumeTrend = trends?.find((t) => t.label === \"incident-volume\")\r\n  if (volumeTrend) {\r\n    if (volumeTrend.direction === \"up\") score -= Math.round(10 * volumeTrend.confidence)\r\n    if (volumeTrend.direction === \"down\") score += Math.round(6 * volumeTrend.confidence)\r\n  }\r\n\r\n  score = clampScore(score)\r\n\r\n  const factors: string[] = []\r\n  factors.push(`Incidents: ${summary.totalIncidents}`)\r\n  factors.push(`Failures: ${summary.fixFailureCount}, rollbacks: ${summary.rollbackCount}`)\r\n  if (summary.highRiskBlockedCount) factors.push(`High-risk blocks: ${summary.highRiskBlockedCount}`)\r\n  if (volumeTrend) factors.push(`Trend: ${volumeTrend.direction} (confidence ${volumeTrend.confidence})`)\r\n\r\n  return {\r\n    score,\r\n    level: inferLevel(score),\r\n    factors,\r\n    computedAt: now,\r\n  }\r\n}\r\n\r\nexport function detectPrecursors(incidents: IncidentRecord[], patterns: IncidentPattern[]): EarlyWarning[] {\r\n  const warnings: EarlyWarning[] = []\r\n  const recentCritical = incidents.filter((i) => i.severity === \"critical\").slice(0, 3)\r\n  if (recentCritical.length) {\r\n    warnings.push({\r\n      id: `warn-critical-${recentCritical[0].id}`,\r\n      title: \"Critical signals detected\",\r\n      severity: \"high\",\r\n      rationale: `${recentCritical.length} critical events observed in recent history.`,\r\n      actions: [\"Verify affected subsystems\", \"Prepare rollback safeguards\"],\r\n      window: \"immediate\",\r\n      source: \"foresight\",\r\n    })\r\n  }\r\n\r\n  const hotspots = patterns.filter((p) => p.occurrences >= 3).slice(0, 2)\r\n  if (hotspots.length) {\r\n    warnings.push({\r\n      id: `warn-hotspot-${hotspots[0].key}`,\r\n      title: \"Recurring hotspot emerging\",\r\n      severity: \"medium\",\r\n      rationale: hotspots.map((p) => `${p.key} (${p.occurrences}x)`).join(\"; \"),\r\n      actions: [\"Schedule deep-dive on hotspot\", \"Line up mitigation playbooks\"],\r\n      window: \"short-term\",\r\n      source: \"foresight\",\r\n    })\r\n  }\r\n\r\n  return warnings\r\n}\r\n\r\nexport function predictIncidentRisk(incidents: IncidentRecord[], patterns: IncidentPattern[]): ForesightPrediction[] {\r\n  const predictions: ForesightPrediction[] = []\r\n  const total = incidents.length\r\n  const failures = incidents.filter((i) => i.actionType === \"fix-failed\").length\r\n  const rollbacks = incidents.filter((i) => i.actionType === \"rollback-executed\").length\r\n\r\n  const likelihood = Math.min(0.95, total > 0 ? (failures + rollbacks + 1) / (total + 2) : 0.15)\r\n  const horizon: ForesightPrediction[\"horizon\"] = total > 20 ? \"mid\" : \"short\"\r\n  const drivers: string[] = []\r\n  if (failures) drivers.push(`Recent failures: ${failures}`)\r\n  if (rollbacks) drivers.push(`Rollbacks: ${rollbacks}`)\r\n  const topPattern = patterns[0]\r\n  if (topPattern) drivers.push(`Hot pattern: ${topPattern.key}`)\r\n\r\n  predictions.push({\r\n    id: `pred-${Date.now().toString(36)}`,\r\n    likelihood: Number(likelihood.toFixed(2)),\r\n    impact: failures + rollbacks > 2 ? \"high\" : failures > 0 ? \"medium\" : \"low\",\r\n    summary: \"Upcoming incident risk based on recent instability signals.\",\r\n    drivers,\r\n    horizon,\r\n  })\r\n\r\n  return predictions\r\n}\r\n\r\nexport function generateEarlyWarnings() {\r\n  const incidents = getRecentIncidents(120)\r\n  const patterns = getIncidentHotspots(10)\r\n  const summary = summarizeIncidentHistory()\r\n  const warnings = detectPrecursors(incidents, patterns)\r\n  const predictions = predictIncidentRisk(incidents, patterns)\r\n  const stability = computeStabilityIndex(summary)\r\n\r\n  return { stability, warnings, predictions }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1444, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/prime-cognition.ts"],"sourcesContent":["import type {\r\n  CognitionConfidence,\r\n  CognitionRationale,\r\n  CognitionTrace,\r\n  CognitiveDriftReport,\r\n  CognitiveStabilityScore,\r\n  IncidentPattern,\r\n  IncidentRecord,\r\n  PrimeCognitionBundle,\r\n} from \"@/lib/types\"\r\n\r\nfunction scoreFromIncidents(incidents: IncidentRecord[]): number {\r\n  if (!incidents.length) return 0.82\r\n  const failures = incidents.filter((i) => i.actionType === \"fix-failed\").length\r\n  const rollbacks = incidents.filter((i) => i.actionType === \"rollback-executed\").length\r\n  const total = incidents.length\r\n  const penalty = (failures * 0.08 + rollbacks * 0.05) / Math.max(1, total)\r\n  return Number(Math.max(0.35, 0.9 - penalty).toFixed(2))\r\n}\r\n\r\nfunction buildConfidences(incidents: IncidentRecord[], patterns: IncidentPattern[]): CognitionConfidence[] {\r\n  const score = scoreFromIncidents(incidents)\r\n  const list: CognitionConfidence[] = []\r\n  list.push({ target: \"diagnosis\", score, rationale: \"Based on recent stability and failure ratio\" })\r\n  list.push({ target: \"prediction\", score: Number((score - 0.05).toFixed(2)), rationale: \"Adjusted for forecast uncertainty\" })\r\n  if (patterns.length) {\r\n    list.push({ target: \"warning\", score: Number(Math.min(0.95, score + 0.05).toFixed(2)), rationale: \"Hotspot alignment\" })\r\n  }\r\n  return list\r\n}\r\n\r\nfunction buildRationales(patterns: IncidentPattern[]): CognitionRationale[] {\r\n  if (!patterns.length) return [{ summary: \"Sparse signals\", factors: [\"No strong recurring patterns detected\"] }]\r\n  const top = patterns[0]\r\n  return [\r\n    {\r\n      summary: \"Pattern-driven confidence\",\r\n      factors: [\r\n        `Top pattern ${top.key} seen ${top.occurrences} times`,\r\n        `Pattern reliability hints: success ${top.successCount ?? 0}, failure ${top.failureCount ?? 0}`,\r\n      ],\r\n    },\r\n  ]\r\n}\r\n\r\nfunction buildTrace(patterns: IncidentPattern[]): CognitionTrace {\r\n  const steps = [] as string[]\r\n  if (!patterns.length) {\r\n    steps.push(\"Gathered incidents\")\r\n    steps.push(\"No dominant pattern; fallback to base confidence\")\r\n    return { steps, conclusion: \"Confidence based on low-signal environment\" }\r\n  }\r\n  const top = patterns[0]\r\n  steps.push(\"Gathered incidents\")\r\n  steps.push(`Identified hotspot ${top.key}`)\r\n  steps.push(\"Adjusted confidence using hotspot weight\")\r\n  return { steps, conclusion: \"Confidence guided by hotspot presence\" }\r\n}\r\n\r\nfunction detectDrift(incidents: IncidentRecord[], patterns: IncidentPattern[]): CognitiveDriftReport {\r\n  const recent = incidents.slice(0, 30)\r\n  const uniqueSources = new Set(recent.map((i) => i.source).filter(Boolean))\r\n  const driftScore = Number(Math.min(1, uniqueSources.size / 20).toFixed(2))\r\n  const status: CognitiveDriftReport[\"status\"] = driftScore > 0.4 ? \"drifting\" : driftScore > 0.25 ? \"watch\" : \"stable\"\r\n  const indicators: string[] = []\r\n  indicators.push(`Unique sources (recent): ${uniqueSources.size}`)\r\n  if (patterns.length) indicators.push(`Top pattern: ${patterns[0].key}`)\r\n  return { status, indicators, driftScore }\r\n}\r\n\r\nfunction buildStability(confidences: CognitionConfidence[]): CognitiveStabilityScore {\r\n  const avg = confidences.reduce((acc, c) => acc + c.score, 0) / Math.max(1, confidences.length)\r\n  const score = Number(Math.min(1, Math.max(0.35, avg))).toFixed(2)\r\n  return {\r\n    score: Number(score),\r\n    factors: [`Average confidence ${score}`, \"Deterministic scoring\", \"Bounded rationale\"],\r\n  }\r\n}\r\n\r\nexport function buildPrimeCognitionBundle(incidents: IncidentRecord[], patterns: IncidentPattern[]): PrimeCognitionBundle {\r\n  const confidences = buildConfidences(incidents, patterns)\r\n  const rationales = buildRationales(patterns)\r\n  const traces = [buildTrace(patterns)]\r\n  const drift = detectDrift(incidents, patterns)\r\n  const stability = buildStability(confidences)\r\n\r\n  return {\r\n    confidences,\r\n    rationales,\r\n    traces,\r\n    drift,\r\n    stability,\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1563, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/prime-autonomy.ts"],"sourcesContent":["import type { AutonomySimulation, FixStrategyScore, IncidentRecord, ReliabilityForecast, RiskLevel } from \"@/lib/types\"\r\n\r\nfunction riskFromString(risk?: RiskLevel): number {\r\n  if (risk === \"high\") return 0.8\r\n  if (risk === \"medium\") return 0.5\r\n  return 0.2\r\n}\r\n\r\nexport function simulateAutonomy(incidents: IncidentRecord[]): AutonomySimulation[] {\r\n  const sims: AutonomySimulation[] = []\r\n  const recent = incidents.slice(0, 5)\r\n  recent.forEach((inc, idx) => {\r\n    sims.push({\r\n      id: `sim-${inc.id}-${idx}`,\r\n      description: inc.summary ? `Dry-run mitigation for ${inc.summary}` : \"Dry-run mitigation\",\r\n      risk: inc.risk ?? \"medium\",\r\n      outcome: \"pass\",\r\n      steps: [\"Assess blast radius\", \"Simulate fix steps\", \"Validate rollback pre-checks\"],\r\n      approvalsNeeded: inc.risk === \"high\" ? 2 : 1,\r\n    })\r\n  })\r\n  if (!sims.length) {\r\n    sims.push({\r\n      id: \"sim-empty\",\r\n      description: \"Baseline autonomy dry-run\",\r\n      risk: \"low\",\r\n      outcome: \"uncertain\",\r\n      steps: [\"No incidents present\", \"Maintain guardrails\"],\r\n      approvalsNeeded: 0,\r\n    })\r\n  }\r\n  return sims\r\n}\r\n\r\nexport function scoreFixStrategies(incidents: IncidentRecord[]): FixStrategyScore[] {\r\n  const strategies = [\r\n    { name: \"rollback-first\", weight: 0.6 },\r\n    { name: \"retry-then-rollback\", weight: 0.7 },\r\n    { name: \"bluegreen-shift\", weight: 0.8 },\r\n  ]\r\n  return strategies.map((s, idx) => ({\r\n    strategy: s.name,\r\n    score: Number((s.weight - idx * 0.05).toFixed(2)),\r\n    rationale: \"Deterministic heuristic based on stability preference\",\r\n  }))\r\n}\r\n\r\nexport function forecastReliability(incidents: IncidentRecord[]): ReliabilityForecast {\r\n  const failureRate = incidents.filter((i) => i.actionType === \"fix-failed\").length / Math.max(1, incidents.length)\r\n  const rollbackRate = incidents.filter((i) => i.actionType === \"rollback-executed\").length / Math.max(1, incidents.length)\r\n  const score = Number(Math.max(0.4, 0.9 - failureRate * 0.6 - rollbackRate * 0.4).toFixed(2))\r\n  return {\r\n    score,\r\n    horizon: incidents.length > 30 ? \"mid\" : \"short\",\r\n    rationale: [\r\n      `Failure rate: ${failureRate.toFixed(2)}`,\r\n      `Rollback rate: ${rollbackRate.toFixed(2)}`,\r\n      \"Prefers conservative autonomy trajectory\",\r\n    ],\r\n  }\r\n}\r\n\r\nexport function computeAutonomyBundle(incidents: IncidentRecord[]) {\r\n  const autonomySimulations = simulateAutonomy(incidents)\r\n  const strategyScores = scoreFixStrategies(incidents)\r\n  const reliabilityForecast = forecastReliability(incidents)\r\n  return { autonomySimulations, strategyScores, reliabilityForecast }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAEA,SAAS,eAAe,IAAgB;IACtC,IAAI,SAAS,QAAQ,OAAO;IAC5B,IAAI,SAAS,UAAU,OAAO;IAC9B,OAAO;AACT;AAEO,SAAS,iBAAiB,SAA2B;IAC1D,MAAM,OAA6B,EAAE;IACrC,MAAM,SAAS,UAAU,KAAK,CAAC,GAAG;IAClC,OAAO,OAAO,CAAC,CAAC,KAAK;QACnB,KAAK,IAAI,CAAC;YACR,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,KAAK;YAC1B,aAAa,IAAI,OAAO,GAAG,CAAC,uBAAuB,EAAE,IAAI,OAAO,EAAE,GAAG;YACrE,MAAM,IAAI,IAAI,IAAI;YAClB,SAAS;YACT,OAAO;gBAAC;gBAAuB;gBAAsB;aAA+B;YACpF,iBAAiB,IAAI,IAAI,KAAK,SAAS,IAAI;QAC7C;IACF;IACA,IAAI,CAAC,KAAK,MAAM,EAAE;QAChB,KAAK,IAAI,CAAC;YACR,IAAI;YACJ,aAAa;YACb,MAAM;YACN,SAAS;YACT,OAAO;gBAAC;gBAAwB;aAAsB;YACtD,iBAAiB;QACnB;IACF;IACA,OAAO;AACT;AAEO,SAAS,mBAAmB,SAA2B;IAC5D,MAAM,aAAa;QACjB;YAAE,MAAM;YAAkB,QAAQ;QAAI;QACtC;YAAE,MAAM;YAAuB,QAAQ;QAAI;QAC3C;YAAE,MAAM;YAAmB,QAAQ;QAAI;KACxC;IACD,OAAO,WAAW,GAAG,CAAC,CAAC,GAAG,MAAQ,CAAC;YACjC,UAAU,EAAE,IAAI;YAChB,OAAO,OAAO,CAAC,EAAE,MAAM,GAAG,MAAM,IAAI,EAAE,OAAO,CAAC;YAC9C,WAAW;QACb,CAAC;AACH;AAEO,SAAS,oBAAoB,SAA2B;IAC7D,MAAM,cAAc,UAAU,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,cAAc,MAAM,GAAG,KAAK,GAAG,CAAC,GAAG,UAAU,MAAM;IAChH,MAAM,eAAe,UAAU,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,qBAAqB,MAAM,GAAG,KAAK,GAAG,CAAC,GAAG,UAAU,MAAM;IACxH,MAAM,QAAQ,OAAO,KAAK,GAAG,CAAC,KAAK,MAAM,cAAc,MAAM,eAAe,KAAK,OAAO,CAAC;IACzF,OAAO;QACL;QACA,SAAS,UAAU,MAAM,GAAG,KAAK,QAAQ;QACzC,WAAW;YACT,CAAC,cAAc,EAAE,YAAY,OAAO,CAAC,IAAI;YACzC,CAAC,eAAe,EAAE,aAAa,OAAO,CAAC,IAAI;YAC3C;SACD;IACH;AACF;AAEO,SAAS,sBAAsB,SAA2B;IAC/D,MAAM,sBAAsB,iBAAiB;IAC7C,MAAM,iBAAiB,mBAAmB;IAC1C,MAAM,sBAAsB,oBAAoB;IAChD,OAAO;QAAE;QAAqB;QAAgB;IAAoB;AACpE"}},
    {"offset": {"line": 1659, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/app/api/intel/summary/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport { getIncidentPatterns, getRecentIncidents, summarizeIncidentHistory } from \"@/lib/intel\"\r\nimport { matchPlaybooksForPattern } from \"@/lib/playbooks\"\r\nimport { buildVoiceSummaryFromIncidents } from \"@/lib/voice\"\r\nimport { inferIncidentTrends } from \"@/lib/trends\"\r\nimport { generateEarlyWarnings } from \"@/lib/foresight\"\r\nimport { buildPrimeCognitionBundle } from \"@/lib/prime-cognition\"\r\nimport { computeAutonomyBundle } from \"@/lib/prime-autonomy\"\r\n\r\nexport async function GET() {\r\n  const incidents = getRecentIncidents(100)\r\n  const patterns = getIncidentPatterns()\r\n  const summary = summarizeIncidentHistory()\r\n  const voiceSummary = buildVoiceSummaryFromIncidents(summary)\r\n  const trends = inferIncidentTrends(incidents)\r\n  const { stability, warnings, predictions } = generateEarlyWarnings()\r\n  const cognition = buildPrimeCognitionBundle(incidents, patterns)\r\n  const autonomyBundle = computeAutonomyBundle(incidents)\r\n\r\n  const matchedPlaybooks = Array.from(\r\n    new Map(\r\n      patterns\r\n        .slice(0, 5)\r\n        .flatMap((p) => matchPlaybooksForPattern(p))\r\n        .map((pb) => [pb.id, pb]),\r\n    ).values(),\r\n  )\r\n\r\n  return NextResponse.json({\r\n    incidents,\r\n    patterns,\r\n    summary,\r\n    voiceSummary,\r\n    trends,\r\n    stabilityIndex: stability,\r\n    earlyWarnings: warnings,\r\n    foresightPredictions: predictions,\r\n    cognition,\r\n    autonomySimulations: autonomyBundle.autonomySimulations,\r\n    strategyScores: autonomyBundle.strategyScores,\r\n    reliabilityForecast: autonomyBundle.reliabilityForecast,\r\n    playbooks: matchedPlaybooks,\r\n  })\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEO,eAAe;IACpB,MAAM,YAAY,IAAA,oIAAkB,EAAC;IACrC,MAAM,WAAW,IAAA,qIAAmB;IACpC,MAAM,UAAU,IAAA,0IAAwB;IACxC,MAAM,eAAe,IAAA,gJAA8B,EAAC;IACpD,MAAM,SAAS,IAAA,sIAAmB,EAAC;IACnC,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,WAAW,EAAE,GAAG,IAAA,2IAAqB;IAClE,MAAM,YAAY,IAAA,wJAAyB,EAAC,WAAW;IACvD,MAAM,iBAAiB,IAAA,mJAAqB,EAAC;IAE7C,MAAM,mBAAmB,MAAM,IAAI,CACjC,IAAI,IACF,SACG,KAAK,CAAC,GAAG,GACT,OAAO,CAAC,CAAC,IAAM,IAAA,8IAAwB,EAAC,IACxC,GAAG,CAAC,CAAC,KAAO;YAAC,GAAG,EAAE;YAAE;SAAG,GAC1B,MAAM;IAGV,OAAO,gRAAY,CAAC,IAAI,CAAC;QACvB;QACA;QACA;QACA;QACA;QACA,gBAAgB;QAChB,eAAe;QACf,sBAAsB;QACtB;QACA,qBAAqB,eAAe,mBAAmB;QACvD,gBAAgB,eAAe,cAAc;QAC7C,qBAAqB,eAAe,mBAAmB;QACvD,WAAW;IACb;AACF"}}]
}