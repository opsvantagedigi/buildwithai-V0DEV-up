{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/audit.ts"],"sourcesContent":["import type { AuditActionType, AuditLogEntry, RiskLevel } from \"@/lib/types\"\r\n\r\nconst auditLog: AuditLogEntry[] = []\r\n\r\nfunction makeId(prefix: string) {\r\n  return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 6)}`\r\n}\r\n\r\nexport function logAction(entry: Omit<AuditLogEntry, \"id\" | \"timestamp\">): AuditLogEntry {\r\n  const next: AuditLogEntry = {\r\n    ...entry,\r\n    id: makeId(\"audit\"),\r\n    timestamp: new Date().toISOString(),\r\n  }\r\n  auditLog.push(next)\r\n  return next\r\n}\r\n\r\nexport function listLogs(): AuditLogEntry[] {\r\n  return [...auditLog].sort((a, b) => (a.timestamp > b.timestamp ? -1 : 1))\r\n}\r\n\r\nexport function filterLogs(options: { risk?: RiskLevel; actionType?: AuditActionType } = {}): AuditLogEntry[] {\r\n  return listLogs().filter((log) => {\r\n    if (options.risk && log.risk !== options.risk) return false\r\n    if (options.actionType && log.actionType !== options.actionType) return false\r\n    return true\r\n  })\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAM,WAA4B,EAAE;AAEpC,SAAS,OAAO,MAAc;IAC5B,OAAO,GAAG,OAAO,CAAC,EAAE,KAAK,GAAG,GAAG,QAAQ,CAAC,IAAI,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;AACzF;AAEO,SAAS,UAAU,KAA8C;IACtE,MAAM,OAAsB;QAC1B,GAAG,KAAK;QACR,IAAI,OAAO;QACX,WAAW,IAAI,OAAO,WAAW;IACnC;IACA,SAAS,IAAI,CAAC;IACd,OAAO;AACT;AAEO,SAAS;IACd,OAAO;WAAI;KAAS,CAAC,IAAI,CAAC,CAAC,GAAG,IAAO,EAAE,SAAS,GAAG,EAAE,SAAS,GAAG,CAAC,IAAI;AACxE;AAEO,SAAS,WAAW,UAA8D,CAAC,CAAC;IACzF,OAAO,WAAW,MAAM,CAAC,CAAC;QACxB,IAAI,QAAQ,IAAI,IAAI,IAAI,IAAI,KAAK,QAAQ,IAAI,EAAE,OAAO;QACtD,IAAI,QAAQ,UAAU,IAAI,IAAI,UAAU,KAAK,QAAQ,UAAU,EAAE,OAAO;QACxE,OAAO;IACT;AACF"}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/knowledge.ts"],"sourcesContent":["import type { IncidentPattern, KnowledgeArticle } from \"@/lib/types\"\r\n\r\nconst knowledgeStore: KnowledgeArticle[] = []\r\n\r\nfunction makeId(prefix: string) {\r\n  return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 6)}`\r\n}\r\n\r\nexport function listKnowledgeArticles(limit?: number): KnowledgeArticle[] {\r\n  return typeof limit === \"number\" ? knowledgeStore.slice(0, limit) : [...knowledgeStore]\r\n}\r\n\r\nexport function getKnowledgeArticle(id: string): KnowledgeArticle | undefined {\r\n  return knowledgeStore.find((a) => a.id === id)\r\n}\r\n\r\nexport function upsertKnowledgeArticle(article: KnowledgeArticle): KnowledgeArticle {\r\n  const idx = knowledgeStore.findIndex((a) => a.id === article.id)\r\n  if (idx >= 0) {\r\n    knowledgeStore[idx] = { ...knowledgeStore[idx], ...article, updatedAt: article.updatedAt }\r\n    return knowledgeStore[idx]\r\n  }\r\n  knowledgeStore.unshift(article)\r\n  return article\r\n}\r\n\r\nexport function generateKnowledgeFromPatterns(patterns: IncidentPattern[]): KnowledgeArticle[] {\r\n  const generated: KnowledgeArticle[] = patterns.map((p) => {\r\n    const id = `auto-${p.tenantId ?? \"global\"}-${p.siteId ?? \"global\"}-${p.type}-${p.key}`\r\n    const summary = `Recurring issue observed ${p.occurrences} time${p.occurrences === 1 ? \"\" : \"s\"}: ${p.key}.`\r\n    const body = [\r\n      `Pattern: ${p.key}`,\r\n      `Occurrences: ${p.occurrences}`,\r\n      p.successCount ? `Successful remediations: ${p.successCount}` : \"\",\r\n      p.failureCount ? `Failed remediation attempts: ${p.failureCount}` : \"\",\r\n      p.rollbackCount ? `Rollbacks executed: ${p.rollbackCount}` : \"\",\r\n    ]\r\n      .filter(Boolean)\r\n      .join(\"\\n\")\r\n\r\n    const article: KnowledgeArticle = {\r\n      id,\r\n      title: `Recurring issue: ${p.key}`,\r\n      summary,\r\n      relatedDiagnosisIds: p.relatedDiagnosisIds,\r\n      relatedProposalIds: p.relatedProposalIds,\r\n      relatedPatternKeys: [p.key],\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString(),\r\n      source: \"operator\",\r\n      tags: [p.type],\r\n      body,\r\n      tenantId: p.tenantId,\r\n      siteId: p.siteId,\r\n    }\r\n\r\n    return article\r\n  })\r\n\r\n  generated.forEach((article) => {\r\n    const existing = getKnowledgeArticle(article.id)\r\n    if (!existing) {\r\n      upsertKnowledgeArticle(article)\r\n    }\r\n  })\r\n\r\n  return generated\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAEA,MAAM,iBAAqC,EAAE;AAE7C,SAAS,OAAO,MAAc;IAC5B,OAAO,GAAG,OAAO,CAAC,EAAE,KAAK,GAAG,GAAG,QAAQ,CAAC,IAAI,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;AACzF;AAEO,SAAS,sBAAsB,KAAc;IAClD,OAAO,OAAO,UAAU,WAAW,eAAe,KAAK,CAAC,GAAG,SAAS;WAAI;KAAe;AACzF;AAEO,SAAS,oBAAoB,EAAU;IAC5C,OAAO,eAAe,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;AAC7C;AAEO,SAAS,uBAAuB,OAAyB;IAC9D,MAAM,MAAM,eAAe,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,QAAQ,EAAE;IAC/D,IAAI,OAAO,GAAG;QACZ,cAAc,CAAC,IAAI,GAAG;YAAE,GAAG,cAAc,CAAC,IAAI;YAAE,GAAG,OAAO;YAAE,WAAW,QAAQ,SAAS;QAAC;QACzF,OAAO,cAAc,CAAC,IAAI;IAC5B;IACA,eAAe,OAAO,CAAC;IACvB,OAAO;AACT;AAEO,SAAS,8BAA8B,QAA2B;IACvE,MAAM,YAAgC,SAAS,GAAG,CAAC,CAAC;QAClD,MAAM,KAAK,CAAC,KAAK,EAAE,EAAE,QAAQ,IAAI,SAAS,CAAC,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE;QACtF,MAAM,UAAU,CAAC,yBAAyB,EAAE,EAAE,WAAW,CAAC,KAAK,EAAE,EAAE,WAAW,KAAK,IAAI,KAAK,IAAI,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC;QAC5G,MAAM,OAAO;YACX,CAAC,SAAS,EAAE,EAAE,GAAG,EAAE;YACnB,CAAC,aAAa,EAAE,EAAE,WAAW,EAAE;YAC/B,EAAE,YAAY,GAAG,CAAC,yBAAyB,EAAE,EAAE,YAAY,EAAE,GAAG;YAChE,EAAE,YAAY,GAAG,CAAC,6BAA6B,EAAE,EAAE,YAAY,EAAE,GAAG;YACpE,EAAE,aAAa,GAAG,CAAC,oBAAoB,EAAE,EAAE,aAAa,EAAE,GAAG;SAC9D,CACE,MAAM,CAAC,SACP,IAAI,CAAC;QAER,MAAM,UAA4B;YAChC;YACA,OAAO,CAAC,iBAAiB,EAAE,EAAE,GAAG,EAAE;YAClC;YACA,qBAAqB,EAAE,mBAAmB;YAC1C,oBAAoB,EAAE,kBAAkB;YACxC,oBAAoB;gBAAC,EAAE,GAAG;aAAC;YAC3B,WAAW,IAAI,OAAO,WAAW;YACjC,WAAW,IAAI,OAAO,WAAW;YACjC,QAAQ;YACR,MAAM;gBAAC,EAAE,IAAI;aAAC;YACd;YACA,UAAU,EAAE,QAAQ;YACpB,QAAQ,EAAE,MAAM;QAClB;QAEA,OAAO;IACT;IAEA,UAAU,OAAO,CAAC,CAAC;QACjB,MAAM,WAAW,oBAAoB,QAAQ,EAAE;QAC/C,IAAI,CAAC,UAAU;YACb,uBAAuB;QACzB;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/dev-seeder.ts"],"sourcesContent":["import { recordIncident } from \"@/lib/intel\"\r\nimport { upsertKnowledgeArticle } from \"@/lib/knowledge\"\r\nimport type {\r\n  AutonomySimulation,\r\n  EarlyWarning,\r\n  FixStrategyScore,\r\n  ForesightPrediction,\r\n  IncidentRecord,\r\n  KnowledgeArticle,\r\n  KnowledgeRecommendation,\r\n  PrimeBriefing,\r\n  PrimeCognitionBundle,\r\n  ReliabilityForecast,\r\n} from \"@/lib/types\"\r\n\r\nlet seeded = false\r\n\r\nconst seededWarnings: EarlyWarning[] = []\r\nconst seededPredictions: ForesightPrediction[] = []\r\nlet seededCognition: PrimeCognitionBundle | null = null\r\nlet seededAutonomySimulations: AutonomySimulation[] = []\r\nlet seededStrategyScores: FixStrategyScore[] = []\r\nlet seededReliabilityForecast: ReliabilityForecast | null = null\r\nlet seededPrimeBriefing: PrimeBriefing | null = null\r\nconst seededKnowledgeArticles: KnowledgeArticle[] = []\r\nconst seededRecs: KnowledgeRecommendation[] = []\r\n\r\nconst baseTime = Date.now()\r\nconst dayMs = 24 * 60 * 60 * 1000\r\nconst hourMs = 60 * 60 * 1000\r\n\r\nfunction isDev() {\r\n  return process.env.NODE_ENV === \"development\"\r\n}\r\n\r\nfunction iso(daysAgo: number, hourOffset = 0) {\r\n  return new Date(baseTime - daysAgo * dayMs - hourOffset * hourMs).toISOString()\r\n}\r\n\r\nexport function seedIncidents() {\r\n  if (!isDev()) return\r\n  const incidents: IncidentRecord[] = [\r\n    {\r\n      id: \"seed-inc-001\",\r\n      timestamp: iso(1, 2),\r\n      source: \"/api/checkout\",\r\n      summary: \"API 500 spike on checkout\",\r\n      severity: \"error\",\r\n      risk: \"medium\",\r\n      actionType: \"fix-applied\",\r\n      tags: [\"api\", \"checkout\", \"500\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-002\",\r\n      timestamp: iso(2, 4),\r\n      source: \"/api/payments\",\r\n      summary: \"Payment gateway timeout\",\r\n      severity: \"warning\",\r\n      risk: \"medium\",\r\n      actionType: \"approval-required\",\r\n      tags: [\"payments\", \"timeout\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-003\",\r\n      timestamp: iso(3, 3),\r\n      source: \"worker-billing\",\r\n      summary: \"Billing worker retry storm\",\r\n      severity: \"error\",\r\n      risk: \"high\",\r\n      actionType: \"fix-failed\",\r\n      proposalId: \"prop-billing-throttle\",\r\n      tags: [\"billing\", \"queue\", \"retries\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-004\",\r\n      timestamp: iso(4, 5),\r\n      source: \"edge-cache\",\r\n      summary: \"Cache miss storm\",\r\n      severity: \"warning\",\r\n      risk: \"low\",\r\n      actionType: \"fix-applied\",\r\n      proposalId: \"prop-cache-warm\",\r\n      tags: [\"cache\", \"latency\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-005\",\r\n      timestamp: iso(5, 1),\r\n      source: \"/api/catalog\",\r\n      summary: \"Catalog schema drift detected\",\r\n      severity: \"critical\",\r\n      risk: \"high\",\r\n      actionType: \"fix-failed\",\r\n      proposalId: \"prop-catalog-rollback\",\r\n      tags: [\"schema\", \"catalog\"],\r\n    },\r\n  ]\r\n\r\n  incidents.forEach((inc) => recordIncident(inc))\r\n}\r\n\r\nexport function seedPatterns() {\r\n  if (!isDev()) return\r\n  const patternIncidents: IncidentRecord[] = [\r\n    {\r\n      id: \"seed-inc-006\",\r\n      timestamp: iso(1, 6),\r\n      source: \"/api/checkout\",\r\n      summary: \"API 500 spike on checkout\",\r\n      severity: \"error\",\r\n      risk: \"medium\",\r\n      actionType: \"fix-failed\",\r\n      proposalId: \"prop-checkout-circuit\",\r\n      tags: [\"api\", \"checkout\", \"500\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-007\",\r\n      timestamp: iso(2, 2),\r\n      source: \"edge-cache\",\r\n      summary: \"Cache miss storm\",\r\n      severity: \"warning\",\r\n      risk: \"medium\",\r\n      actionType: \"fix-applied\",\r\n      proposalId: \"prop-cache-warm\",\r\n      tags: [\"cache\", \"latency\"],\r\n    },\r\n    {\r\n      id: \"seed-inc-008\",\r\n      timestamp: iso(3, 6),\r\n      source: \"worker-billing\",\r\n      summary: \"Billing worker retry storm\",\r\n      severity: \"error\",\r\n      risk: \"medium\",\r\n      actionType: \"rollback-executed\",\r\n      proposalId: \"prop-billing-throttle\",\r\n      tags: [\"billing\", \"queue\"],\r\n    },\r\n  ]\r\n\r\n  patternIncidents.forEach((inc) => recordIncident(inc))\r\n}\r\n\r\nexport function seedFixes() {\r\n  if (!isDev()) return\r\n  const fixes: IncidentRecord[] = [\r\n    {\r\n      id: \"seed-fix-001\",\r\n      timestamp: iso(0, 4),\r\n      source: \"worker-billing\",\r\n      summary: \"Billing worker retry storm\",\r\n      severity: \"warning\",\r\n      risk: \"medium\",\r\n      actionType: \"fix-applied\",\r\n      proposalId: \"prop-billing-throttle\",\r\n      tags: [\"billing\", \"stability\"],\r\n    },\r\n    {\r\n      id: \"seed-fix-002\",\r\n      timestamp: iso(1, 1),\r\n      source: \"edge-cache\",\r\n      summary: \"Cache miss storm\",\r\n      severity: \"info\",\r\n      risk: \"low\",\r\n      actionType: \"fix-applied\",\r\n      proposalId: \"prop-cache-warm\",\r\n      tags: [\"cache\", \"warmup\"],\r\n    },\r\n    {\r\n      id: \"seed-fix-003\",\r\n      timestamp: iso(2, 0),\r\n      source: \"/api/catalog\",\r\n      summary: \"Catalog schema drift detected\",\r\n      severity: \"warning\",\r\n      risk: \"medium\",\r\n      actionType: \"fix-applied\",\r\n      proposalId: \"prop-catalog-rollback\",\r\n      tags: [\"schema\", \"catalog\"],\r\n    },\r\n  ]\r\n\r\n  fixes.forEach((fix) => recordIncident(fix))\r\n}\r\n\r\nexport function seedRollbacks() {\r\n  if (!isDev()) return\r\n  const rollbacks: IncidentRecord[] = [\r\n    {\r\n      id: \"seed-rb-001\",\r\n      timestamp: iso(1, 5),\r\n      source: \"worker-billing\",\r\n      summary: \"Billing worker retry storm\",\r\n      severity: \"error\",\r\n      risk: \"high\",\r\n      actionType: \"rollback-executed\",\r\n      rollbackId: \"rb-billing-queue\",\r\n      proposalId: \"prop-billing-throttle\",\r\n      tags: [\"billing\", \"rollback\"],\r\n    },\r\n    {\r\n      id: \"seed-rb-002\",\r\n      timestamp: iso(2, 3),\r\n      source: \"/api/checkout\",\r\n      summary: \"API 500 spike on checkout\",\r\n      severity: \"error\",\r\n      risk: \"high\",\r\n      actionType: \"rollback-executed\",\r\n      rollbackId: \"rb-checkout-circuit\",\r\n      proposalId: \"prop-checkout-circuit\",\r\n      tags: [\"checkout\", \"rollback\"],\r\n    },\r\n    {\r\n      id: \"seed-rb-003\",\r\n      timestamp: iso(3, 1),\r\n      source: \"/api/catalog\",\r\n      summary: \"Catalog schema drift detected\",\r\n      severity: \"critical\",\r\n      risk: \"high\",\r\n      actionType: \"rollback-executed\",\r\n      rollbackId: \"rb-catalog-schema\",\r\n      proposalId: \"prop-catalog-rollback\",\r\n      tags: [\"schema\", \"rollback\"],\r\n    },\r\n  ]\r\n\r\n  rollbacks.forEach((rb) => recordIncident(rb))\r\n}\r\n\r\nexport function seedEarlyWarnings() {\r\n  if (!isDev()) return\r\n  seededWarnings.splice(0, seededWarnings.length, \r\n    {\r\n      id: \"warn-checkout-hotspot\",\r\n      title: \"Checkout API instability\",\r\n      severity: \"high\",\r\n      rationale: \"Multiple HTTP 500 events in checkout within 72 hours.\",\r\n      actions: [\"Hold new rollouts\", \"Run checkout circuit test\", \"Pre-warm cache for checkout flows\"],\r\n      window: \"immediate\",\r\n      source: \"foresight\",\r\n    },\r\n    {\r\n      id: \"warn-billing-retries\",\r\n      title: \"Billing worker retry surge\",\r\n      severity: \"medium\",\r\n      rationale: \"Retry volume trending up in billing worker queue.\",\r\n      actions: [\"Enable rate limits\", \"Add jitter to retries\", \"Inspect dead-letter queue\"],\r\n      window: \"short-term\",\r\n      source: \"foresight\",\r\n    },\r\n    {\r\n      id: \"warn-catalog-schema\",\r\n      title: \"Catalog schema drift risk\",\r\n      severity: \"medium\",\r\n      rationale: \"Schema drift detected on catalog service; rollbacks triggered previously.\",\r\n      actions: [\"Lock schema migrations\", \"Verify downstream consumers\", \"Capture snapshots before deploy\"],\r\n      window: \"mid-term\",\r\n      source: \"foresight\",\r\n    },\r\n  )\r\n}\r\n\r\nexport function seedForesightPredictions() {\r\n  if (!isDev()) return\r\n  seededPredictions.splice(0, seededPredictions.length,\r\n    {\r\n      id: \"pred-checkout-latency\",\r\n      likelihood: 0.32,\r\n      impact: \"medium\",\r\n      summary: \"Checkout latency may spike during peak due to cache churn.\",\r\n      drivers: [\"Edge cache misses\", \"Recent 500s on checkout\"],\r\n      horizon: \"short\",\r\n    },\r\n    {\r\n      id: \"pred-billing-rollback\",\r\n      likelihood: 0.28,\r\n      impact: \"high\",\r\n      summary: \"Billing worker may need rollback if retry storm persists.\",\r\n      drivers: [\"Queue depth growth\", \"Recent rollback in billing\"],\r\n      horizon: \"short\",\r\n    },\r\n    {\r\n      id: \"pred-catalog-drift\",\r\n      likelihood: 0.22,\r\n      impact: \"medium\",\r\n      summary: \"Catalog schema drift likely if upcoming deploy proceeds without validation.\",\r\n      drivers: [\"Recent schema rollback\", \"Missing contract tests\"],\r\n      horizon: \"mid\",\r\n    },\r\n  )\r\n}\r\n\r\nexport function seedCognitionBundle() {\r\n  if (!isDev()) return\r\n  seededCognition = {\r\n    confidences: [\r\n      { target: \"diagnosis\", score: 0.86, rationale: \"Recent fixes succeeded after circuit breakers.\" },\r\n      { target: \"prediction\", score: 0.78, rationale: \"Incident volume contained; forecast tempered.\" },\r\n      { target: \"warning\", score: 0.82, rationale: \"Checkout hotspot remains active.\" },\r\n    ],\r\n    rationales: [\r\n      {\r\n        summary: \"Pattern stability improving\",\r\n        factors: [\"Checkout errors reduced\", \"Cache warmup working\", \"Billing retries still monitored\"],\r\n      },\r\n    ],\r\n    traces: [\r\n      {\r\n        steps: [\"Ingest incidents\", \"Rank patterns\", \"Adjust for recent rollbacks\"],\r\n        conclusion: \"Confidence anchored by reduced failure rate and active guardrails\",\r\n      },\r\n    ],\r\n    drift: {\r\n      status: \"watch\",\r\n      indicators: [\"Tenant mix stable\", \"Checkout path still noisy\"],\r\n      driftScore: 0.28,\r\n    },\r\n    stability: {\r\n      score: 0.81,\r\n      factors: [\"Guardrails active\", \"Rollbacks succeeded\", \"Cache hit-rate recovering\"],\r\n    },\r\n  }\r\n}\r\n\r\nexport function seedAutonomySimulations() {\r\n  if (!isDev()) return\r\n  seededAutonomySimulations = [\r\n    {\r\n      id: \"sim-checkout-circuit\",\r\n      description: \"Dry-run checkout circuit breaker with staged rollout\",\r\n      risk: \"medium\",\r\n      outcome: \"pass\",\r\n      steps: [\"Detect 500 spike\", \"Trip circuit\", \"Validate fallback\"],\r\n      approvalsNeeded: 1,\r\n    },\r\n    {\r\n      id: \"sim-billing-throttle\",\r\n      description: \"Throttle billing worker retries during queue surge\",\r\n      risk: \"medium\",\r\n      outcome: \"pass\",\r\n      steps: [\"Measure queue depth\", \"Apply jitter\", \"Verify DLQ volume\"],\r\n      approvalsNeeded: 1,\r\n    },\r\n    {\r\n      id: \"sim-catalog-rollback\",\r\n      description: \"Rollback catalog migration with snapshot restore\",\r\n      risk: \"high\",\r\n      outcome: \"pass\",\r\n      steps: [\"Capture snapshot\", \"Run rollback\", \"Verify contract tests\"],\r\n      approvalsNeeded: 2,\r\n    },\r\n  ]\r\n\r\n  seededStrategyScores = [\r\n    { strategy: \"rollback-first\", score: 0.74, rationale: \"Fastest containment for catalog drift.\" },\r\n    { strategy: \"retry-then-rollback\", score: 0.69, rationale: \"Balances billing retry risk.\" },\r\n    { strategy: \"bluegreen-shift\", score: 0.72, rationale: \"Gradual checkout release keeps blast radius low.\" },\r\n  ]\r\n\r\n  seededReliabilityForecast = {\r\n    score: 0.84,\r\n    horizon: \"short\",\r\n    rationale: [\"Recent rollbacks succeeded\", \"Cache warmup stabilized latency\", \"Billing retries trending down\"],\r\n  }\r\n}\r\n\r\nexport function seedPrimeBriefing() {\r\n  if (!isDev()) return\r\n  seededPrimeBriefing = {\r\n    headline: \"Prime reliability briefing\",\r\n    highlights: [\r\n      \"Reliability score holding at 92\",\r\n      \"Checkout hotspot contained by circuit breaker\",\r\n      \"Catalog schema guarded by rollback plan\",\r\n    ],\r\n    reliabilityScore: 92,\r\n  }\r\n}\r\n\r\nexport function seedKnowledgeGraph() {\r\n  if (!isDev()) return\r\n  const articles: KnowledgeArticle[] = [\r\n    {\r\n      id: \"ka-cache-warmup\",\r\n      title: \"Edge cache warmup play\",\r\n      summary: \"Warm cache on deploy to avoid early latency spikes for checkout and catalog.\",\r\n      relatedDiagnosisIds: [],\r\n      relatedProposalIds: [\"prop-cache-warm\"],\r\n      relatedPatternKeys: [\"Cache miss storm\"],\r\n      createdAt: iso(2),\r\n      updatedAt: iso(1),\r\n      source: \"operator\",\r\n      tags: [\"cache\", \"latency\"],\r\n      body: \"Pre-warm critical paths, validate hit-rate, monitor 95th percentile latency post-release.\",\r\n    },\r\n    {\r\n      id: \"ka-billing-retries\",\r\n      title: \"Billing retry control\",\r\n      summary: \"Throttle billing worker retries to prevent queue storms and DLQ growth.\",\r\n      relatedDiagnosisIds: [],\r\n      relatedProposalIds: [\"prop-billing-throttle\"],\r\n      relatedPatternKeys: [\"Billing worker retry storm\"],\r\n      createdAt: iso(3),\r\n      updatedAt: iso(1),\r\n      source: \"operator\",\r\n      tags: [\"billing\", \"queues\"],\r\n      body: \"Add jitter, cap retries, and watch DLQ signal during incident windows.\",\r\n    },\r\n    {\r\n      id: \"ka-catalog-schema\",\r\n      title: \"Catalog schema rollback SOP\",\r\n      summary: \"Steps to revert catalog migrations safely with snapshot restores.\",\r\n      relatedDiagnosisIds: [],\r\n      relatedProposalIds: [\"prop-catalog-rollback\"],\r\n      relatedPatternKeys: [\"Catalog schema drift detected\"],\r\n      createdAt: iso(4),\r\n      updatedAt: iso(2),\r\n      source: \"operator\",\r\n      tags: [\"schema\", \"rollback\"],\r\n      body: \"Capture snapshot, run down migration, validate contracts, and verify search/indexers.\",\r\n    },\r\n  ]\r\n\r\n  articles.forEach((article) => {\r\n    seededKnowledgeArticles.push(article)\r\n    upsertKnowledgeArticle(article)\r\n  })\r\n}\r\n\r\nexport function seedRecommendations() {\r\n  if (!isDev()) return\r\n  seededRecs.splice(0, seededRecs.length,\r\n    {\r\n      title: \"Stabilize checkout path\",\r\n      summary: \"Pair checkout with circuit breaker tests before next release.\",\r\n      actions: [\"Run checkout rollback simulation\", \"Pre-warm cache for checkout\", \"Shadow traffic new release\"],\r\n    },\r\n    {\r\n      title: \"Tame billing retries\",\r\n      summary: \"Keep billing queue healthy by capping retries and inspecting DLQ daily.\",\r\n      actions: [\"Add jitter to retries\", \"Alert on DLQ growth\", \"Validate idempotency keys\"],\r\n    },\r\n    {\r\n      title: \"Guard catalog schema\",\r\n      summary: \"Require snapshot and contract tests before schema deploys.\",\r\n      actions: [\"Capture pre-deploy snapshot\", \"Run consumer contract suite\", \"Stage rollout with blue/green\"],\r\n    },\r\n  )\r\n}\r\n\r\nexport function runPrimeSeeder(): void {\r\n  if (!isDev() || seeded) return\r\n\r\n  seedIncidents()\r\n  seedPatterns()\r\n  seedFixes()\r\n  seedRollbacks()\r\n  seedEarlyWarnings()\r\n  seedForesightPredictions()\r\n  seedCognitionBundle()\r\n  seedAutonomySimulations()\r\n  seedPrimeBriefing()\r\n  seedKnowledgeGraph()\r\n  seedRecommendations()\r\n\r\n  seeded = true\r\n}\r\n\r\nexport function getSeededWarnings() {\r\n  return seededWarnings\r\n}\r\n\r\nexport function getSeededPredictions() {\r\n  return seededPredictions\r\n}\r\n\r\nexport function getSeededCognition() {\r\n  return seededCognition\r\n}\r\n\r\nexport function getSeededAutonomy() {\r\n  return {\r\n    autonomySimulations: seededAutonomySimulations,\r\n    strategyScores: seededStrategyScores,\r\n    reliabilityForecast: seededReliabilityForecast,\r\n  }\r\n}\r\n\r\nexport function getSeededPrimeBriefing() {\r\n  return seededPrimeBriefing\r\n}\r\n\r\nexport function getSeededRecommendations() {\r\n  return seededRecs\r\n}\r\n\r\nexport function getSeededKnowledgeArticles() {\r\n  return seededKnowledgeArticles\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 812, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/intel.ts"],"sourcesContent":["import { listLogs } from \"@/lib/audit\"\r\nimport { runPrimeSeeder } from \"@/lib/dev-seeder\"\r\nimport type {\r\n  AuditLogEntry,\r\n  Diagnosis,\r\n  IncidentPattern,\r\n  IncidentRecord,\r\n  IncidentSummary,\r\n  MonitoringEvent,\r\n  RemediationProposal,\r\n} from \"@/lib/types\"\r\n\r\nconst incidentStore: IncidentRecord[] = []\r\nconst MAX_INCIDENTS = 1000\r\n\r\nfunction makeId(prefix: string) {\r\n  return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 6)}`\r\n}\r\n\r\nfunction normalizeSource(event?: MonitoringEvent) {\r\n  return event?.context && typeof event.context.path === \"string\" ? String(event.context.path) : event?.source\r\n}\r\n\r\nfunction toIncidentFromAudit(log: AuditLogEntry): IncidentRecord {\r\n  return {\r\n    id: log.id,\r\n    timestamp: log.timestamp,\r\n    diagnosisId: log.diagnosisId,\r\n    proposalId: log.proposalId,\r\n    rollbackId: log.rollbackId,\r\n    snapshotId: log.snapshotId,\r\n    risk: log.risk,\r\n    actionType: log.actionType,\r\n    message: log.message,\r\n    tenantId: (log as IncidentRecord).tenantId,\r\n    siteId: (log as IncidentRecord).siteId,\r\n  }\r\n}\r\n\r\nexport function recordIncident(record: AuditLogEntry | Partial<IncidentRecord>) {\r\n  const entry: IncidentRecord = {\r\n    id: \"id\" in record && record.id ? record.id : makeId(\"incident\"),\r\n    timestamp: record.timestamp ?? new Date().toISOString(),\r\n    source: \"source\" in record ? record.source : undefined,\r\n    summary: \"summary\" in record ? record.summary : undefined,\r\n    eventId: \"eventId\" in record ? record.eventId : undefined,\r\n    snapshotId: \"snapshotId\" in record ? record.snapshotId : undefined,\r\n    diagnosisId: \"diagnosisId\" in record ? record.diagnosisId : undefined,\r\n    proposalId: \"proposalId\" in record ? record.proposalId : undefined,\r\n    rollbackId: \"rollbackId\" in record ? record.rollbackId : undefined,\r\n    risk: record.risk,\r\n    severity: \"severity\" in record ? record.severity : undefined,\r\n    kind: \"kind\" in record ? record.kind : undefined,\r\n    actionType: \"actionType\" in record ? record.actionType : undefined,\r\n    message: \"message\" in record ? record.message : undefined,\r\n    tags: \"tags\" in record && record.tags ? record.tags : [],\r\n    tenantId: \"tenantId\" in record ? record.tenantId : undefined,\r\n    siteId: \"siteId\" in record ? record.siteId : undefined,\r\n  }\r\n\r\n  incidentStore.push(entry)\r\n  if (incidentStore.length > MAX_INCIDENTS) {\r\n    incidentStore.splice(0, incidentStore.length - MAX_INCIDENTS)\r\n  }\r\n  return entry\r\n}\r\n\r\nfunction mergeIncidents(store: IncidentRecord[], logs: IncidentRecord[]): IncidentRecord[] {\r\n  const map = new Map<string, IncidentRecord>()\r\n  ;[...store, ...logs].forEach((inc) => {\r\n    if (!map.has(inc.id)) {\r\n      map.set(inc.id, inc)\r\n    }\r\n  })\r\n  return Array.from(map.values())\r\n}\r\n\r\nfunction allIncidents(): IncidentRecord[] {\r\n  const logIncidents = listLogs().map(toIncidentFromAudit)\r\n  const combined = mergeIncidents(incidentStore, logIncidents)\r\n  combined.sort((a, b) => (a.timestamp > b.timestamp ? -1 : 1))\r\n  return combined\r\n}\r\n\r\nexport function getRecentIncidents(limit = 100): IncidentRecord[] {\r\n  if (process.env.NODE_ENV === \"development\") {\r\n    runPrimeSeeder()\r\n  }\r\n  return allIncidents().slice(0, limit)\r\n}\r\n\r\nexport function deriveIncidentPatterns(records: IncidentRecord[], limit = 20): IncidentPattern[] {\r\n  const patterns: Record<string, IncidentPattern> = {}\r\n\r\n  const addPattern = (\r\n    key: string,\r\n    type: IncidentPattern[\"type\"],\r\n    record: IncidentRecord,\r\n    updater?: (p: IncidentPattern, rec: IncidentRecord) => void,\r\n  ) => {\r\n    if (!key) return\r\n    const scopeKey = `${record.tenantId ?? \"global\"}:${record.siteId ?? \"global\"}`\r\n    const mapKey = `${scopeKey}:${type}:${key}`\r\n    const existing = patterns[mapKey] ?? {\r\n      key,\r\n      type,\r\n      occurrences: 0,\r\n      lastSeenAt: record.timestamp,\r\n      relatedDiagnosisIds: [],\r\n      relatedProposalIds: [],\r\n      tenantId: record.tenantId,\r\n      siteId: record.siteId,\r\n    }\r\n\r\n    existing.occurrences += 1\r\n    if (record.timestamp > existing.lastSeenAt) existing.lastSeenAt = record.timestamp\r\n    if (record.diagnosisId && !existing.relatedDiagnosisIds?.includes(record.diagnosisId)) {\r\n      existing.relatedDiagnosisIds = [...(existing.relatedDiagnosisIds ?? []), record.diagnosisId]\r\n    }\r\n    if (record.proposalId && !existing.relatedProposalIds?.includes(record.proposalId)) {\r\n      existing.relatedProposalIds = [...(existing.relatedProposalIds ?? []), record.proposalId]\r\n    }\r\n    if (updater) updater(existing, record)\r\n    patterns[mapKey] = existing\r\n  }\r\n\r\n  records.forEach((rec) => {\r\n    if (rec.summary) addPattern(rec.summary, \"diagnosis\", rec)\r\n    if (rec.source) addPattern(rec.source, \"source\", rec)\r\n    if (rec.proposalId) {\r\n      addPattern(rec.proposalId, \"proposal\", rec, (p, r) => {\r\n        if (r.actionType === \"fix-applied\") p.successCount = (p.successCount ?? 0) + 1\r\n        if (r.actionType === \"fix-failed\") p.failureCount = (p.failureCount ?? 0) + 1\r\n        if (r.actionType === \"rollback-executed\") p.rollbackCount = (p.rollbackCount ?? 0) + 1\r\n        if (r.actionType === \"approval-required\") p.approvalCount = (p.approvalCount ?? 0) + 1\r\n      })\r\n    }\r\n  })\r\n\r\n  return Object.values(patterns)\r\n    .sort((a, b) => b.occurrences - a.occurrences)\r\n    .slice(0, limit)\r\n}\r\n\r\nexport function getIncidentPatterns(limit = 20): IncidentPattern[] {\r\n  return deriveIncidentPatterns(allIncidents(), limit)\r\n}\r\n\r\nexport function summarizeIncidents(records: IncidentRecord[]): IncidentSummary {\r\n  const summary: IncidentSummary = {\r\n    totalIncidents: records.length,\r\n    fixSuccessCount: 0,\r\n    fixFailureCount: 0,\r\n    rollbackCount: 0,\r\n    highRiskBlockedCount: 0,\r\n    approvalsRequiredCount: 0,\r\n    emailsSentCount: 0,\r\n    emailsFailedCount: 0,\r\n    topPatterns: [],\r\n  }\r\n\r\n  records.forEach((rec) => {\r\n    if (rec.actionType === \"fix-applied\") summary.fixSuccessCount += 1\r\n    if (rec.actionType === \"fix-failed\") summary.fixFailureCount += 1\r\n    if (rec.actionType === \"rollback-executed\") summary.rollbackCount += 1\r\n    if (rec.actionType === \"fix-rejected\") summary.highRiskBlockedCount += 1\r\n    if (rec.actionType === \"approval-required\") summary.approvalsRequiredCount = (summary.approvalsRequiredCount ?? 0) + 1\r\n    if (rec.actionType === \"email-sent\") summary.emailsSentCount = (summary.emailsSentCount ?? 0) + 1\r\n    if (rec.actionType === \"email-failed\") summary.emailsFailedCount = (summary.emailsFailedCount ?? 0) + 1\r\n  })\r\n\r\n  summary.topPatterns = deriveIncidentPatterns(records, 5)\r\n  return summary\r\n}\r\n\r\nexport function summarizeIncidentHistory(): IncidentSummary {\r\n  return summarizeIncidents(allIncidents())\r\n}\r\n\r\nexport function detectAnomalies(events: MonitoringEvent[]): { anomalies: MonitoringEvent[]; summary: string } {\r\n  if (!events.length) return { anomalies: [], summary: \"No events provided.\" }\r\n\r\n  const errors = events.filter((e) => e.severity === \"error\" || e.severity === \"critical\")\r\n  const latency = events.filter((e) => e.kind === \"latency\")\r\n  const uptimeIssues = events.filter((e) => e.kind === \"uptime\")\r\n\r\n  const anomalies: MonitoringEvent[] = []\r\n  const notes: string[] = []\r\n\r\n  if (errors.length >= 3 || errors.length >= Math.max(2, Math.ceil(events.length / 2))) {\r\n    anomalies.push(...errors)\r\n    notes.push(`Spike in errors/critical events (${errors.length})`)\r\n  }\r\n\r\n  const latencySources = new Set(latency.map((l) => normalizeSource(l)))\r\n  if (latency.length >= 3 || latencySources.size >= 2) {\r\n    anomalies.push(...latency)\r\n    notes.push(\"Elevated latency across multiple events\")\r\n  }\r\n\r\n  const uptimeBySource: Record<string, number> = {}\r\n  uptimeIssues.forEach((u) => {\r\n    const src = normalizeSource(u)\r\n    if (!src) return\r\n    uptimeBySource[src] = (uptimeBySource[src] ?? 0) + 1\r\n  })\r\n  Object.entries(uptimeBySource).forEach(([src, count]) => {\r\n    if (count >= 2) {\r\n      anomalies.push(...uptimeIssues.filter((u) => normalizeSource(u) === src))\r\n      notes.push(`Repeated uptime issues for ${src}`)\r\n    }\r\n  })\r\n\r\n  const summary = notes.length ? notes.join(\"; \") : \"No anomalies detected.\"\r\n  return { anomalies: Array.from(new Set(anomalies)), summary }\r\n}\r\n\r\nexport function getIncidentHotspots(limit = 10) {\r\n  return getIncidentPatterns(limit)\r\n}\r\n\r\nexport function summarizeIncidentHistoryForDiagnostics(diagnoses: Diagnosis[]) {\r\n  const recent = getRecentIncidents(300)\r\n  const summaryByDiag: Record<string, { occurrences: number; failures: number; successes: number }> = {}\r\n\r\n  diagnoses.forEach((diag) => {\r\n    const matches = recent.filter(\r\n      (rec) =>\r\n        rec.diagnosisId === diag.id ||\r\n        rec.summary === diag.summary ||\r\n        (rec.eventId && rec.eventId === diag.eventId) ||\r\n        (rec.source && diag.summary.includes(rec.source ?? \"\")),\r\n    )\r\n\r\n    if (!matches.length) return\r\n    const successes = matches.filter((m) => m.actionType === \"fix-applied\").length\r\n    const failures = matches.filter((m) => m.actionType === \"fix-failed\").length\r\n\r\n    summaryByDiag[diag.id] = {\r\n      occurrences: matches.length,\r\n      failures,\r\n      successes,\r\n    }\r\n  })\r\n\r\n  return summaryByDiag\r\n}\r\n\r\nexport function summarizeProposalHistory(proposals: RemediationProposal[]) {\r\n  const recent = getRecentIncidents(400)\r\n  const map: Record<string, { attempts: number; successes: number; failures: number; rollbacks: number }> = {}\r\n\r\n  proposals.forEach((proposal) => {\r\n    const matches = recent.filter((rec) => rec.proposalId === proposal.id || rec.diagnosisId === proposal.diagnosisId)\r\n    if (!matches.length) return\r\n\r\n    const successes = matches.filter((m) => m.actionType === \"fix-applied\").length\r\n    const failures = matches.filter((m) => m.actionType === \"fix-failed\").length\r\n    const rollbacks = matches.filter((m) => m.actionType === \"rollback-executed\").length\r\n\r\n    map[proposal.id] = {\r\n      attempts: matches.length,\r\n      successes,\r\n      failures,\r\n      rollbacks,\r\n    }\r\n  })\r\n\r\n  return map\r\n}\r\n\r\nexport function getRecentPatterns(limit = 10) {\r\n  return getIncidentPatterns(limit)\r\n}\r\n\r\nexport function summarizeIncidentHistoryForSources(events: MonitoringEvent[]) {\r\n  const sourceCounts: Record<string, number> = {}\r\n  events.forEach((evt) => {\r\n    const src = normalizeSource(evt)\r\n    if (src) sourceCounts[src] = (sourceCounts[src] ?? 0) + 1\r\n  })\r\n  return sourceCounts\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1081, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/persona.ts"],"sourcesContent":["import type { OperatorPersona } from \"@/lib/types\"\r\n\r\nexport const defaultPersona: OperatorPersona = {\r\n  name: \"Operator\",\r\n  tone: \"teaching\",\r\n  focus: \"stability\",\r\n  prefersBullets: true,\r\n  brandNotes: [\r\n    \"Cinematic, calm, deterministic.\",\r\n    \"Explains risk and safeguards, never panics.\",\r\n    \"Treats every fix as a legacy milestone.\",\r\n  ],\r\n  signatureLine: \"— Operator, watching over your systems.\",\r\n}\r\n\r\nexport function formatExplanation(persona: OperatorPersona, content: { title: string; body: string[] }): string[] {\r\n  const lines: string[] = []\r\n  const marker = persona.prefersBullets ? \"• \" : \"› \"\r\n\r\n  const cleanedBody = content.body.map((line) => line.trim()).filter(Boolean)\r\n  if (content.title) lines.push(`${content.title}`)\r\n\r\n  cleanedBody.forEach((line) => {\r\n    let phrased = line\r\n    if (persona.tone === \"teaching\") {\r\n      if (!line.toLowerCase().startsWith(\"this\")) {\r\n        phrased = `This suggests ${line.charAt(0).toLowerCase()}${line.slice(1)}`\r\n      }\r\n      if (!phrased.endsWith(\".\")) phrased = `${phrased}.`\r\n      phrased += \" You may want to confirm safeguards.\"\r\n    } else if (persona.tone === \"reassuring\") {\r\n      phrased = line\r\n      if (!phrased.endsWith(\".\")) phrased = `${phrased}.`\r\n      phrased += \" No immediate risks detected; we're monitoring.\"\r\n    } else {\r\n      phrased = line.endsWith(\".\") ? line : `${line}.`\r\n    }\r\n\r\n    const withMarker = `${marker}${phrased}`\r\n    lines.push(withMarker)\r\n  })\r\n\r\n  if (persona.signatureLine && cleanedBody.length > 0) {\r\n    lines.push(persona.signatureLine)\r\n  }\r\n\r\n  return lines\r\n}\r\n"],"names":[],"mappings":";;;;;;AAEO,MAAM,iBAAkC;IAC7C,MAAM;IACN,MAAM;IACN,OAAO;IACP,gBAAgB;IAChB,YAAY;QACV;QACA;QACA;KACD;IACD,eAAe;AACjB;AAEO,SAAS,kBAAkB,OAAwB,EAAE,OAA0C;IACpG,MAAM,QAAkB,EAAE;IAC1B,MAAM,SAAS,QAAQ,cAAc,GAAG,OAAO;IAE/C,MAAM,cAAc,QAAQ,IAAI,CAAC,GAAG,CAAC,CAAC,OAAS,KAAK,IAAI,IAAI,MAAM,CAAC;IACnE,IAAI,QAAQ,KAAK,EAAE,MAAM,IAAI,CAAC,GAAG,QAAQ,KAAK,EAAE;IAEhD,YAAY,OAAO,CAAC,CAAC;QACnB,IAAI,UAAU;QACd,IAAI,QAAQ,IAAI,KAAK,YAAY;YAC/B,IAAI,CAAC,KAAK,WAAW,GAAG,UAAU,CAAC,SAAS;gBAC1C,UAAU,CAAC,cAAc,EAAE,KAAK,MAAM,CAAC,GAAG,WAAW,KAAK,KAAK,KAAK,CAAC,IAAI;YAC3E;YACA,IAAI,CAAC,QAAQ,QAAQ,CAAC,MAAM,UAAU,GAAG,QAAQ,CAAC,CAAC;YACnD,WAAW;QACb,OAAO,IAAI,QAAQ,IAAI,KAAK,cAAc;YACxC,UAAU;YACV,IAAI,CAAC,QAAQ,QAAQ,CAAC,MAAM,UAAU,GAAG,QAAQ,CAAC,CAAC;YACnD,WAAW;QACb,OAAO;YACL,UAAU,KAAK,QAAQ,CAAC,OAAO,OAAO,GAAG,KAAK,CAAC,CAAC;QAClD;QAEA,MAAM,aAAa,GAAG,SAAS,SAAS;QACxC,MAAM,IAAI,CAAC;IACb;IAEA,IAAI,QAAQ,aAAa,IAAI,YAAY,MAAM,GAAG,GAAG;QACnD,MAAM,IAAI,CAAC,QAAQ,aAAa;IAClC;IAEA,OAAO;AACT"}},
    {"offset": {"line": 1131, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/prime-intel.ts"],"sourcesContent":["import type { IncidentPattern, IncidentRecord, PrimeBriefing, PrimeInsight } from \"@/lib/types\"\r\n\r\nexport function correlateAcrossTenants(incidents: IncidentRecord[]): IncidentRecord[] {\r\n  return incidents\r\n}\r\n\r\nexport function detectGlobalPatterns(patterns: IncidentPattern[]): IncidentPattern[] {\r\n  return patterns.slice(0, 5)\r\n}\r\n\r\nexport function computeGlobalReliabilityScore(incidents: IncidentRecord[]): number {\r\n  if (!incidents.length) return 95\r\n  const failures = incidents.filter((i) => i.actionType === \"fix-failed\").length\r\n  const rollbacks = incidents.filter((i) => i.actionType === \"rollback-executed\").length\r\n  const score = Math.max(40, 98 - failures * 2 - rollbacks * 1.5)\r\n  return Number(score.toFixed(1))\r\n}\r\n\r\nexport function generatePrimeInsights(incidents: IncidentRecord[], patterns: IncidentPattern[]): PrimeInsight[] {\r\n  const reliabilityScore = computeGlobalReliabilityScore(incidents)\r\n  const topPattern = patterns[0]\r\n  const insights: PrimeInsight[] = []\r\n  insights.push({\r\n    id: `prime-${Date.now().toString(36)}`,\r\n    title: \"Global reliability posture\",\r\n    narrative: `Reliability holding at score ${reliabilityScore}. Key watch area: ${topPattern ? topPattern.key : \"none\"}.`,\r\n    reliabilityScore,\r\n    scope: \"global\",\r\n  })\r\n  if (topPattern) {\r\n    insights.push({\r\n      id: `prime-pattern-${topPattern.key}`,\r\n      title: \"Dominant recurring signal\",\r\n      narrative: `${topPattern.key} appears ${topPattern.occurrences} times across tenants.`,\r\n      reliabilityScore,\r\n      scope: \"global\",\r\n    })\r\n  }\r\n  return insights\r\n}\r\n\r\nexport function generatePrimeBriefing(incidents: IncidentRecord[], patterns: IncidentPattern[]): PrimeBriefing {\r\n  const reliabilityScore = computeGlobalReliabilityScore(incidents)\r\n  const highlights: string[] = []\r\n  highlights.push(`Reliability score: ${reliabilityScore}`)\r\n  if (patterns.length) highlights.push(`Top global pattern: ${patterns[0].key}`)\r\n  return {\r\n    headline: \"Operator Prime global briefing\",\r\n    highlights,\r\n    reliabilityScore,\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAEO,SAAS,uBAAuB,SAA2B;IAChE,OAAO;AACT;AAEO,SAAS,qBAAqB,QAA2B;IAC9D,OAAO,SAAS,KAAK,CAAC,GAAG;AAC3B;AAEO,SAAS,8BAA8B,SAA2B;IACvE,IAAI,CAAC,UAAU,MAAM,EAAE,OAAO;IAC9B,MAAM,WAAW,UAAU,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,cAAc,MAAM;IAC9E,MAAM,YAAY,UAAU,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,qBAAqB,MAAM;IACtF,MAAM,QAAQ,KAAK,GAAG,CAAC,IAAI,KAAK,WAAW,IAAI,YAAY;IAC3D,OAAO,OAAO,MAAM,OAAO,CAAC;AAC9B;AAEO,SAAS,sBAAsB,SAA2B,EAAE,QAA2B;IAC5F,MAAM,mBAAmB,8BAA8B;IACvD,MAAM,aAAa,QAAQ,CAAC,EAAE;IAC9B,MAAM,WAA2B,EAAE;IACnC,SAAS,IAAI,CAAC;QACZ,IAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAG,QAAQ,CAAC,KAAK;QACtC,OAAO;QACP,WAAW,CAAC,6BAA6B,EAAE,iBAAiB,kBAAkB,EAAE,aAAa,WAAW,GAAG,GAAG,OAAO,CAAC,CAAC;QACvH;QACA,OAAO;IACT;IACA,IAAI,YAAY;QACd,SAAS,IAAI,CAAC;YACZ,IAAI,CAAC,cAAc,EAAE,WAAW,GAAG,EAAE;YACrC,OAAO;YACP,WAAW,GAAG,WAAW,GAAG,CAAC,SAAS,EAAE,WAAW,WAAW,CAAC,sBAAsB,CAAC;YACtF;YACA,OAAO;QACT;IACF;IACA,OAAO;AACT;AAEO,SAAS,sBAAsB,SAA2B,EAAE,QAA2B;IAC5F,MAAM,mBAAmB,8BAA8B;IACvD,MAAM,aAAuB,EAAE;IAC/B,WAAW,IAAI,CAAC,CAAC,mBAAmB,EAAE,kBAAkB;IACxD,IAAI,SAAS,MAAM,EAAE,WAAW,IAAI,CAAC,CAAC,oBAAoB,EAAE,QAAQ,CAAC,EAAE,CAAC,GAAG,EAAE;IAC7E,OAAO;QACL,UAAU;QACV;QACA;IACF;AACF"}},
    {"offset": {"line": 1193, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/lib/prime-narrative.ts"],"sourcesContent":["import type { OperatorPersona, PrimeBriefing, PrimeInsight, PrimeNarrativeBundle } from \"@/lib/types\"\r\n\r\nexport function generatePrimeWeeklyReport(insights: PrimeInsight[]): string[] {\r\n  return insights.map((i) => `${i.title}: ${i.narrative}`)\r\n}\r\n\r\nexport function generatePrimeMonthlyDigest(insights: PrimeInsight[]): string[] {\r\n  return insights.slice(0, 7).map((i) => `Monthly: ${i.title} (${i.reliabilityScore})`)\r\n}\r\n\r\nexport function generatePrimeInsightsFeed(insights: PrimeInsight[]): string[] {\r\n  return insights.slice(0, 5).map((i) => `${i.scope.toUpperCase()}: ${i.title} — ${i.narrative}`)\r\n}\r\n\r\nexport function generatePrimeBriefingMode(persona: OperatorPersona, briefing: PrimeBriefing): string[] {\r\n  const lines: string[] = []\r\n  lines.push(`${briefing.headline} — Persona: ${persona.name}`)\r\n  lines.push(`Reliability: ${briefing.reliabilityScore}`)\r\n  briefing.highlights.forEach((h) => lines.push(h))\r\n  return lines\r\n}\r\n\r\nexport function generatePrimeNarrativeBundle(params: {\r\n  insights: PrimeInsight[]\r\n  briefing: PrimeBriefing\r\n  persona: OperatorPersona\r\n}): PrimeNarrativeBundle {\r\n  const { insights, briefing, persona } = params\r\n  const weekly = generatePrimeWeeklyReport(insights)\r\n  const monthly = generatePrimeMonthlyDigest(insights)\r\n  const feed = generatePrimeInsightsFeed(insights)\r\n  const briefingLines = generatePrimeBriefingMode(persona, briefing)\r\n\r\n  return {\r\n    headline: briefing.headline,\r\n    weekly,\r\n    monthly,\r\n    feed,\r\n    briefing: briefingLines,\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAEO,SAAS,0BAA0B,QAAwB;IAChE,OAAO,SAAS,GAAG,CAAC,CAAC,IAAM,GAAG,EAAE,KAAK,CAAC,EAAE,EAAE,EAAE,SAAS,EAAE;AACzD;AAEO,SAAS,2BAA2B,QAAwB;IACjE,OAAO,SAAS,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,IAAM,CAAC,SAAS,EAAE,EAAE,KAAK,CAAC,EAAE,EAAE,EAAE,gBAAgB,CAAC,CAAC,CAAC;AACtF;AAEO,SAAS,0BAA0B,QAAwB;IAChE,OAAO,SAAS,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,IAAM,GAAG,EAAE,KAAK,CAAC,WAAW,GAAG,EAAE,EAAE,EAAE,KAAK,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE;AAChG;AAEO,SAAS,0BAA0B,OAAwB,EAAE,QAAuB;IACzF,MAAM,QAAkB,EAAE;IAC1B,MAAM,IAAI,CAAC,GAAG,SAAS,QAAQ,CAAC,YAAY,EAAE,QAAQ,IAAI,EAAE;IAC5D,MAAM,IAAI,CAAC,CAAC,aAAa,EAAE,SAAS,gBAAgB,EAAE;IACtD,SAAS,UAAU,CAAC,OAAO,CAAC,CAAC,IAAM,MAAM,IAAI,CAAC;IAC9C,OAAO;AACT;AAEO,SAAS,6BAA6B,MAI5C;IACC,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG;IACxC,MAAM,SAAS,0BAA0B;IACzC,MAAM,UAAU,2BAA2B;IAC3C,MAAM,OAAO,0BAA0B;IACvC,MAAM,gBAAgB,0BAA0B,SAAS;IAEzD,OAAO;QACL,UAAU,SAAS,QAAQ;QAC3B;QACA;QACA;QACA,UAAU;IACZ;AACF"}},
    {"offset": {"line": 1239, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AjaySidal/buildwithai-V0DEV-up/buildwithai-V0DEV-up/operator-app/app/api/intel/prime-narrative/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport { getIncidentPatterns, getRecentIncidents } from \"@/lib/intel\"\r\nimport { defaultPersona } from \"@/lib/persona\"\r\nimport { generatePrimeBriefing, generatePrimeInsights } from \"@/lib/prime-intel\"\r\nimport { generatePrimeNarrativeBundle } from \"@/lib/prime-narrative\"\r\n\r\nexport async function GET() {\r\n  const incidents = getRecentIncidents(200)\r\n  const patterns = getIncidentPatterns(20)\r\n  const primeInsights = generatePrimeInsights(incidents, patterns)\r\n  const primeBriefing = generatePrimeBriefing(incidents, patterns)\r\n  const primeNarrative = generatePrimeNarrativeBundle({ insights: primeInsights, briefing: primeBriefing, persona: defaultPersona })\r\n\r\n  return NextResponse.json({ primeNarrative, primeBriefing, primeInsights })\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe;IACpB,MAAM,YAAY,IAAA,oIAAkB,EAAC;IACrC,MAAM,WAAW,IAAA,qIAAmB,EAAC;IACrC,MAAM,gBAAgB,IAAA,gJAAqB,EAAC,WAAW;IACvD,MAAM,gBAAgB,IAAA,gJAAqB,EAAC,WAAW;IACvD,MAAM,iBAAiB,IAAA,2JAA4B,EAAC;QAAE,UAAU;QAAe,UAAU;QAAe,SAAS,kIAAc;IAAC;IAEhI,OAAO,gRAAY,CAAC,IAAI,CAAC;QAAE;QAAgB;QAAe;IAAc;AAC1E"}}]
}