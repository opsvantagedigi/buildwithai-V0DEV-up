module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},9463,__turbopack_context__=>{"use strict";let kvClient=null,WRITE_ENABLED=!1,READ_ONLY_ONLY=!1,NO_WRITE_FALLBACK=!1;try{process.env.KV_REST_API_URL||(process.env.KV_REST_API_URL=process.env.UPSTASH_REDIS_REST_URL||process.env.KV_REST_API_URL),process.env.KV_REST_API_TOKEN||(process.env.KV_REST_API_TOKEN=process.env.KV_REST_API_WRITE_TOKEN||process.env.UPSTASH_REDIS_REST_TOKEN||process.env.KV_REST_API_READ_ONLY_TOKEN||process.env.KV_REST_API_TOKEN),WRITE_ENABLED=!!(process.env.KV_REST_API_WRITE_TOKEN||process.env.KV_REST_API_TOKEN),READ_ONLY_ONLY=!!process.env.KV_REST_API_READ_ONLY_TOKEN&&!WRITE_ENABLED,NO_WRITE_FALLBACK="true"===process.env.NO_WRITE_FALLBACK||READ_ONLY_ONLY;let earlyUpstashUrl=process.env.UPSTASH_REDIS_REST_URL,earlyUpstashToken=process.env.UPSTASH_REDIS_REST_TOKEN;if(earlyUpstashUrl&&earlyUpstashToken){let base=earlyUpstashUrl.replace(/\/$/,"");kvClient={async get(e){try{let t=await fetch(`${base}/get/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${earlyUpstashToken}`}});if(!t.ok)return null;return(await t.json()).result??null}catch(e){return console.error("[KV] early REST get() failed:",e),null}},async set(e,t){if(NO_WRITE_FALLBACK)return{skippedReadOnly:!0};try{return await fetch(`${base}/set/${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${earlyUpstashToken}`,"Content-Type":"application/json"},body:JSON.stringify({value:"string"==typeof t?t:JSON.stringify(t)})}),!0}catch(e){return console.error("[KV] early REST set() failed:",e),null}},async expire(e,t){if(NO_WRITE_FALLBACK)return null;try{return await fetch(`${base}/expire/${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${earlyUpstashToken}`,"Content-Type":"application/json"},body:JSON.stringify({ttl:t})}),!0}catch(e){return console.error("[KV] early REST expire() failed:",e),null}}}}let moduleName="@vercel/kv",kvModule=eval("require")(moduleName),candidate=kvModule?.kv??kvModule?.default??kvModule;if("function"==typeof candidate){let factory=candidate,makeLazy=e=>{let t=null,r=!1,n=async()=>{if(t||r)return t;r=!0;try{let r=process.env.KV_REST_API_URL||process.env.UPSTASH_REDIS_REST_URL,n=process.env.KV_REST_API_TOKEN||process.env.UPSTASH_REDIS_REST_TOKEN;(t=await e({url:r,token:n}))&&"function"==typeof t.get&&"function"==typeof t.set||(t=null)}catch(e){t=null}return t};return{async get(e){let t=await n();if(!t)throw Error("kv_not_initialized");return t.get(e)},async set(e,t){let r=await n();if(!r)throw Error("kv_not_initialized");return r.set(e,t)},async expire(e,t){let r=await n();if(!r)throw Error("kv_not_initialized");return"function"==typeof r.expire?r.expire(e,t):null}}};try{candidate=makeLazy(factory)}catch(err){}}if(candidate&&"function"==typeof candidate.get&&"function"==typeof candidate.set)kvClient=candidate;else throw console.warn("[KV] Falling back to Upstash REST wrapper: invalid client shape",Object.keys(kvModule||{})),Error("invalid_kv_client_shape")}catch(e){let upstashUrl=process.env.UPSTASH_REDIS_REST_URL,upstashToken=process.env.UPSTASH_REDIS_REST_TOKEN;if(upstashUrl&&upstashToken){let base=upstashUrl.replace(/\/$/,"");kvClient={async get(e){try{let t=await fetch(`${base}/get/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${upstashToken}`}});if(!t.ok)return null;return(await t.json()).result??null}catch(e){return console.error("[KV] get() failed:",e),null}},async set(e,t){if(NO_WRITE_FALLBACK)return{skippedReadOnly:!0};try{return await fetch(`${base}/set/${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${upstashToken}`,"Content-Type":"application/json"},body:JSON.stringify({value:"string"==typeof t?t:JSON.stringify(t)})}),!0}catch(e){return console.error("[KV] set() failed:",e),null}},async expire(e,t){if(NO_WRITE_FALLBACK)return null;try{return await fetch(`${base}/expire/${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${upstashToken}`,"Content-Type":"application/json"},body:JSON.stringify({ttl:t})}),!0}catch(e){return console.error("[KV] expire() failed:",e),null}}}}else kvClient=null}let RDAP_TTL_SECONDS=300;async function kvGetRdap(e){if(!kvClient)return null;try{let t=`rdap:${e.toLowerCase()}`;return await kvClient.get(t)??null}catch(e){return null}}async function kvSetRdap(e,t){if(!kvClient)return null;if(NO_WRITE_FALLBACK)return{skippedReadOnly:!0};try{let r=`rdap:${e.toLowerCase()}`,n=await kvClient.set(r,t);try{"function"==typeof kvClient.expire&&await kvClient.expire(r,RDAP_TTL_SECONDS)}catch(e){}return n}catch(e){return null}}let kv={async get(e){if(!kvClient)return null;try{let t=await kvClient.get(e);if(null==t)return null;let r=t;if("string"==typeof t)try{r=JSON.parse(t)}catch(e){r=t}if(r&&"object"==typeof r&&"value"in r){let e=r.value;if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e}return r}catch(t){console.error("[KV] get() failed:",t);try{if(process.env.UPSTASH_REDIS_REST_URL&&process.env.UPSTASH_REDIS_REST_TOKEN){let t=(process.env.UPSTASH_REDIS_REST_URL||"").replace(/\/$/,""),r=process.env.UPSTASH_REDIS_REST_TOKEN,n=`${t}/get/${encodeURIComponent(e)}`;console.log("[KV] attempting Upstash REST fallback GET",n);let a=await fetch(n,{headers:{Authorization:`Bearer ${r}`}});if(console.log("[KV] upstash REST fallback status",a.status),!a.ok)return null;let s=await a.json();return console.log("[KV] upstash REST fallback body keys",Object.keys(s||{})),s.result??null}}catch(e){console.error("[KV] upstash REST fallback failed:",e)}return null}},async set(e,t,r){if(!kvClient)return null;if(NO_WRITE_FALLBACK)return{skippedReadOnly:!0};try{let n=await kvClient.set(e,t);if(r?.ex&&"function"==typeof kvClient.expire)try{await kvClient.expire(e,Math.ceil(r.ex))}catch(e){}return n}catch(e){return console.error("[KV] set() failed:",e),null}}},__TURBOPACK__default__export__={};function getKvStatus(){return{writeEnabled:WRITE_ENABLED,readOnlyOnly:READ_ONLY_ONLY,noWriteFallback:NO_WRITE_FALLBACK,kvClientPresent:!!kvClient,kvUrl:process.env.KV_REST_API_URL||process.env.UPSTASH_REDIS_REST_URL||null}}async function debugKvRoundTrip(){let e="debug:kv:test",t={ok:!0,ts:Date.now()};console.log("[KV] Writing test key:",e);let r=await kv.set(e,JSON.stringify(t));console.log("[KV] Write result:",r);let n=await kv.get(e);return console.log("[KV] Read result:",n),{writeResult:r,readResult:n}}__turbopack_context__.s(["getKvStatus",()=>getKvStatus,"kv",0,kv,"kvGetRdap",()=>kvGetRdap,"kvSetRdap",()=>kvSetRdap])},53247,e=>{"use strict";var t=e.i(9463);let r="buildwithai:sites",n="buildwithai:sites:index";async function a(e,a){let s=`${r}:${e}`,i=await t.kv.get(s);if(i)return i;let o={id:e,name:a,createdAt:Date.now(),updatedAt:Date.now()};await t.kv.set(s,o);try{let r=await t.kv.get(n),a=Array.isArray(r)?Array.from(new Set([...r,e])):[e];await t.kv.set(n,a)}catch(e){}return o}async function s(e){let n=`${r}:${e}`,a=await t.kv.get(n);a&&(a.updatedAt=Date.now(),await t.kv.set(n,a))}async function i(){let e=await t.kv.get(n),a=[];if(!Array.isArray(e)||0===e.length)return a;for(let n of e){let e=`${r}:${n}`,s=await t.kv.get(e);s&&a.push(s)}return a.sort((e,t)=>t.updatedAt-e.updatedAt)}e.s(["listSites",()=>i,"registerSite",()=>a,"updateSiteTimestamp",()=>s])},46255,e=>{"use strict";var t=e.i(9463);let r="buildwithai:site:";async function n(e){let n=`${r}${e}`,a=await t.kv.get(n);if(!a)return null;let s=a;if("string"==typeof a)try{s=JSON.parse(a)}catch{return null}return s&&"object"==typeof s&&s.metadata&&s.pages?(s.metadata={id:s.metadata.id??e,name:s.metadata.name??"",description:s.metadata.description??"",createdAt:s.metadata.createdAt??Date.now(),updatedAt:s.metadata.updatedAt??Date.now(),version:s.metadata.version??1},Array.isArray(s.pages)||(s.pages=[]),s):null}e.s(["loadSiteState",()=>n])},20205,33633,e=>{"use strict";let t=process.env.OLLAMA_ENDPOINT||"http://localhost:11434",r=process.env.OLLAMA_MODEL||"llama3";function n(e){let{previous:t,current:r}=e,n=t?.version??null,a=t?.state??null,s=r.version,i=r.state;return`
You are an assistant that writes concise, human-readable changelogs for a website builder.

You will be given two JSON states:
- "previous" (may be null)
- "current"

Each state represents the full builder state of a site in a "Build With AI" platform.

Your job is to describe what changed between "previous" and "current" in clear, plain language, focusing on:
- New sections or blocks added
- Sections or blocks removed
- Text changes in key headings, subheadings, and CTAs
- Notable layout or content reorganizations
- Any high-level structural changes

If there is no previous state, write a changelog as if this is the first published version of the site.

Return:
- 2–5 short bullet points
- No markdown bullet characters (just start each line with "- ")

Previous (version: ${n??"none"}):
${JSON.stringify(a,null,2)}

Current (version: ${s}):
${JSON.stringify(i,null,2)}
`}async function a(e){try{let a=n(e),s=await fetch(`${t}/api/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:r,prompt:a,stream:!1})});if(!s.ok)return console.error("[changelog] Ollama request failed with status",s.status),null;let i=await s.json().catch(()=>null),o=i?.response??i?.text??null;if(!o||"string"!=typeof o)return null;return o.trim()}catch(e){return console.error("[changelog] Ollama error",e),null}}e.s(["generateChangelogWithOllama",()=>a],20205);let s=process.env.OLLAMA_ENDPOINT||"http://localhost:11434",i=process.env.OLLAMA_MODEL||"llama3";function o(e){let{snapshot:t,changelog:r,productionUrl:n}=e;return`
You are an assistant that writes professional, concise release notes.

You will be given:
- Version number
- Timestamp
- Changelog text
- Production URL (optional)

Write a short, clear release note suitable for clients and enterprise users.

Guidelines:
- Professional tone
- 2–4 bullet points
- No marketing language
- No emojis
- No markdown formatting
- No unnecessary adjectives

Version: ${t.version}
Timestamp: ${new Date(t.timestamp).toISOString()}
Production URL: ${n??"none"}

Changelog:
${r??"No changelog available"}
`}async function l(e){try{let t=o(e),r=await fetch(`${s}/api/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:i,prompt:t,stream:!1})});if(!r.ok)return console.error("[releaseNotes] Ollama request failed",r.status),null;let n=await r.json().catch(()=>null),a=n?.response??n?.text??null;if(!a||"string"!=typeof a)return null;return a.trim()}catch(e){return console.error("[releaseNotes] Ollama error",e),null}}e.s(["generateReleaseNotesWithOllama",()=>l],33633)},15050,e=>{"use strict";var t=e.i(8041),r=e.i(99896),n=e.i(12033),a=e.i(81147),s=e.i(41419),i=e.i(8224),o=e.i(89956),l=e.i(3480),u=e.i(77484),c=e.i(27230),p=e.i(43858),d=e.i(63991),h=e.i(51205),f=e.i(36658),g=e.i(11918),v=e.i(93695);e.i(81551);var y=e.i(17996),R=e.i(24278),S=e.i(9463),w=e.i(46255);async function _(e){let t=await (0,w.loadSiteState)(e);return t||null}var E=e.i(20205),m=e.i(33633),T=e.i(53247);let A="buildwithai:site:history:",x="buildwithai:site:versions:",O="buildwithai:site:staging:",b="buildwithai:site:production:";async function N(e){let{searchParams:t}=new URL(e.url),r=t.get("siteId");if(!r)return R.NextResponse.json({error:"Missing siteId"},{status:400});let n=`${O}${r}`,a=await S.kv.get(n);if(!a)return R.NextResponse.json({error:"No staging deployment found"},{status:400});let s=`${A}${r}`,i=await S.kv.get(s)??[],o=(i[i.length-1]??0)+1,l=await _(r);if(!l)return R.NextResponse.json({error:"Static export failed"},{status:500});let u=null;if(i.length>0){let e=i[i.length-1],t=`${x}${r}:${e}`,n=await S.kv.get(t);n&&"object"==typeof n&&(u=n)}let c={version:o,timestamp:Date.now(),state:l,changelog:null,releaseNotes:null},p=await (0,E.generateChangelogWithOllama)({previous:u,current:c});c.changelog=p??null;let d=`${x}${r}:${o}`;await S.kv.set(d,c);let h=await (0,m.generateReleaseNotesWithOllama)({snapshot:c,changelog:c.changelog??null,productionUrl:a.url??null});h&&(c.releaseNotes=h,await S.kv.set(d,c));let f=`${b}${r}`;await S.kv.set(f,{version:o,url:a.url,timestamp:c.timestamp});let g=[...i,o];return await S.kv.set(s,g),await (0,T.updateSiteTimestamp)(r),R.NextResponse.json({ok:!0,version:o,url:a.url,changelog:c.changelog??null,releaseNotes:c.releaseNotes??null})}e.s(["POST",()=>N],48068);var k=e.i(48068);let $="",P=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/publish/promote/route",pathname:"/api/publish/promote",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/buildwithai/src/app/api/publish/promote/route.ts",nextConfigOutput:$,userland:k}),{workAsyncStorage:I,workUnitAsyncStorage:C,serverHooks:K}=P;function U(){return(0,n.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:C})}async function j(e,t,n){P.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/publish/promote/route";R=R.replace(/\/index$/,"")||"/";let S=!1,w=await P.prepare(e,t,{srcPage:R,multiZoneDraftMode:S});if(!w)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:_,params:E,nextConfig:m,parsedUrl:T,isDraftMode:A,prerenderManifest:x,routerServerContext:O,isOnDemandRevalidate:b,revalidateOnlyGenerated:N,resolvedPathname:k,clientReferenceManifest:$,serverActionsManifest:I}=w,C=(0,o.normalizeAppPath)(R),K=!!(x.dynamicRoutes[C]||x.routes[k]),U=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,T,!1):t.end("This page could not be found"),null);if(K&&!A){let e=!!x.routes[k],t=x.dynamicRoutes[C];if(t&&!1===t.fallback&&!e){if(m.experimental.adapterPath)return await U();throw new v.NoFallbackError}}let j=null;!K||P.isDev||A||(j="/index"===(j=k)?"/":j);let D=!0===P.isDev||!K,L=K&&!D;I&&$&&(0,i.setManifestsSingleton)({page:R,clientReferenceManifest:$,serverActionsManifest:I});let V=e.method||"GET",H=(0,s.getTracer)(),q=H.getActiveScopeSpan(),M={params:E,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!m.experimental.authInterrupts},cacheComponents:!!m.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:m.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,a)=>P.onRequestError(e,t,n,a,O)},sharedContext:{buildId:_}},J=new l.NodeNextRequest(e),B=new l.NodeNextResponse(t),W=u.NextRequestAdapter.fromNodeNextRequest(J,(0,u.signalFromNodeResponse)(t));try{let i=async e=>P.handle(W,M).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${V} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${V} ${R}`)}),o=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var s,l;let u=async({previousCacheEntry:r})=>{try{if(!o&&b&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(a);e.fetchMetrics=M.renderOpts.fetchMetrics;let l=M.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=M.renderOpts.collectedTags;if(!K)return await (0,d.sendResponse)(J,B,s,M.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,n=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){if(null==r?void 0:r.isStale){let r=!1;await P.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:b})},r,O)}throw t}},c=await P.handleResponse({req:e,nextConfig:m,cacheKey:j,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:N,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:o});if(!K)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",b?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&K||v.delete(g.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,f.getCacheControlHeader)(c.cacheControl)),await (0,d.sendResponse)(J,B,new Response(c.value.body,{headers:v,status:c.value.status||200})),null};q?await l(q):await H.withPropagatedContext(e.headers,()=>H.trace(c.BaseServerSpan.handleRequest,{spanName:`${V} ${R}`,kind:s.SpanKind.SERVER,attributes:{"http.method":V,"http.target":e.url}},l))}catch(t){if(!(t instanceof v.NoFallbackError)){let r=!1;await P.onRequestError(e,t,{routerKind:"App Router",routePath:C,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:b})},r,O)}if(K)throw t;return await (0,d.sendResponse)(J,B,new Response(null,{status:500})),null}}e.s(["handler",()=>j,"patchFetch",()=>U,"routeModule",()=>P,"serverHooks",()=>K,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>C],15050)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__0718b8ab._.js.map