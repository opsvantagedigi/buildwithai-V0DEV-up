{"version":3,"sources":["../../../../buildwithai/src/lib/kv.ts","../../../../buildwithai/src/lib/rdap.ts","../../../../buildwithai/src/lib/rate-limit.ts","../../../../buildwithai/src/lib/logger.ts","../../../../buildwithai/src/lib/openprovider.ts","../../../../buildwithai/src/app/api/domain/pricing/route.ts"],"sourcesContent":["// Thin Vercel KV adapter. If @vercel/kv is not installed or KV is not configured,\r\n// these functions fail gracefully and return null / noop. A conservative\r\n// no-write fallback is implemented so we can avoid attempting writes when the\r\n// deployment only provides a read-only token.\r\nlet kvClient: any = null\r\n// Flags will be computed after env mapping so they reflect mapped UPSTASH vars\r\nlet WRITE_ENABLED = false\r\nlet READ_ONLY_ONLY = false\r\nlet NO_WRITE_FALLBACK = false\r\n\r\ntry {\r\n  // If the project already has UPSTASH_REDIS_REST_URL / UPSTASH_REDIS_REST_TOKEN\r\n  // or custom WRITE/READ env names set, map them to the names expected by\r\n  // `@vercel/kv` at runtime so the package can pick them up without changing\r\n  // Vercel project env names. Do NOT log values or expose secrets.\r\n  if (!process.env.KV_REST_API_URL) {\r\n    process.env.KV_REST_API_URL = process.env.UPSTASH_REDIS_REST_URL || process.env.KV_REST_API_URL\r\n  }\r\n  if (!process.env.KV_REST_API_TOKEN) {\r\n    process.env.KV_REST_API_TOKEN = process.env.KV_REST_API_WRITE_TOKEN || process.env.UPSTASH_REDIS_REST_TOKEN || process.env.KV_REST_API_READ_ONLY_TOKEN || process.env.KV_REST_API_TOKEN\r\n  }\r\n\r\n  // Compute write/read flags after any env mapping above so they reflect\r\n  // the effective environment variables (e.g. UPSTASH -> KV mapping).\r\n  WRITE_ENABLED = !!(process.env.KV_REST_API_WRITE_TOKEN || process.env.KV_REST_API_TOKEN)\r\n  READ_ONLY_ONLY = !!process.env.KV_REST_API_READ_ONLY_TOKEN && !WRITE_ENABLED\r\n  NO_WRITE_FALLBACK = process.env.NO_WRITE_FALLBACK === 'true' || READ_ONLY_ONLY\r\n\r\n  // If explicit Upstash REST envs are present prefer a thin REST wrapper so\r\n  // local scripts and child processes use the same predictable code-path.\r\n  const earlyUpstashUrl = process.env.UPSTASH_REDIS_REST_URL\r\n  const earlyUpstashToken = process.env.UPSTASH_REDIS_REST_TOKEN\r\n  if (earlyUpstashUrl && earlyUpstashToken) {\r\n    const base = earlyUpstashUrl.replace(/\\/$/, '')\r\n    kvClient = {\r\n      async get(key: string) {\r\n        try {\r\n          const res = await fetch(`${base}/get/${encodeURIComponent(key)}`, {\r\n            headers: { Authorization: `Bearer ${earlyUpstashToken}` },\r\n          })\r\n          if (!res.ok) return null\r\n          const j = await res.json()\r\n          return j.result ?? null\r\n        } catch (err) {\r\n          console.error(\"[KV] early REST get() failed:\", err)\r\n          return null\r\n        }\r\n      },\r\n      async set(key: string, value: any) {\r\n        if (NO_WRITE_FALLBACK) return { skippedReadOnly: true }\r\n        try {\r\n          await fetch(`${base}/set/${encodeURIComponent(key)}`, {\r\n            method: 'POST',\r\n            headers: {\r\n              Authorization: `Bearer ${earlyUpstashToken}`,\r\n              'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({ value: typeof value === 'string' ? value : JSON.stringify(value) }),\r\n          })\r\n          return true\r\n        } catch (err) {\r\n          console.error(\"[KV] early REST set() failed:\", err)\r\n          return null\r\n        }\r\n      },\r\n      async expire(key: string, ttl: number) {\r\n        if (NO_WRITE_FALLBACK) return null\r\n        try {\r\n          await fetch(`${base}/expire/${encodeURIComponent(key)}`, {\r\n            method: 'POST',\r\n            headers: {\r\n              Authorization: `Bearer ${earlyUpstashToken}`,\r\n              'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({ ttl }),\r\n          })\r\n          return true\r\n        } catch (err) {\r\n          console.error(\"[KV] early REST expire() failed:\", err)\r\n          return null\r\n        }\r\n      },\r\n    }\r\n  }\r\n\r\n  // Construct the module name so static analyzers can't find the literal\r\n  const moduleName = '@' + 'vercel' + '/kv'\r\n  // Use eval to call require at runtime; this avoids bundlers resolving the import\r\n  // eslint-disable-next-line @typescript-eslint/no-implied-eval\r\n  // @ts-ignore\r\n  const kvModule = eval('require')(moduleName)\r\n\r\n  // Pick a candidate client from common export shapes\r\n  let candidate: any = kvModule?.kv ?? kvModule?.default ?? kvModule\r\n\r\n  // If the module exports a factory function, attempt to call it with env\r\n  if (typeof candidate === 'function') {\r\n    // Wrap factory in a lazy initializer so child processes or scripts that\r\n    // load env files after module import still work. The lazy wrapper will\r\n    // call the factory on first use with the current env values.\r\n    const factory = candidate\r\n    const makeLazy = (factoryFn: any) => {\r\n      let realClient: any = null\r\n      let initAttempted = false\r\n      const ensure = async () => {\r\n        if (realClient) return realClient\r\n        if (initAttempted) return realClient\r\n        initAttempted = true\r\n        try {\r\n          const url = process.env.KV_REST_API_URL || process.env.UPSTASH_REDIS_REST_URL\r\n          const token = process.env.KV_REST_API_TOKEN || process.env.UPSTASH_REDIS_REST_TOKEN\r\n          realClient = await factoryFn({ url, token })\r\n          if (!(realClient && typeof realClient.get === 'function' && typeof realClient.set === 'function')) {\r\n            realClient = null\r\n          }\r\n        } catch (err) {\r\n          realClient = null\r\n        }\r\n        return realClient\r\n      }\r\n      return {\r\n        async get(k: string) {\r\n          const c = await ensure()\r\n          if (!c) throw new Error('kv_not_initialized')\r\n          return c.get(k)\r\n        },\r\n        async set(k: string, v: any) {\r\n          const c = await ensure()\r\n          if (!c) throw new Error('kv_not_initialized')\r\n          return c.set(k, v)\r\n        },\r\n        async expire(k: string, t: number) {\r\n          const c = await ensure()\r\n          if (!c) throw new Error('kv_not_initialized')\r\n          if (typeof c.expire === 'function') return c.expire(k, t)\r\n          return null\r\n        },\r\n      }\r\n    }\r\n\r\n    try {\r\n      candidate = makeLazy(factory)\r\n    } catch (err) {\r\n      // ignore and validate below\r\n    }\r\n  }\r\n\r\n  // Validate that candidate exposes get/set\r\n  if (candidate && typeof candidate.get === 'function' && typeof candidate.set === 'function') {\r\n    kvClient = candidate\r\n  } else {\r\n    // Diagnostic + force fallback to Upstash REST in the catch block below\r\n    console.warn('[KV] Falling back to Upstash REST wrapper: invalid client shape', Object.keys(kvModule || {}))\r\n    throw new Error('invalid_kv_client_shape')\r\n  }\r\n} catch (e) {\r\n  // package not installed or not available in this environment; try an\r\n  // Upstash REST fallback if UPSTASH_REDIS_REST_URL/TOKEN are available.\r\n  const upstashUrl = process.env.UPSTASH_REDIS_REST_URL\r\n  const upstashToken = process.env.UPSTASH_REDIS_REST_TOKEN\r\n  if (upstashUrl && upstashToken) {\r\n    const base = upstashUrl.replace(/\\/$/, '')\r\n    kvClient = {\r\n      async get(key: string) {\r\n        try {\r\n          const res = await fetch(`${base}/get/${encodeURIComponent(key)}`, {\r\n            headers: { Authorization: `Bearer ${upstashToken}` },\r\n          })\r\n          if (!res.ok) return null\r\n          const j = await res.json()\r\n          return j.result ?? null\r\n        } catch (err) {\r\n          console.error(\"[KV] get() failed:\", err)\r\n          return null\r\n        }\r\n      },\r\n      async set(key: string, value: any) {\r\n        if (NO_WRITE_FALLBACK) return { skippedReadOnly: true }\r\n        try {\r\n          // Upstash expects simple JSON with `value` field for the set endpoint\r\n          await fetch(`${base}/set/${encodeURIComponent(key)}`, {\r\n            method: 'POST',\r\n            headers: {\r\n              Authorization: `Bearer ${upstashToken}`,\r\n              'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({ value: typeof value === 'string' ? value : JSON.stringify(value) }),\r\n          })\r\n          return true\r\n        } catch (err) {\r\n          console.error(\"[KV] set() failed:\", err)\r\n          return null\r\n        }\r\n      },\r\n      async expire(key: string, ttl: number) {\r\n        if (NO_WRITE_FALLBACK) return null\r\n        try {\r\n          await fetch(`${base}/expire/${encodeURIComponent(key)}`, {\r\n            method: 'POST',\r\n            headers: {\r\n              Authorization: `Bearer ${upstashToken}`,\r\n              'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({ ttl }),\r\n          })\r\n          return true\r\n        } catch (err) {\r\n          console.error(\"[KV] expire() failed:\", err)\r\n          return null\r\n        }\r\n      },\r\n    }\r\n  } else {\r\n    kvClient = null\r\n  }\r\n}\r\n\r\nconst RDAP_TTL_SECONDS = 300\r\n\r\nexport async function kvGetRdap(domain: string) {\r\n  if (!kvClient) return null\r\n  try {\r\n    const key = `rdap:${domain.toLowerCase()}`\r\n    const value = await kvClient.get(key)\r\n    return value ?? null\r\n  } catch (e) {\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function kvSetRdap(domain: string, value: any) {\r\n  if (!kvClient) return null\r\n  if (NO_WRITE_FALLBACK) return { skippedReadOnly: true }\r\n  try {\r\n    const key = `rdap:${domain.toLowerCase()}`\r\n    // @vercel/kv supports expire via .set with options in newer versions; use simple set\r\n    const setResult = await kvClient.set(key, value)\r\n    // If the client supports expiration, set TTL separately (best-effort)\r\n    try {\r\n      if (typeof kvClient.expire === 'function') await kvClient.expire(key, RDAP_TTL_SECONDS)\r\n    } catch (_) {\r\n      // ignore\r\n    }\r\n    return setResult\r\n  } catch (e) {\r\n    // fail silently\r\n    return null\r\n  }\r\n}\r\n\r\n// Lightweight generic KV helper (non-breaking addition).\r\n// Provides `kv.get(key)` and `kv.set(key, value, { ex })` to support debug routes.\r\nexport const kv = {\r\n  async get(key: string) {\r\n    if (!kvClient) return null\r\n    try {\r\n      const v = await kvClient.get(key)\r\n      // Normalize multiple possible shapes returned by different clients\r\n      //  - raw primitive (number/string)\r\n      //  - JSON string (\"{...}\")\r\n      //  - wrapped object like { value: \"...\" }\r\n      if (v === null || v === undefined) return null\r\n\r\n      let parsed: any = v\r\n      if (typeof v === 'string') {\r\n        try {\r\n          parsed = JSON.parse(v)\r\n        } catch (_) {\r\n          parsed = v\r\n        }\r\n      }\r\n\r\n      // If the stored value is wrapped as { value: \"...\" }, unwrap it.\r\n      if (parsed && typeof parsed === 'object' && 'value' in parsed) {\r\n        const inner = parsed.value\r\n        if (typeof inner === 'string') {\r\n          try {\r\n            return JSON.parse(inner)\r\n          } catch (_) {\r\n            return inner\r\n          }\r\n        }\r\n        return inner\r\n      }\r\n\r\n      return parsed\r\n    } catch (err) {\r\n      console.error(\"[KV] get() failed:\", err)\r\n      // If the underlying client failed due to an invalid/missing base URL,\r\n      // attempt a best-effort direct Upstash REST fallback using environment\r\n      // variables. This helps in child-process/test runtimes where the\r\n      // installed client was initialized with undefined env values.\r\n      try {\r\n        if (process.env.UPSTASH_REDIS_REST_URL && process.env.UPSTASH_REDIS_REST_TOKEN) {\r\n          const base = (process.env.UPSTASH_REDIS_REST_URL || '').replace(/\\/$/, '')\r\n          const upstashToken = process.env.UPSTASH_REDIS_REST_TOKEN\r\n          const url = `${base}/get/${encodeURIComponent(key)}`\r\n          console.log('[KV] attempting Upstash REST fallback GET', url)\r\n          const res = await fetch(url, {\r\n            headers: { Authorization: `Bearer ${upstashToken}` },\r\n          })\r\n          console.log('[KV] upstash REST fallback status', res.status)\r\n          if (!res.ok) return null\r\n          const j = await res.json()\r\n          console.log('[KV] upstash REST fallback body keys', Object.keys(j || {}))\r\n          return j.result ?? null\r\n        }\r\n      } catch (fallbackErr) {\r\n        console.error('[KV] upstash REST fallback failed:', fallbackErr)\r\n      }\r\n      return null\r\n    }\r\n  },\r\n  async set(key: string, value: any, opts?: { ex?: number }) {\r\n    if (!kvClient) return null\r\n    if (NO_WRITE_FALLBACK) return { skippedReadOnly: true }\r\n    try {\r\n      // Avoid double-encoding: pass raw values to the underlying client and\r\n      // let that client (or our Upstash REST wrapper) handle any required\r\n      // encoding. This prevents nested JSON like \"{\\\"value\\\":\\\"1\\\"}\".\r\n      const setResult = await kvClient.set(key, value)\r\n      if (opts?.ex && typeof kvClient.expire === 'function') {\r\n        try {\r\n          await kvClient.expire(key, Math.ceil(opts.ex))\r\n        } catch (_) {\r\n          // ignore\r\n        }\r\n      }\r\n      return setResult\r\n    } catch (err) {\r\n      console.error(\"[KV] set() failed:\", err)\r\n      return null\r\n    }\r\n  },\r\n}\r\n\r\nexport default { kvGetRdap, kvSetRdap }\r\n\r\nexport function getKvStatus() {\r\n  return {\r\n    writeEnabled: WRITE_ENABLED,\r\n    readOnlyOnly: READ_ONLY_ONLY,\r\n    noWriteFallback: NO_WRITE_FALLBACK,\r\n    kvClientPresent: !!kvClient,\r\n    kvUrl: process.env.KV_REST_API_URL || process.env.UPSTASH_REDIS_REST_URL || null,\r\n  }\r\n}\r\n\r\n// Temporary debug helper — writes and reads a test key and logs results.\r\nexport async function debugKvRoundTrip() {\r\n  const key = \"debug:kv:test\"\r\n  const value = { ok: true, ts: Date.now() }\r\n  console.log(\"[KV] Writing test key:\", key)\r\n  const writeResult = await kv.set(key, JSON.stringify(value))\r\n  console.log(\"[KV] Write result:\", writeResult)\r\n  const readResult = await kv.get(key)\r\n  console.log(\"[KV] Read result:\", readResult)\r\n  return { writeResult, readResult }\r\n}\r\n","/**\r\n * RDAP helper with normalization to a canonical schema and a simple cache.\r\n * - Uses an in-memory Map cache by default (per-instance).\r\n * - If you add Vercel KV or Redis, wire it into `readFromStore`/`writeToStore`.\r\n */\r\n\r\ntype CacheEntry = { ts: number; data: any }\r\n\r\nconst TTL = 1000 * 60 * 5 // 5 minutes\r\n\r\nconst CACHE_KEY = '__BUILDWITHAI_RDAP_CACHE'\r\n\r\nimport { kvGetRdap, kvSetRdap } from '@/lib/kv'\r\n\r\n// in-memory per-instance cache\r\nconst memoryCache = new Map<string, { value: any; expiresAt: number }>()\r\nconst MEMORY_TTL_MS = TTL\r\n\r\nexport async function fetchRdap(domain: string) {\r\n  const key = domain.toLowerCase()\r\n  const now = Date.now()\r\n\r\n  // 1) in-memory\r\n  const mem = memoryCache.get(key)\r\n  if (mem && mem.expiresAt > now) return mem.value\r\n\r\n  // 2) Vercel KV\r\n  try {\r\n    const kvVal = await kvGetRdap(key)\r\n    if (kvVal) {\r\n      memoryCache.set(key, { value: kvVal, expiresAt: now + MEMORY_TTL_MS })\r\n      return kvVal\r\n    }\r\n  } catch (e) {\r\n    // ignore KV errors\r\n  }\r\n\r\n  // 3) fetch RDAP upstream\r\n  const url = `https://rdap.org/domain/${encodeURIComponent(domain)}`\r\n  const res = await fetch(url, { headers: { Accept: 'application/json' } })\r\n  if (!res.ok) throw new Error(`RDAP HTTP ${res.status}`)\r\n  const data = await res.json()\r\n\r\n  // store in both caches (best-effort)\r\n  try {\r\n    memoryCache.set(key, { value: data, expiresAt: now + MEMORY_TTL_MS })\r\n    await kvSetRdap(key, data)\r\n  } catch (e) {\r\n    // ignore\r\n  }\r\n\r\n  return data\r\n}\r\n\r\n/**\r\n * Canonical RDAP schema:\r\n * {\r\n *  domain: string\r\n *  registered: boolean\r\n *  created?: string\r\n *  updated?: string\r\n *  expires?: string\r\n *  registrar?: string\r\n *  nameservers: string[]\r\n *  status: string[]\r\n *  dnssec: boolean\r\n *  contacts: { registrant?, admin?, tech? }\r\n * }\r\n */\r\nexport function normalizeToCanonical(rdap: any) {\r\n  const out: any = {\r\n    domain: rdap.ldhName || rdap.handle || null,\r\n    registered: true,\r\n    created: null,\r\n    updated: null,\r\n    expires: null,\r\n    registrar: null,\r\n    nameservers: [],\r\n    status: [],\r\n    dnssec: false,\r\n    contacts: {},\r\n    raw: rdap,\r\n  }\r\n\r\n  if (!rdap) return out\r\n\r\n  // status\r\n  if (Array.isArray(rdap.status)) out.status = rdap.status\r\n\r\n  // dnssec\r\n  if (rdap.secureDNS) out.dnssec = Boolean(rdap.secureDNS.delegationSigned)\r\n\r\n  // nameservers\r\n  if (Array.isArray(rdap.nameservers)) {\r\n    out.nameservers = rdap.nameservers.map((n: any) => n.ldhName || n.handle || String(n))\r\n  }\r\n\r\n  // events -> created/updated/expires\r\n  if (Array.isArray(rdap.events)) {\r\n    for (const e of rdap.events) {\r\n      const a = (e.eventAction || '').toLowerCase()\r\n      if (a.includes('registration') && e.eventDate) out.created = e.eventDate\r\n      if ((a.includes('last changed') || a.includes('update')) && e.eventDate) out.updated = e.eventDate\r\n      if (a.includes('expiration') && e.eventDate) out.expires = e.eventDate\r\n    }\r\n  }\r\n\r\n  // registrar\r\n  if (Array.isArray(rdap.entities)) {\r\n    const registrar = rdap.entities.find((en: any) => (en.roles || []).includes('registrar'))\r\n    if (registrar) {\r\n      out.registrar = registrar.vcardArray?.[1]?.find((r: any) => r[0] === 'fn')?.[3] || registrar.handle || null\r\n    }\r\n\r\n    // contacts\r\n    const contactRoles = ['registrant', 'administrative', 'administrivia', 'admin', 'technical', 'tech']\r\n    for (const en of rdap.entities) {\r\n      const roles: string[] = en.roles || []\r\n      if (roles.includes('registrant')) {\r\n        out.contacts.registrant = extractContact(en)\r\n      }\r\n      if (roles.includes('administrative') || roles.includes('admin')) {\r\n        out.contacts.admin = extractContact(en)\r\n      }\r\n      if (roles.includes('technical') || roles.includes('tech')) {\r\n        out.contacts.tech = extractContact(en)\r\n      }\r\n    }\r\n  }\r\n\r\n  // registered detection: if status includes 'available' or rdap.notices indicates not found\r\n  if (Array.isArray(rdap.status) && rdap.status.includes('active') === false) {\r\n    // leave as-is; many RDAP responses don't use 'available' consistently\r\n  }\r\n  // Heuristic: if rdap.ldhName exists and is not an empty string, treat as registered\r\n  out.registered = Boolean(rdap.ldhName)\r\n\r\n  return out\r\n}\r\n\r\nfunction extractContact(entity: any) {\r\n  const c: any = {}\r\n  if (entity.vcardArray && Array.isArray(entity.vcardArray[1])) {\r\n    for (const item of entity.vcardArray[1]) {\r\n      const key = item[0]\r\n      const val = item[3]\r\n      if (!key || !val) continue\r\n      if (key === 'fn') c.name = val\r\n      if (key === 'email') c.email = val\r\n      if (key === 'tel') c.phone = val\r\n      if (key === 'adr') c.address = Array.isArray(val) ? val.join(' ') : val\r\n    }\r\n  }\r\n  // fallback to handle\r\n  if (!c.name && entity.handle) c.name = entity.handle\r\n  return c\r\n}\r\n\r\nexport default { fetchRdap, normalizeToCanonical }\r\n","// Simple KV-backed rate limiter using Upstash REST if available.\r\n// If no REST KV is configured, rate limiting is a no-op (allowed).\r\n\r\nexport type RateLimitResult = {\r\n  allowed: boolean\r\n  remaining: number\r\n  resetAt: number\r\n}\r\n\r\nconst UPSTASH_URL = (process.env.UPSTASH_REDIS_REST_URL || process.env.KV_REST_API_URL || process.env.KV_REST_API_URL)?.replace(/\\/$/, '')\r\nconst UPSTASH_TOKEN = process.env.UPSTASH_REDIS_REST_TOKEN || process.env.KV_REST_API_TOKEN || process.env.KV_REST_API_WRITE_TOKEN\r\n\r\nexport type RateLimitOptions = {\r\n  windowMs: number\r\n  max: number\r\n  prefix?: string\r\n}\r\n\r\nexport async function checkRateLimit(key: string, options: RateLimitOptions): Promise<RateLimitResult> {\r\n  const { windowMs, max, prefix = 'rl' } = options\r\n  const now = Date.now()\r\n  const windowStart = Math.floor(now / windowMs) * windowMs\r\n  const bucketKey = `${prefix}:${key}:${windowStart}`\r\n\r\n  if (!UPSTASH_URL || !UPSTASH_TOKEN) {\r\n    // No KV available — allow but log for visibility\r\n    console.warn('[rate-limit] No Upstash KV configured; skipping rate limit for', key)\r\n    return { allowed: true, remaining: max, resetAt: windowStart + windowMs }\r\n  }\r\n\r\n  try {\r\n    // GET current\r\n    const getRes = await fetch(`${UPSTASH_URL}/get/${encodeURIComponent(bucketKey)}`, {\r\n      headers: { Authorization: `Bearer ${UPSTASH_TOKEN}` },\r\n    })\r\n    let current = 0\r\n    if (getRes.ok) {\r\n      const j = await getRes.json()\r\n      let resVal: any = j.result ?? 0\r\n      if (typeof resVal === 'string') {\r\n        try {\r\n          const parsed = JSON.parse(resVal)\r\n          if (parsed && typeof parsed === 'object' && 'value' in parsed) {\r\n            resVal = parsed.value\r\n          } else {\r\n            resVal = parsed\r\n          }\r\n        } catch (_) {\r\n          // leave as string\r\n        }\r\n      }\r\n      current = Number(resVal ?? 0)\r\n    }\r\n\r\n    if (current >= max) {\r\n      return { allowed: false, remaining: 0, resetAt: windowStart + windowMs }\r\n    }\r\n\r\n    // Increment (set new value)\r\n    const newValue = current + 1\r\n    await fetch(`${UPSTASH_URL}/set/${encodeURIComponent(bucketKey)}`, {\r\n      method: 'POST',\r\n      headers: {\r\n        Authorization: `Bearer ${UPSTASH_TOKEN}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ value: String(newValue) }),\r\n    })\r\n\r\n    // ensure TTL covers window\r\n    const ttlSec = Math.ceil(windowMs / 1000)\r\n    await fetch(`${UPSTASH_URL}/expire/${encodeURIComponent(bucketKey)}`, {\r\n      method: 'POST',\r\n      headers: {\r\n        Authorization: `Bearer ${UPSTASH_TOKEN}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ ttl: ttlSec }),\r\n    })\r\n\r\n    return { allowed: true, remaining: Math.max(0, max - newValue), resetAt: windowStart + windowMs }\r\n  } catch (err) {\r\n    console.error('[rate-limit] error', err)\r\n    return { allowed: true, remaining: max, resetAt: windowStart + windowMs }\r\n  }\r\n}\r\n","export function logInfo(msg: string, meta?: any) {\r\n  console.log(`[info] ${new Date().toISOString()} - ${msg}`, meta || '')\r\n}\r\n\r\nexport function logError(msg: string, meta?: any) {\r\n  console.error(`[error] ${new Date().toISOString()} - ${msg}`, meta || '')\r\n}\r\n\r\nexport default { logInfo, logError }\r\n","// Minimal OpenProvider client wrapper (placeholder).\r\n// Configure via environment variables:\r\n// OPENPROVIDER_ENABLED=true\r\n// OPENPROVIDER_BASE_URL=https://api.openprovider.eu\r\n// OPENPROVIDER_API_KEY=your_key\r\n// OPENPROVIDER_API_SECRET=your_secret\r\n\r\n// Lightweight OpenProvider client\r\n// Note: This wrapper uses basic auth via API key/secret. Set OPENPROVIDER_ENABLED=true\r\n// and add OPENPROVIDER_API_KEY/OPENPROVIDER_API_SECRET in env or Vercel project settings.\r\n\r\nimport { logInfo, logError } from './logger'\r\n\r\nasync function fetchJson(url: string, options: any = {}) {\r\n  // small timeout wrapper with verbose, but safe logging\r\n  const controller = new AbortController()\r\n  const id = setTimeout(() => controller.abort(), 15000)\r\n\r\n  const method = (options.method || 'GET').toUpperCase()\r\n  const headers = options.headers || {}\r\n  const sanitizedHeaders: Record<string, string> = {}\r\n  Object.keys(headers).forEach((k) => {\r\n    if (k.toLowerCase() === 'authorization') sanitizedHeaders[k] = 'REDACTED'\r\n    else sanitizedHeaders[k] = String((headers as any)[k])\r\n  })\r\n\r\n  try {\r\n    logInfo('OpenProvider request', { method, url, headers: sanitizedHeaders, body: options.body ? '[REDACTED_BODY]' : undefined })\r\n\r\n    const res = await fetch(url, { signal: controller.signal, ...options })\r\n\r\n    const status = res.status\r\n    let text = ''\r\n    try {\r\n      text = await res.text()\r\n    } catch (e) {\r\n      text = ''\r\n    }\r\n\r\n    // Try parse JSON for structured logging; fall back to raw text\r\n    let parsed: any = null\r\n    try {\r\n      parsed = text ? JSON.parse(text) : null\r\n    } catch (e) {\r\n      parsed = text\r\n    }\r\n\r\n    logInfo('OpenProvider response', { url, status, body: typeof parsed === 'string' ? parsed.slice(0, 2000) : parsed })\r\n\r\n    if (!res.ok) {\r\n      logError('OpenProvider non-OK response', { url, status, body: typeof parsed === 'string' ? parsed.slice(0, 2000) : parsed })\r\n      throw new Error(`OpenProvider error: ${status} ${text}`)\r\n    }\r\n\r\n    try {\r\n      return parsed ?? {}\r\n    } catch (e) {\r\n      return {}\r\n    }\r\n  } catch (err: any) {\r\n    logError('OpenProvider request failed', { url, method, message: err?.message })\r\n    throw err\r\n  } finally {\r\n    clearTimeout(id)\r\n  }\r\n}\r\n\r\nfunction getAuthHeaders() {\r\n  const key = process.env.OPENPROVIDER_API_KEY\r\n  const secret = process.env.OPENPROVIDER_API_SECRET\r\n  const headers: Record<string,string> = { 'Content-Type': 'application/json' }\r\n  if (key && secret) {\r\n    // set Authorization but do not expose value in logs\r\n    headers['Authorization'] = `Basic ${Buffer.from(`${key}:${secret}`).toString('base64')}`\r\n  }\r\n  return headers\r\n}\r\n\r\nexport async function getPricing() {\r\n  if (!process.env.OPENPROVIDER_ENABLED) return null\r\n  const base = process.env.OPENPROVIDER_BASE_URL || 'https://api.openprovider.eu'\r\n  // The exact endpoint may vary depending on OpenProvider API version; adjust if needed.\r\n  const url = `${base}/v1/domains/prices`\r\n  return fetchJson(url, { headers: getAuthHeaders() })\r\n}\r\n\r\nexport async function checkDomain(domain: string) {\r\n  if (!process.env.OPENPROVIDER_ENABLED) return null\r\n  const base = process.env.OPENPROVIDER_BASE_URL || 'https://api.openprovider.eu'\r\n  const url = `${base}/v1/domains/check?domain=${encodeURIComponent(domain)}`\r\n  return fetchJson(url, { headers: getAuthHeaders() })\r\n}\r\n\r\nexport async function whoisDomain(domain: string) {\r\n  if (!process.env.OPENPROVIDER_ENABLED) return null\r\n  const base = process.env.OPENPROVIDER_BASE_URL || 'https://api.openprovider.eu'\r\n  const url = `${base}/v1/domains/whois?domain=${encodeURIComponent(domain)}`\r\n  return fetchJson(url, { headers: getAuthHeaders() })\r\n}\r\n\r\nexport async function registerDomain(domain: string, contact: any, nameservers: string[]) {\r\n  if (!process.env.OPENPROVIDER_ENABLED) return null\r\n  const base = process.env.OPENPROVIDER_BASE_URL || 'https://api.openprovider.eu'\r\n  const url = `${base}/v1/domains/register`\r\n  return fetchJson(url, { method: 'POST', headers: getAuthHeaders(), body: JSON.stringify({ domain, contact, nameservers }) })\r\n}\r\n\r\nexport async function provisionDNS(domain: string, records: any[]) {\r\n  if (!process.env.OPENPROVIDER_ENABLED) return null\r\n  const base = process.env.OPENPROVIDER_BASE_URL || 'https://api.openprovider.eu'\r\n  const url = `${base}/v1/domains/${encodeURIComponent(domain)}/dns/records`\r\n  return fetchJson(url, { method: 'POST', headers: getAuthHeaders(), body: JSON.stringify({ records }) })\r\n}\r\n\r\nexport default { getPricing, checkDomain, whoisDomain, registerDomain, provisionDNS }\r\n","import { NextResponse } from 'next/server'\r\nimport openprovider from '@/lib/openprovider'\r\n\r\nexport async function getPricingData() {\r\n  if (process.env.OPENPROVIDER_ENABLED) {\r\n    try {\r\n      const data = await openprovider.getPricing()\r\n      if (data) return data\r\n    } catch (e) {\r\n      console.error('OpenProvider pricing error', e)\r\n    }\r\n  }\r\n  return [\r\n    { tld: '.com', price: 12.99 },\r\n    { tld: '.net', price: 14.99 },\r\n    { tld: '.digital', price: 9.99 },\r\n    { tld: '.co.nz', price: 22 },\r\n  ]\r\n}\r\n\r\nexport async function GET() {\r\n  const pricing = await getPricingData()\r\n  return NextResponse.json(pricing)\r\n}\r\n"],"names":[],"mappings":"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"}