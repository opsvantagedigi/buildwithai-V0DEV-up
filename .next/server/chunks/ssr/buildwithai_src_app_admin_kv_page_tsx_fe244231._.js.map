{"version":3,"sources":["../../../../../buildwithai/src/app/admin/kv/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState } from 'react'\r\n\r\ntype KvHealth = { success: boolean; kv: string; ts?: number; error?: string }\r\ntype WarmResult = { domain: string; ok: boolean; error?: string }\r\n\r\nexport default function KvAdminPage() {\r\n  const [health, setHealth] = useState<KvHealth | null>(null)\r\n  const [loadingHealth, setLoadingHealth] = useState(false)\r\n\r\n  const [domainsInput, setDomainsInput] = useState('example.com, openai.com')\r\n  const [warmResults, setWarmResults] = useState<WarmResult[] | null>(null)\r\n  const [warming, setWarming] = useState(false)\r\n\r\n  useEffect(() => { refreshHealth() }, [])\r\n\r\n  async function refreshHealth() {\r\n    setLoadingHealth(true)\r\n    try {\r\n      const res = await fetch('/api/kv/health')\r\n      const data = await res.json()\r\n      setHealth(data)\r\n    } catch (err) {\r\n      setHealth({ success: false, kv: 'error', error: 'Failed to load health' })\r\n    } finally { setLoadingHealth(false) }\r\n  }\r\n\r\n  async function triggerWarm() {\r\n    setWarming(true)\r\n    setWarmResults(null)\r\n    try {\r\n      const domains = domainsInput.split(',').map(d => d.trim()).filter(Boolean)\r\n      const res = await fetch('/api/kv/warm', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ domains }) })\r\n      const data = await res.json()\r\n      setWarmResults(Object.keys(data.results || {}).map(k => ({ domain: k, ok: data.results[k] === 'cached', error: typeof data.results[k] === 'string' && data.results[k].startsWith('error:') ? data.results[k] : undefined })))\r\n    } catch (err) {\r\n      setWarmResults([{ domain: 'unknown', ok: false, error: 'Warm request failed' }])\r\n    } finally { setWarming(false) }\r\n  }\r\n\r\n  return (\r\n    <main className=\"mx-auto max-w-3xl px-4 py-10 space-y-8\">\r\n      <h1 className=\"text-2xl font-semibold\">KV & RDAP Admin</h1>\r\n\r\n      <div className=\"text-sm text-gray-600\">This admin UI is protected — include <code>?token=YOUR_TOKEN</code> in the URL or set an <code>x-admin-token</code> header. Set <code>ADMIN_DASHBOARD_TOKEN</code> in your deployment environment.</div>\r\n\r\n      <section className=\"rounded-lg border p-4 bg-white space-y-2\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h2 className=\"font-semibold\">KV Health</h2>\r\n          <button onClick={refreshHealth} disabled={loadingHealth} className=\"text-sm px-3 py-1 rounded bg-gray-900 text-white disabled:opacity-50\">{loadingHealth ? 'Checking...' : 'Refresh'}</button>\r\n        </div>\r\n\r\n        {health && (\r\n          <div className=\"text-sm\">\r\n            <p><span className=\"font-medium\">Status:</span> {health.success ? 'Healthy' : 'Unhealthy'} ({health.kv})</p>\r\n            {health.ts && <p><span className=\"font-medium\">Last check:</span> {new Date(health.ts).toLocaleString()}</p>}\r\n            {health.error && <p className=\"text-red-600 text-xs mt-1\">Error: {health.error}</p>}\r\n          </div>\r\n        )}\r\n\r\n        {!health && !loadingHealth && <p className=\"text-sm text-gray-600\">No health data loaded yet.</p>}\r\n      </section>\r\n\r\n      <section className=\"rounded-lg border p-4 bg-white space-y-3\">\r\n        <h2 className=\"font-semibold\">Warm KV with domains</h2>\r\n        <p className=\"text-xs text-gray-600\">Enter a comma‑separated list of domains to pre‑fetch RDAP + KV.</p>\r\n        <textarea className=\"w-full border rounded p-2 text-sm\" rows={3} value={domainsInput} onChange={(e) => setDomainsInput(e.target.value)} />\r\n        <button onClick={triggerWarm} disabled={warming} className=\"text-sm px-3 py-1 rounded bg-blue-600 text-white disabled:opacity-50\">{warming ? 'Warming...' : 'Run warm job'}</button>\r\n\r\n        {warmResults && (\r\n          <div className=\"mt-3 text-sm\">\r\n            <h3 className=\"font-medium mb-1\">Results</h3>\r\n            <ul className=\"space-y-1\">\r\n              {warmResults.map((r, idx) => (\r\n                <li key={idx}><span className=\"font-mono\">{r.domain}</span> {r.ok ? <span className=\"text-green-700 text-xs\">OK</span> : <span className=\"text-red-700 text-xs\">FAILED {r.error ? `- ${r.error}` : ''}</span>}</li>\r\n              ))}\r\n            </ul>\r\n          </div>\r\n        )}\r\n      </section>\r\n    </main>\r\n  )\r\n}\r\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OAKe,SAAS,IACtB,GAAM,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAkB,MAChD,CAAC,EAAe,EAAiB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAE7C,CAAC,EAAc,EAAgB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,2BAC3C,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAsB,MAC9D,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAIvC,eAAe,IACb,GAAiB,GACjB,GAAI,CACF,IAAM,EAAM,MAAM,MAAM,kBAClB,EAAO,MAAM,EAAI,IAAI,GAC3B,EAAU,EACZ,CAAE,MAAO,EAAK,CACZ,EAAU,CAAE,SAAS,EAAO,GAAI,QAAS,MAAO,uBAAwB,EAC1E,QAAU,CAAE,GAAiB,EAAO,CACtC,CAEA,eAAe,IACb,GAAW,GACX,EAAe,MACf,GAAI,CACF,IAAM,EAAU,EAAa,KAAK,CAAC,KAAK,GAAG,CAAC,GAAK,EAAE,IAAI,IAAI,MAAM,CAAC,SAC5D,EAAM,MAAM,MAAM,eAAgB,CAAE,OAAQ,OAAQ,QAAS,CAAE,eAAgB,kBAAmB,EAAG,KAAM,KAAK,SAAS,CAAC,SAAE,CAAQ,EAAG,GACvI,EAAO,MAAM,EAAI,IAAI,GAC3B,EAAe,OAAO,IAAI,CAAC,EAAK,OAAO,EAAI,CAAC,GAAG,GAAG,CAAC,IAAK,AAAC,CAAE,OAAQ,EAAG,GAAI,AAAoB,aAAf,OAAO,CAAC,EAAE,CAAe,MAAkC,UAA3B,OAAO,EAAK,OAAO,CAAC,EAAE,EAAiB,EAAK,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,UAAY,EAAK,OAAO,CAAC,EAAE,MAAG,EAAU,CAAC,EAC5N,CAAE,MAAO,EAAK,CACZ,EAAe,CAAC,CAAE,OAAQ,UAAW,IAAI,EAAO,MAAO,qBAAsB,EAAE,CACjF,QAAU,CAAE,EAAW,GAAO,CAChC,CAEA,MA1BA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KAAQ,GAAgB,EAAG,EAAE,EA2BrC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,mDACd,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,kCAAyB,oBAEvC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kCAAwB,wCAAqC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,sBAAwB,yBAAsB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,kBAAoB,gBAAa,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,0BAA4B,sCAEzM,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAU,qDACjB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,yBAAgB,cAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,QAAS,EAAe,SAAU,EAAe,UAAU,gFAAwE,EAAgB,cAAgB,eAG5K,GACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oBACb,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,WAAE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,uBAAc,YAAc,IAAE,EAAO,OAAO,CAAG,UAAY,YAAY,KAAG,EAAO,EAAE,CAAC,OACtG,EAAO,EAAE,EAAI,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,WAAE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,uBAAc,gBAAkB,IAAE,IAAI,KAAK,EAAO,EAAE,EAAE,cAAc,MACpG,EAAO,KAAK,EAAI,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,sCAA4B,UAAQ,EAAO,KAAK,OAIjF,CAAC,GAAU,CAAC,GAAiB,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,kCAGrE,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAU,qDACjB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,yBAAgB,yBAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,oEACrC,CAAA,EAAA,EAAA,GAAA,EAAC,WAAA,CAAS,UAAU,oCAAoC,KAAM,EAAG,MAAO,EAAc,SAAU,AAAC,GAAM,EAAgB,EAAE,MAAM,CAAC,KAAK,IACrI,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,QAAS,EAAa,SAAU,EAAS,UAAU,gFAAwE,EAAU,aAAe,iBAE3J,GACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yBACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,4BAAmB,YACjC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,qBACX,EAAY,GAAG,CAAC,CAAC,EAAG,IACnB,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,WAAa,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,qBAAa,EAAE,MAAM,GAAQ,IAAE,EAAE,EAAE,CAAG,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,kCAAyB,OAAY,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,iCAAuB,UAAQ,EAAE,KAAK,CAAG,CAAC,EAAE,EAAE,EAAE,KAAK,CAAA,CAAE,CAAG,QAA1L,cAQzB"}