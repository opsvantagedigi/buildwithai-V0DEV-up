module.exports=[64759,__turbopack_context__=>{"use strict";var __TURBOPACK__imported__module__18442__=__turbopack_context__.i(18442),__TURBOPACK__imported__module__63803__=__turbopack_context__.i(63803),__TURBOPACK__imported__module__18442__1=__TURBOPACK__imported__module__18442__,__TURBOPACK__imported__module__18442__2=__TURBOPACK__imported__module__18442__,__TURBOPACK__imported__module__36863__=__turbopack_context__.i(36863),__TURBOPACK__imported__module__7153__=__turbopack_context__.i(7153),__TURBOPACK__imported__module__22708__=__turbopack_context__.i(22708),__TURBOPACK__imported__module__54111__=__turbopack_context__.i(54111),__TURBOPACK__imported__module__18442__3=__TURBOPACK__imported__module__18442__;function SocialProof({logos:a=[]}){return(0,__TURBOPACK__imported__module__18442__3.jsx)("section",{className:"section-py-32",children:(0,__TURBOPACK__imported__module__18442__3.jsxs)("div",{className:"max-w-6xl mx-auto px-6",children:[(0,__TURBOPACK__imported__module__18442__3.jsx)("h3",{className:"text-lg font-medium gradient-text",children:"Trusted by teams and creators"}),(0,__TURBOPACK__imported__module__18442__3.jsx)("div",{className:"mt-6 flex flex-wrap items-center gap-6",children:0===a.length?(0,__TURBOPACK__imported__module__18442__3.jsx)("p",{className:"text-sm text-[rgba(255,255,255,0.85)]",children:"Join thousands of builders using BUILD WITH AI."}):a.map((a,b)=>(0,__TURBOPACK__imported__module__18442__3.jsx)("img",{src:a,alt:`logo-${b}`,className:"h-8 opacity-80"},b))})]})})}function BlockRenderer({block:a}){let{type:b,data:c}=a;return"hero"===b?(0,__TURBOPACK__imported__module__18442__2.jsx)(__TURBOPACK__imported__module__36863__.default,{...c||{}}):"features"===b?(0,__TURBOPACK__imported__module__18442__2.jsx)(__TURBOPACK__imported__module__7153__.default,{items:c?.features||[]}):"cta"===b?(0,__TURBOPACK__imported__module__18442__2.jsx)(__TURBOPACK__imported__module__22708__.default,{...c||{}}):"faq"===b?(0,__TURBOPACK__imported__module__18442__2.jsx)(__TURBOPACK__imported__module__54111__.default,{items:c?.items||[]}):"social-proof"===b?(0,__TURBOPACK__imported__module__18442__2.jsx)(SocialProof,{...c||{}}):"text"===b?(0,__TURBOPACK__imported__module__18442__2.jsx)("div",{className:"prose",dangerouslySetInnerHTML:{__html:c?.html||"<p>Text block</p>"}}):(0,__TURBOPACK__imported__module__18442__2.jsxs)("div",{className:"text-sm text-slate-500",children:["Unknown block type: ",b]})}var __TURBOPACK__imported__module__18442__4=__TURBOPACK__imported__module__18442__;function PageNavigator(){return(0,__TURBOPACK__imported__module__18442__4.jsxs)("div",{className:"flex items-center justify-between",children:[(0,__TURBOPACK__imported__module__18442__4.jsx)("div",{className:"text-sm text-slate-600",children:"Page: Home"}),(0,__TURBOPACK__imported__module__18442__4.jsxs)("div",{className:"flex gap-2",children:[(0,__TURBOPACK__imported__module__18442__4.jsx)("button",{className:"gds-btn",children:"Add page"}),(0,__TURBOPACK__imported__module__18442__4.jsx)("button",{className:"gds-btn",children:"Rename"})]})]})}function Canvas({blocks:a=[],className:b="",selectedBlockId:c,onSelectBlock:d}){return(0,__TURBOPACK__imported__module__18442__1.jsxs)("div",{className:`bg-white rounded-lg shadow p-6 ${b}`,children:[(0,__TURBOPACK__imported__module__18442__1.jsx)("div",{className:"mb-4",children:(0,__TURBOPACK__imported__module__18442__1.jsx)(PageNavigator,{})}),(0,__TURBOPACK__imported__module__18442__1.jsxs)("div",{className:"space-y-6",children:[0===a.length&&(0,__TURBOPACK__imported__module__18442__1.jsx)("div",{className:"text-sm text-slate-500",children:"Empty page — add a block."}),a.map(a=>{let b=a.id===c;return(0,__TURBOPACK__imported__module__18442__1.jsxs)("div",{className:["border rounded p-3 cursor-pointer transition-colors",b?"border-slate-900 ring-2 ring-slate-900/40":"border-slate-200 hover:border-slate-300"].join(" "),onClick:()=>d?.(a.id),children:[(0,__TURBOPACK__imported__module__18442__1.jsxs)("div",{className:[b?"bg-slate-900 text-white":"bg-slate-200 text-slate-700","absolute -mt-6 ml-3 text-[10px] px-1.5 py-0.5 rounded uppercase tracking-wide"].join(" "),children:[a.type,b?" • selected":""]}),(0,__TURBOPACK__imported__module__18442__1.jsx)(BlockRenderer,{block:a})]},a.id)})]})]})}var __TURBOPACK__imported__module__18442__5=__TURBOPACK__imported__module__18442__;function Sidebar({blocks:a,selectedBlockId:b,onAddBlock:c,onRemoveBlock:d,onSelectBlock:e}){let f=[{type:"hero",label:"Hero"},{type:"features",label:"Features"},{type:"testimonials",label:"Testimonials"},{type:"faq",label:"FAQ"},{type:"cta",label:"Call to Action"}];return(0,__TURBOPACK__imported__module__18442__5.jsxs)("aside",{className:"w-72 border-r bg-slate-50 p-4 flex flex-col gap-4",children:[(0,__TURBOPACK__imported__module__18442__5.jsxs)("div",{children:[(0,__TURBOPACK__imported__module__18442__5.jsx)("h2",{className:"text-sm font-semibold mb-2",children:"Add sections"}),(0,__TURBOPACK__imported__module__18442__5.jsx)("div",{className:"grid grid-cols-1 gap-2",children:f.map(a=>(0,__TURBOPACK__imported__module__18442__5.jsx)("button",{className:"border rounded px-3 py-2 text-xs text-left bg-white hover:bg-slate-100",onClick:()=>c(a.type),children:a.label},a.type))})]}),(0,__TURBOPACK__imported__module__18442__5.jsxs)("div",{className:"flex-1",children:[(0,__TURBOPACK__imported__module__18442__5.jsx)("h2",{className:"text-sm font-semibold mb-2",children:"Sections"}),0===a.length?(0,__TURBOPACK__imported__module__18442__5.jsx)("p",{className:"text-xs text-slate-400",children:"No sections yet. Add a hero or features to start."}):(0,__TURBOPACK__imported__module__18442__5.jsx)("ul",{className:"space-y-1",children:a.map((a,c)=>{let f=a.id===b;return(0,__TURBOPACK__imported__module__18442__5.jsxs)("li",{className:["flex items-center justify-between text-xs border rounded px-2 py-1 cursor-pointer",f?"bg-slate-900 text-white border-slate-900":"bg-white hover:bg-slate-100 border-slate-200"].join(" "),onClick:()=>e?.(a.id),children:[(0,__TURBOPACK__imported__module__18442__5.jsxs)("span",{className:"truncate",children:[c+1,". ",a.type,f&&" • editing"]}),(0,__TURBOPACK__imported__module__18442__5.jsx)("button",{className:"text-[10px] "+(f?"text-slate-200":"text-red-500"),onClick:b=>{b.stopPropagation(),d(a.id)},children:"Remove"})]},a.id)})})]})]})}var __TURBOPACK__imported__module__18442__6=__TURBOPACK__imported__module__18442__,__TURBOPACK__imported__module__63803__1=__TURBOPACK__imported__module__63803__,__TURBOPACK__imported__module__18442__7=__TURBOPACK__imported__module__18442__,__TURBOPACK__imported__module__63803__2=__TURBOPACK__imported__module__63803__;function ImageField({label:a,value:b,onChange:c}){let d=(0,__TURBOPACK__imported__module__63803__2.useRef)(null);function e(a){let b=a.target.files?.[0];if(!b)return c(null);let d=new FileReader;d.onload=()=>{c(d.result)},d.readAsDataURL(b)}return(0,__TURBOPACK__imported__module__18442__7.jsxs)("div",{className:"space-y-1",children:[(0,__TURBOPACK__imported__module__18442__7.jsx)("label",{className:"block text-xs font-medium text-slate-600",children:a}),b&&(0,__TURBOPACK__imported__module__18442__7.jsx)("img",{src:b,alt:"Preview",className:"w-full h-auto rounded border mb-2"}),(0,__TURBOPACK__imported__module__18442__7.jsx)("input",{ref:d,type:"file",accept:"image/*",className:"text-xs",onChange:e})]})}var __TURBOPACK__imported__module__18442__8=__TURBOPACK__imported__module__18442__;function TextField({label:a,value:b,onChange:c}){return(0,__TURBOPACK__imported__module__18442__8.jsxs)("label",{className:"block text-xs font-medium text-slate-600",children:[a,(0,__TURBOPACK__imported__module__18442__8.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1 text-sm",value:b??"",onChange:a=>c(a.target.value)})]})}var __TURBOPACK__imported__module__18442__9=__TURBOPACK__imported__module__18442__;function FeatureListEditor({items:a,onChange:b}){function c(c,d,e){let f=[...a];f[c]={...f[c],[d]:e},b(f)}function d(){b([...a,{title:"",description:""}])}function e(c){b(a.filter((a,b)=>b!==c))}return(0,__TURBOPACK__imported__module__18442__9.jsxs)("div",{className:"space-y-3",children:[(0,__TURBOPACK__imported__module__18442__9.jsx)("h3",{className:"text-xs font-semibold text-slate-600",children:"Features"}),a.map((a,b)=>(0,__TURBOPACK__imported__module__18442__9.jsxs)("div",{className:"border rounded p-3 bg-slate-50 space-y-2 relative",children:[(0,__TURBOPACK__imported__module__18442__9.jsx)("button",{className:"absolute top-2 right-2 text-red-500 text-xs",onClick:()=>e(b),children:"✕"}),(0,__TURBOPACK__imported__module__18442__9.jsx)("input",{className:"w-full border rounded px-2 py-1 text-xs",placeholder:"Feature title",value:a.title,onChange:a=>c(b,"title",a.target.value)}),(0,__TURBOPACK__imported__module__18442__9.jsx)("textarea",{className:"w-full border rounded px-2 py-1 text-xs",placeholder:"Feature description",value:a.description,onChange:a=>c(b,"description",a.target.value)})]},b)),(0,__TURBOPACK__imported__module__18442__9.jsx)("button",{className:"px-2 py-1 text-xs bg-slate-200 rounded hover:bg-slate-300",onClick:d,children:"+ Add Feature"})]})}var __TURBOPACK__imported__module__18442__10=__TURBOPACK__imported__module__18442__;function FAQEditor({items:a,onChange:b}){function c(c,d,e){let f=[...a];f[c]={...f[c],[d]:e},b(f)}function d(){b([...a,{question:"",answer:""}])}function e(c){b(a.filter((a,b)=>b!==c))}return(0,__TURBOPACK__imported__module__18442__10.jsxs)("div",{className:"space-y-3",children:[(0,__TURBOPACK__imported__module__18442__10.jsx)("h3",{className:"text-xs font-semibold text-slate-600",children:"FAQ Items"}),a.map((a,b)=>(0,__TURBOPACK__imported__module__18442__10.jsxs)("div",{className:"border rounded p-3 bg-slate-50 space-y-2 relative",children:[(0,__TURBOPACK__imported__module__18442__10.jsx)("button",{className:"absolute top-2 right-2 text-red-500 text-xs",onClick:()=>e(b),children:"✕"}),(0,__TURBOPACK__imported__module__18442__10.jsx)("input",{className:"w-full border rounded px-2 py-1 text-xs",placeholder:"Question",value:a.question,onChange:a=>c(b,"question",a.target.value)}),(0,__TURBOPACK__imported__module__18442__10.jsx)("textarea",{className:"w-full border rounded px-2 py-1 text-xs",placeholder:"Answer",value:a.answer,onChange:a=>c(b,"answer",a.target.value)})]},b)),(0,__TURBOPACK__imported__module__18442__10.jsx)("button",{className:"px-2 py-1 text-xs bg-slate-200 rounded hover:bg-slate-300",onClick:d,children:"+ Add FAQ Item"})]})}var __TURBOPACK__imported__module__18442__11=__TURBOPACK__imported__module__18442__;function TestimonialEditor({testimonials:a,onChange:b}){function c(c,d,e){let f=[...a];f[c]={...f[c],[d]:e},b(f)}function d(){b([...a,{name:"",quote:"",avatar:""}])}function e(c){b(a.filter((a,b)=>b!==c))}return(0,__TURBOPACK__imported__module__18442__11.jsxs)("div",{className:"space-y-3",children:[(0,__TURBOPACK__imported__module__18442__11.jsx)("h3",{className:"text-xs font-semibold text-slate-600",children:"Testimonials"}),a.map((a,b)=>(0,__TURBOPACK__imported__module__18442__11.jsxs)("div",{className:"border rounded p-3 bg-slate-50 space-y-2 relative",children:[(0,__TURBOPACK__imported__module__18442__11.jsx)("button",{className:"absolute top-2 right-2 text-red-500 text-xs",onClick:()=>e(b),children:"✕"}),(0,__TURBOPACK__imported__module__18442__11.jsx)("input",{className:"w-full border rounded px-2 py-1 text-xs",placeholder:"Name",value:a.name,onChange:a=>c(b,"name",a.target.value)}),(0,__TURBOPACK__imported__module__18442__11.jsx)("textarea",{className:"w-full border rounded px-2 py-1 text-xs",placeholder:"Quote",value:a.quote,onChange:a=>c(b,"quote",a.target.value)}),(0,__TURBOPACK__imported__module__18442__11.jsx)("input",{className:"w-full border rounded px-2 py-1 text-xs",placeholder:"Avatar URL",value:a.avatar,onChange:a=>c(b,"avatar",a.target.value)})]},b)),(0,__TURBOPACK__imported__module__18442__11.jsx)("button",{className:"px-2 py-1 text-xs bg-slate-200 rounded hover:bg-slate-300",onClick:d,children:"+ Add Testimonial"})]})}var __TURBOPACK__imported__module__18442__12=__TURBOPACK__imported__module__18442__;function ToneSelector({value:a,onChange:b}){let c=["professional","friendly","bold","playful","luxury"];return(0,__TURBOPACK__imported__module__18442__12.jsxs)("div",{className:"space-y-1",children:[(0,__TURBOPACK__imported__module__18442__12.jsx)("label",{className:"block text-xs font-medium text-slate-600",children:"Tone / Style"}),(0,__TURBOPACK__imported__module__18442__12.jsxs)("select",{className:"w-full border rounded px-2 py-1 text-sm",value:a??"",onChange:a=>b(a.target.value),children:[(0,__TURBOPACK__imported__module__18442__12.jsx)("option",{value:"",children:"Default"}),c.map(a=>(0,__TURBOPACK__imported__module__18442__12.jsx)("option",{value:a,children:a},a))]})]})}var __TURBOPACK__imported__module__18442__13=__TURBOPACK__imported__module__18442__,__TURBOPACK__imported__module__63803__3=__TURBOPACK__imported__module__63803__;function AIRewriteButton({text:a,onRewrite:b}){let[c,d]=(0,__TURBOPACK__imported__module__63803__3.useState)(!1);async function e(){if(a){d(!0);try{let c=await fetch("/api/ai/content",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slot:"rewrite",context:{text:a}})}),d=await c.json();d?.text&&b(d.text)}catch(a){console.error("[AI_REWRITE_ERROR]",a)}finally{d(!1)}}}return(0,__TURBOPACK__imported__module__18442__13.jsx)("button",{onClick:e,disabled:c,className:"text-xs px-2 py-1 bg-slate-200 rounded hover:bg-slate-300",children:c?"Rewriting…":"Rewrite with AI"})}function BlockEditorSidebar({block:a,onChange:b,onRegenerate:c,onMoveUp:d,onMoveDown:e,onDelete:f}){if(!a)return(0,__TURBOPACK__imported__module__18442__6.jsx)("aside",{className:"w-96 border-l bg-slate-50 p-6 text-sm text-slate-500",children:"Select a section to edit its content."});let[g,h]=(0,__TURBOPACK__imported__module__63803__1.useState)(a.data??{});function i(a,c){let d={...g,[a]:c};h(d),b(d)}function j(){if(!a)return null;switch(a.type){case"hero":return(0,__TURBOPACK__imported__module__18442__6.jsxs)("div",{className:"space-y-4",children:[(0,__TURBOPACK__imported__module__18442__6.jsx)(TextField,{label:"Heading",value:g.heading,onChange:a=>i("heading",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(AIRewriteButton,{text:g.heading,onRewrite:a=>i("heading",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(TextField,{label:"Subheading",value:g.subheading,onChange:a=>i("subheading",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(AIRewriteButton,{text:g.subheading,onRewrite:a=>i("subheading",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(TextField,{label:"Primary CTA",value:g.primaryCta,onChange:a=>i("primaryCta",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(TextField,{label:"Secondary CTA",value:g.secondaryCta,onChange:a=>i("secondaryCta",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(ImageField,{label:"Hero Image",value:g.image,onChange:a=>i("image",a)})]});case"features":return(0,__TURBOPACK__imported__module__18442__6.jsxs)("div",{className:"space-y-4",children:[(0,__TURBOPACK__imported__module__18442__6.jsx)(TextField,{label:"Title",value:g.title,onChange:a=>i("title",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(AIRewriteButton,{text:g.title,onRewrite:a=>i("title",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(TextField,{label:"Subtitle",value:g.subtitle,onChange:a=>i("subtitle",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(AIRewriteButton,{text:g.subtitle,onRewrite:a=>i("subtitle",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(FeatureListEditor,{items:g.items??[],onChange:a=>i("items",a)})]});case"faq":return(0,__TURBOPACK__imported__module__18442__6.jsx)(FAQEditor,{items:g.items??[],onChange:a=>i("items",a)});case"testimonials":return(0,__TURBOPACK__imported__module__18442__6.jsx)(TestimonialEditor,{testimonials:g.testimonials??[],onChange:a=>i("testimonials",a)});case"cta":return(0,__TURBOPACK__imported__module__18442__6.jsxs)("div",{className:"space-y-4",children:[(0,__TURBOPACK__imported__module__18442__6.jsx)(TextField,{label:"Heading",value:g.heading,onChange:a=>i("heading",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(AIRewriteButton,{text:g.heading,onRewrite:a=>i("heading",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(TextField,{label:"Subheading",value:g.subheading,onChange:a=>i("subheading",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(AIRewriteButton,{text:g.subheading,onRewrite:a=>i("subheading",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(TextField,{label:"Primary CTA",value:g.primaryCta,onChange:a=>i("primaryCta",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)(TextField,{label:"Secondary CTA",value:g.secondaryCta,onChange:a=>i("secondaryCta",a)})]});default:return(0,__TURBOPACK__imported__module__18442__6.jsxs)("p",{className:"text-xs text-slate-500",children:["No editor available for block type: ",a.type]})}}return(0,__TURBOPACK__imported__module__18442__6.jsxs)("aside",{className:"w-96 border-l bg-white p-6 overflow-y-auto",children:[(0,__TURBOPACK__imported__module__18442__6.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Edit Section"}),(0,__TURBOPACK__imported__module__18442__6.jsx)("div",{className:"space-y-6",children:j()}),(0,__TURBOPACK__imported__module__18442__6.jsxs)("div",{className:"mt-8 space-y-4",children:[(0,__TURBOPACK__imported__module__18442__6.jsx)(ToneSelector,{value:g.tone,onChange:a=>i("tone",a)}),(0,__TURBOPACK__imported__module__18442__6.jsx)("button",{onClick:async()=>{try{let c=await fetch("/api/ai/section/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({section:{id:a.id,type:a.type,data:g},context:{tone:g.tone}})}),d=await c.json();if(d?.section?.data){let a={...g,...d.section.data};h(a),b(a)}}catch(a){console.error("[AI_REGENERATE_ERROR]",a)}},className:"w-full px-4 py-2 rounded bg-slate-900 text-white text-sm",children:"Regenerate with AI"}),(0,__TURBOPACK__imported__module__18442__6.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-600",children:[(0,__TURBOPACK__imported__module__18442__6.jsx)("button",{onClick:d,className:"hover:text-slate-900",children:"↑ Move Up"}),(0,__TURBOPACK__imported__module__18442__6.jsx)("button",{onClick:e,className:"hover:text-slate-900",children:"↓ Move Down"}),(0,__TURBOPACK__imported__module__18442__6.jsx)("button",{onClick:()=>{b({__duplicate__:!0,...g})},className:"hover:text-slate-900",children:"Duplicate"}),(0,__TURBOPACK__imported__module__18442__6.jsx)("button",{onClick:f,className:"text-red-500 hover:text-red-700",children:"Delete"})]})]})]})}let kvClient=null,WRITE_ENABLED=!1,READ_ONLY_ONLY=!1,NO_WRITE_FALLBACK=!1;try{process.env.KV_REST_API_URL||(process.env.KV_REST_API_URL=process.env.UPSTASH_REDIS_REST_URL||process.env.KV_REST_API_URL),process.env.KV_REST_API_TOKEN||(process.env.KV_REST_API_TOKEN=process.env.KV_REST_API_WRITE_TOKEN||process.env.UPSTASH_REDIS_REST_TOKEN||process.env.KV_REST_API_READ_ONLY_TOKEN||process.env.KV_REST_API_TOKEN),WRITE_ENABLED=!!(process.env.KV_REST_API_WRITE_TOKEN||process.env.KV_REST_API_TOKEN),READ_ONLY_ONLY=!!process.env.KV_REST_API_READ_ONLY_TOKEN&&!WRITE_ENABLED,NO_WRITE_FALLBACK="true"===process.env.NO_WRITE_FALLBACK||READ_ONLY_ONLY;let earlyUpstashUrl=process.env.UPSTASH_REDIS_REST_URL,earlyUpstashToken=process.env.UPSTASH_REDIS_REST_TOKEN;if(earlyUpstashUrl&&earlyUpstashToken){let base=earlyUpstashUrl.replace(/\/$/,"");kvClient={async get(a){try{let b=await fetch(`${base}/get/${encodeURIComponent(a)}`,{headers:{Authorization:`Bearer ${earlyUpstashToken}`}});if(!b.ok)return null;return(await b.json()).result??null}catch(a){return console.error("[KV] early REST get() failed:",a),null}},async set(a,b){if(NO_WRITE_FALLBACK)return{skippedReadOnly:!0};try{return await fetch(`${base}/set/${encodeURIComponent(a)}`,{method:"POST",headers:{Authorization:`Bearer ${earlyUpstashToken}`,"Content-Type":"application/json"},body:JSON.stringify({value:"string"==typeof b?b:JSON.stringify(b)})}),!0}catch(a){return console.error("[KV] early REST set() failed:",a),null}},async expire(a,b){if(NO_WRITE_FALLBACK)return null;try{return await fetch(`${base}/expire/${encodeURIComponent(a)}`,{method:"POST",headers:{Authorization:`Bearer ${earlyUpstashToken}`,"Content-Type":"application/json"},body:JSON.stringify({ttl:b})}),!0}catch(a){return console.error("[KV] early REST expire() failed:",a),null}}}}let moduleName="@vercel/kv",kvModule=eval("require")(moduleName),candidate=kvModule?.kv??kvModule?.default??kvModule;if("function"==typeof candidate){let factory=candidate,makeLazy=a=>{let b=null,c=!1,d=async()=>{if(b||c)return b;c=!0;try{let c=process.env.KV_REST_API_URL||process.env.UPSTASH_REDIS_REST_URL,d=process.env.KV_REST_API_TOKEN||process.env.UPSTASH_REDIS_REST_TOKEN;(b=await a({url:c,token:d}))&&"function"==typeof b.get&&"function"==typeof b.set||(b=null)}catch(a){b=null}return b};return{async get(a){let b=await d();if(!b)throw Error("kv_not_initialized");return b.get(a)},async set(a,b){let c=await d();if(!c)throw Error("kv_not_initialized");return c.set(a,b)},async expire(a,b){let c=await d();if(!c)throw Error("kv_not_initialized");return"function"==typeof c.expire?c.expire(a,b):null}}};try{candidate=makeLazy(factory)}catch(err){}}if(candidate&&"function"==typeof candidate.get&&"function"==typeof candidate.set)kvClient=candidate;else throw console.warn("[KV] Falling back to Upstash REST wrapper: invalid client shape",Object.keys(kvModule||{})),Error("invalid_kv_client_shape")}catch(e){let upstashUrl=process.env.UPSTASH_REDIS_REST_URL,upstashToken=process.env.UPSTASH_REDIS_REST_TOKEN;if(upstashUrl&&upstashToken){let base=upstashUrl.replace(/\/$/,"");kvClient={async get(a){try{let b=await fetch(`${base}/get/${encodeURIComponent(a)}`,{headers:{Authorization:`Bearer ${upstashToken}`}});if(!b.ok)return null;return(await b.json()).result??null}catch(a){return console.error("[KV] get() failed:",a),null}},async set(a,b){if(NO_WRITE_FALLBACK)return{skippedReadOnly:!0};try{return await fetch(`${base}/set/${encodeURIComponent(a)}`,{method:"POST",headers:{Authorization:`Bearer ${upstashToken}`,"Content-Type":"application/json"},body:JSON.stringify({value:"string"==typeof b?b:JSON.stringify(b)})}),!0}catch(a){return console.error("[KV] set() failed:",a),null}},async expire(a,b){if(NO_WRITE_FALLBACK)return null;try{return await fetch(`${base}/expire/${encodeURIComponent(a)}`,{method:"POST",headers:{Authorization:`Bearer ${upstashToken}`,"Content-Type":"application/json"},body:JSON.stringify({ttl:b})}),!0}catch(a){return console.error("[KV] expire() failed:",a),null}}}}else kvClient=null}let RDAP_TTL_SECONDS=300;async function kvGetRdap(a){if(!kvClient)return null;try{let b=`rdap:${a.toLowerCase()}`;return await kvClient.get(b)??null}catch(a){return null}}async function kvSetRdap(a,b){if(!kvClient)return null;if(NO_WRITE_FALLBACK)return{skippedReadOnly:!0};try{let c=`rdap:${a.toLowerCase()}`,d=await kvClient.set(c,b);try{"function"==typeof kvClient.expire&&await kvClient.expire(c,RDAP_TTL_SECONDS)}catch(a){}return d}catch(a){return null}}let kv={async get(a){if(!kvClient)return null;try{let b=await kvClient.get(a);if(null==b)return null;let c=b;if("string"==typeof b)try{c=JSON.parse(b)}catch(a){c=b}if(c&&"object"==typeof c&&"value"in c){let a=c.value;if("string"==typeof a)try{return JSON.parse(a)}catch(a){}return a}return c}catch(b){console.error("[KV] get() failed:",b);try{if(process.env.UPSTASH_REDIS_REST_URL&&process.env.UPSTASH_REDIS_REST_TOKEN){let b=(process.env.UPSTASH_REDIS_REST_URL||"").replace(/\/$/,""),c=process.env.UPSTASH_REDIS_REST_TOKEN,d=`${b}/get/${encodeURIComponent(a)}`;console.log("[KV] attempting Upstash REST fallback GET",d);let e=await fetch(d,{headers:{Authorization:`Bearer ${c}`}});if(console.log("[KV] upstash REST fallback status",e.status),!e.ok)return null;let f=await e.json();return console.log("[KV] upstash REST fallback body keys",Object.keys(f||{})),f.result??null}}catch(a){console.error("[KV] upstash REST fallback failed:",a)}return null}},async set(a,b,c){if(!kvClient)return null;if(NO_WRITE_FALLBACK)return{skippedReadOnly:!0};try{let d=await kvClient.set(a,b);if(c?.ex&&"function"==typeof kvClient.expire)try{await kvClient.expire(a,Math.ceil(c.ex))}catch(a){}return d}catch(a){return console.error("[KV] set() failed:",a),null}}},__TURBOPACK__default__export__={};function getKvStatus(){return{writeEnabled:WRITE_ENABLED,readOnlyOnly:READ_ONLY_ONLY,noWriteFallback:NO_WRITE_FALLBACK,kvClientPresent:!!kvClient,kvUrl:process.env.KV_REST_API_URL||process.env.UPSTASH_REDIS_REST_URL||null}}async function debugKvRoundTrip(){let a="debug:kv:test",b={ok:!0,ts:Date.now()};console.log("[KV] Writing test key:",a);let c=await kv.set(a,JSON.stringify(b));console.log("[KV] Write result:",c);let d=await kv.get(a);return console.log("[KV] Read result:",d),{writeResult:c,readResult:d}}let KEY_PREFIX="buildwithai:site:";async function loadSiteState(a){let b=`${KEY_PREFIX}${a}`,c=await kv.get(b);if(!c)return null;let d=c;if("string"==typeof c)try{d=JSON.parse(c)}catch{return null}return d&&"object"==typeof d&&d.metadata&&d.pages?(d.metadata={id:d.metadata.id??a,name:d.metadata.name??"",description:d.metadata.description??"",createdAt:d.metadata.createdAt??Date.now(),updatedAt:d.metadata.updatedAt??Date.now(),version:d.metadata.version??1},Array.isArray(d.pages)||(d.pages=[]),d):null}let KEY_PREFIX1="buildwithai:site:";async function saveSiteState(a,b){let c=`${KEY_PREFIX1}${a}`,d=b.metadata??{id:a,createdAt:Date.now(),updatedAt:Date.now(),version:1},e={...d,updatedAt:Date.now(),version:(d.version??0)+1},f=JSON.stringify({...b,metadata:e});await kv.set(c,f)}async function saveSite(a,b){return saveSiteState(a,b)}let SITE_REGISTRY_PREFIX="buildwithai:sites",SITE_REGISTRY_INDEX="buildwithai:sites:index";async function registerSite(a,b){let c=`${SITE_REGISTRY_PREFIX}:${a}`,d=await kv.get(c);if(d)return d;let e={id:a,name:b,createdAt:Date.now(),updatedAt:Date.now()};await kv.set(c,e);try{let b=await kv.get(SITE_REGISTRY_INDEX),c=Array.isArray(b)?Array.from(new Set([...b,a])):[a];await kv.set(SITE_REGISTRY_INDEX,c)}catch(a){}return e}async function updateSiteTimestamp(a){let b=`${SITE_REGISTRY_PREFIX}:${a}`,c=await kv.get(b);c&&(c.updatedAt=Date.now(),await kv.set(b,c))}async function listSites(){let a=await kv.get(SITE_REGISTRY_INDEX),b=[];if(!Array.isArray(a)||0===a.length)return b;for(let c of a){let a=`${SITE_REGISTRY_PREFIX}:${c}`,d=await kv.get(a);d&&b.push(d)}return b.sort((a,b)=>b.updatedAt-a.updatedAt)}async function getSite(a){let b=await loadSiteState(a);return b?{id:a,name:b.metadata?.name??"Untitled",createdAt:b.metadata?.createdAt??Date.now(),updatedAt:b.metadata?.updatedAt??Date.now()}:null}function BuilderCanvas({params:a}){let b=a.id,[c,d]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[e,f]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[g,h]=(0,__TURBOPACK__imported__module__63803__.useState)(!1),[i,j]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[k,l]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[m,n]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[o,p]=(0,__TURBOPACK__imported__module__63803__.useState)(!1),[q,r]=(0,__TURBOPACK__imported__module__63803__.useState)(!1),[s,t]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[u,v]=(0,__TURBOPACK__imported__module__63803__.useState)(!1),[w,x]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[y,z]=(0,__TURBOPACK__imported__module__63803__.useState)(!1),[A,B]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[C,D]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[E,F]=(0,__TURBOPACK__imported__module__63803__.useState)(!1),[G,H]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[I,J]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[K,L]=(0,__TURBOPACK__imported__module__63803__.useState)({}),[M,N]=(0,__TURBOPACK__imported__module__63803__.useState)(null),[O,P]=(0,__TURBOPACK__imported__module__63803__.useState)({});async function Q(){if(c){h(!0),l(null);try{let a=await fetch("/api/publish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:b})});if(!a.ok){let b=await a.json().catch(()=>({}));l(b?.error??`Publish failed with status ${a.status}`),h(!1);return}let c=await a.json();c?.publish&&j(c.publish),c?.history&&n(c.history)}catch(a){l(a?.message??"Unexpected error during publish")}finally{h(!1)}}}async function R(){v(!0),x(null);try{let a=await fetch("/api/publish/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:b})}),c=await a.json();c?.previewUrl&&x(c.previewUrl)}catch(a){console.error("Preview error",a)}finally{v(!1)}}async function S(){z(!0),B(null),D(null);try{let a=await fetch("/api/publish/staging",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:b})}),c=await a.json();if(!a.ok){D(c?.error??"Staging deploy failed"),z(!1);return}c?.stagingUrl&&B(c.stagingUrl)}catch(a){D(a?.message??"Unexpected staging error")}finally{z(!1)}}async function T(){let a=await fetch(`/api/publish/history?siteId=${b}`);if(!a.ok)return;let c=await a.json();c?.history&&n(c.history)}async function U(a){r(!0),t(null);try{let c=await fetch("/api/publish/rollback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:b,version:a})});if(!c.ok){let a=await c.json().catch(()=>({}));t(a?.error??`Restore failed with status ${c.status}`),r(!1);return}window.location.reload()}catch(a){t(a?.message??"Unexpected restore error")}finally{r(!1)}}async function V(a){if(void 0!==K[a])return;let c=await fetch(`/api/publish/changelog?siteId=${b}&version=${a}`);if(!c.ok)return void L(b=>({...b,[a]:null}));let d=await c.json();L(b=>({...b,[a]:d?.changelog??null}))}async function W(a){if(void 0!==O[a])return;let c=await fetch(`/api/publish/release-notes?siteId=${b}&version=${a}`);if(!c.ok)return void P(b=>({...b,[a]:null}));let d=await c.json();P(b=>({...b,[a]:d?.releaseNotes??null}))}(0,__TURBOPACK__imported__module__63803__.useEffect)(()=>{!async function(){let a=await loadSiteState(b);if(a)return d(a);let c=localStorage.getItem(`buildwithai:site:${b}`);if(c)try{let a=JSON.parse(c),e={metadata:{id:b,name:a?.metadata?.name??"Untitled",createdAt:a?.metadata?.createdAt??Date.now(),updatedAt:a?.metadata?.updatedAt??Date.now(),version:a?.metadata?.version??1},pages:a.pages??[{id:"page-1",title:"Home",slug:"/",blocks:[]}],activePageId:a.activePageId??"page-1"};d(e),await saveSiteState(b,e)}catch(a){}}()},[b]),(0,__TURBOPACK__imported__module__63803__.useEffect)(()=>{!async function(){let a=await getSite(b);H(a),a?.name&&(await registerSite(b,a.name),await updateSiteTimestamp(b))}()},[b]),(0,__TURBOPACK__imported__module__63803__.useEffect)(()=>{if(!c?.metadata)return;let a=setTimeout(()=>{saveSiteState(b,c)},500);return()=>clearTimeout(a)},[c,b]);let X=c?.pages.find(a=>a.id===c.activePageId)??c?.pages[0],Y=X?.blocks??[];function Z(a){X&&d(b=>({...b,pages:b.pages.map(b=>b.id===X.id?{...b,blocks:[...b.blocks,{id:crypto.randomUUID(),type:a,data:{}}]}:b)}))}function $(a,b,c){d(d=>({...d,pages:d.pages.map(d=>d.id===a?{...d,blocks:d.blocks.map(a=>a.id===b?{...a,data:c}:a)}:d)}))}function _(a){X&&(d(b=>({...b,pages:b.pages.map(b=>b.id===X.id?{...b,blocks:b.blocks.filter(b=>b.id!==a)}:b)})),e===a&&f(null))}function aa(a,b,c){d(d=>{let e=d.pages.map(d=>{if(d.id!==a)return d;let e=d.blocks.findIndex(a=>a.id===b);if(-1===e)return d;let f=[...d.blocks];if("up"===c&&e>0){let a=f[e-1];f[e-1]=f[e],f[e]=a}if("down"===c&&e<f.length-1){let a=f[e+1];f[e+1]=f[e],f[e]=a}return{...d,blocks:f}});return{...d,pages:e}})}function ab(a,b){d(c=>{let d=c.pages.map(c=>{if(c.id!==a)return c;let d={...b,id:crypto.randomUUID()};return{...c,blocks:[...c.blocks,d]}});return{...c,pages:d}})}function ac(a,b){d(c=>{let d=c.pages.map(c=>c.id===a?{...c,blocks:c.blocks.filter(a=>a.id!==b)}:c);return{...c,pages:d}}),e===b&&f(null)}return(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"flex h-screen",children:[(0,__TURBOPACK__imported__module__18442__.jsx)(Sidebar,{blocks:Y,selectedBlockId:e,onAddBlock:Z,onRemoveBlock:_,onSelectBlock:a=>f(a)}),(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"flex-1 p-6 overflow-auto flex flex-col gap-4",children:[(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"min-w-0",children:[(0,__TURBOPACK__imported__module__18442__.jsxs)("h1",{className:"text-xl font-semibold truncate",children:["Editing: ",X?.title??"Untitled page"]}),i?.lastPublishedAt&&(0,__TURBOPACK__imported__module__18442__.jsxs)("p",{className:"text-xs text-slate-500 mt-1",children:["Last published: "," ",new Date(i.lastPublishedAt).toLocaleString(),i.lastPublishedVersion?` • Version ${i.lastPublishedVersion}`:""]})]}),(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,__TURBOPACK__imported__module__18442__.jsx)("button",{type:"button",className:"px-3 py-1 text-xs rounded bg-purple-700 hover:bg-purple-600 disabled:opacity-50",disabled:y,onClick:S,children:y?"Staging…":"Staging"}),(0,__TURBOPACK__imported__module__18442__.jsx)("button",{type:"button",className:"px-3 py-1 text-xs rounded bg-slate-700 hover:bg-slate-600 disabled:opacity-50",disabled:u,onClick:R,children:u?"Previewing…":"Preview"}),(0,__TURBOPACK__imported__module__18442__.jsx)("button",{type:"button",className:"inline-flex items-center rounded-full bg-slate-900 text-white text-xs px-4 py-1.5 disabled:opacity-60",onClick:Q,disabled:g||!c,children:g?"Publishing…":"Publish"}),(0,__TURBOPACK__imported__module__18442__.jsx)("a",{href:`/site/${b}/changelog`,className:"text-xs underline text-blue-300",children:"View Changelog"}),(0,__TURBOPACK__imported__module__18442__.jsx)("a",{href:`/site/${b}/settings`,className:"text-xs underline text-purple-300",children:"Settings"}),(0,__TURBOPACK__imported__module__18442__.jsx)("button",{type:"button",className:"text-[10px] text-slate-400 underline",onClick:()=>{p(!o),m||T()},children:o?"Hide history":"View history"}),k&&(0,__TURBOPACK__imported__module__18442__.jsx)("p",{className:"text-[10px] text-red-500 max-w-xs text-right",children:k})]})]}),w&&(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"mt-2 text-xs text-slate-300",children:["Preview ready: "," ",(0,__TURBOPACK__imported__module__18442__.jsx)("a",{href:w,target:"_blank",className:"underline text-slate-200",children:w})]}),A&&(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"mt-2 text-xs text-purple-300",children:["Staging ready: "," ",(0,__TURBOPACK__imported__module__18442__.jsx)("a",{href:A,target:"_blank",className:"underline text-purple-200",children:A})]}),C&&(0,__TURBOPACK__imported__module__18442__.jsx)("div",{className:"mt-2 text-xs text-red-400",children:C}),o&&m&&(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"mt-4 border border-slate-800 rounded-lg p-3 bg-slate-900/40",children:[(0,__TURBOPACK__imported__module__18442__.jsx)("h2",{className:"text-sm font-semibold mb-2",children:"Publish History"}),(0,__TURBOPACK__imported__module__18442__.jsx)("ul",{className:"space-y-2 text-xs",children:m.map((a,b)=>(0,__TURBOPACK__imported__module__18442__.jsxs)("li",{className:"border-b border-slate-800 pb-1",children:[(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"flex items-center justify-between",children:[(0,__TURBOPACK__imported__module__18442__.jsxs)("span",{children:["Version ",a.version," — "," ",new Date(a.timestamp).toLocaleString(),a.rollback?" (rollback)":""]}),(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"flex items-center gap-3",children:[a.url&&(0,__TURBOPACK__imported__module__18442__.jsx)("a",{href:a.url,target:"_blank",className:"text-slate-400 underline",children:"View"}),(0,__TURBOPACK__imported__module__18442__.jsx)("button",{type:"button",className:"text-slate-300 underline disabled:opacity-50",disabled:q,onClick:()=>U(a.version),children:"Restore"}),(0,__TURBOPACK__imported__module__18442__.jsx)("button",{type:"button",className:"text-slate-400 text-[10px] underline",onClick:()=>{let b=I===a.version?null:a.version;J(b),null!==b&&V(b)},children:I===a.version?"Hide changelog":"View changelog"}),(0,__TURBOPACK__imported__module__18442__.jsx)("button",{type:"button",className:"text-slate-400 text-[10px] underline",onClick:()=>{let b=M===a.version?null:a.version;N(b),null!==b&&W(b)},children:M===a.version?"Hide release notes":"View release notes"})]})]}),I===a.version&&(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"mt-1 text-[11px] text-slate-300 whitespace-pre-line",children:[void 0===K[a.version]&&(0,__TURBOPACK__imported__module__18442__.jsx)("span",{className:"text-slate-500",children:"Loading changelog…"}),null===K[a.version]&&(0,__TURBOPACK__imported__module__18442__.jsx)("span",{className:"text-slate-500",children:"No changelog available for this version."}),K[a.version]&&K[a.version]]}),M===a.version&&(0,__TURBOPACK__imported__module__18442__.jsxs)("div",{className:"mt-1 text-[11px] text-slate-300 whitespace-pre-line",children:[void 0===O[a.version]&&(0,__TURBOPACK__imported__module__18442__.jsx)("span",{className:"text-slate-500",children:"Loading release notes…"}),null===O[a.version]&&(0,__TURBOPACK__imported__module__18442__.jsx)("span",{className:"text-slate-500",children:"No release notes available for this version."}),O[a.version]&&O[a.version]]})]},b))})]}),(0,__TURBOPACK__imported__module__18442__.jsx)(Canvas,{blocks:Y,selectedBlockId:e,onSelectBlock:a=>f(a)})]}),(0,__TURBOPACK__imported__module__18442__.jsx)(BlockEditorSidebar,{block:Y.find(a=>a.id===e)??null,onChange:a=>{if(e&&X){if(a.__duplicate__){let a=Y.find(a=>a.id===e);a&&ab(X.id,a);return}$(X.id,e,a)}},onRegenerate:()=>{},onMoveUp:()=>{e&&X&&aa(X.id,e,"up")},onMoveDown:()=>{e&&X&&aa(X.id,e,"down")},onDelete:()=>{e&&X&&ac(X.id,e)}})]})}__turbopack_context__.s(["default",()=>BuilderCanvas],64759)}];

//# sourceMappingURL=buildwithai_src_app_builder_site_%5Bid%5D_page_tsx_12391929._.js.map